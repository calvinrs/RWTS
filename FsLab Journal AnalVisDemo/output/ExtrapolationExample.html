<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!--
      The Equity Extrapolation in F# parameters will be replaced with the
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>Equity Extrapolation in F#</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles/style.css" />
    <script src="styles/tips.js" type="text/javascript"></script>
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("visualization", "1.1",
      { packages: ["corechart", "annotationchart", "calendar",
          "gauge", "geochart", "map", "sankey", "table", "timeline", "treemap"] })
    $(function() { if (window.fsiResizeContent) window.fsiResizeContent($("body").height() + 10); });
  </script>
    <script language="javascript" type="text/javascript">
      function init()
      {
        try {
          websocket = new WebSocket("ws://" + window.location.hostname + ":" + window.location.port + "/websocket");
          websocket.onmessage = function(evt) { location.reload(); };
        } catch (e) { /* silently ignore lack of websockets */ }
      }
      window.addEventListener("load", init, false);
    </script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fslab.org">fslab.org</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Data/">F# Data</a></li>
          <li><a href="http://bluemountaincapital.github.io/Deedle">Deedle</a></li>
          <li><a href="http://bluemountaincapital.github.io/FSharpRProvider">R Provider</a></li>
          <li><a href="http://tahahachana.github.io/XPlot/">XPlot</a></li>
          <li><a href="http://www.mathdotnet.com/">Math.Net</a></li>
        </ul>
        <h3 class="muted">Journal</h3>
      </div>
      <hr />
      <div class="row" style="margin-top:30px">
        <div class="span1"></div>
        <div class="span10" id="main">
          <h1>Equity Extrapolation in F#</h1>
<a name="Settings"></a>
<h2>Defining the tool Settings and Parameters</h2>
<p>Targets here are simplified market volatilities. These will arrive in the form of a (Maturity, Strike, Value) "matrix".
We are only including what we fit to here, so only ATM Volatilities (Strike =1) are required, so we can throw away the strike information.
So, we are assuming that this is the "clean" data, where only points with a value are included (no NULL or NA values), and the data is sorted by Maturity.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// targets - simplified &quot;NOX&quot; data for a E_NOK fit @EndMar2017</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">simpleTargetVols</span> <span class="o">=</span> [  (<span class="n">0.25</span>,<span class="n">0.18938213810157</span>);
                            (<span class="n">0.5</span>,<span class="n">0.192238397377696</span>);
                            (<span class="n">0.75</span>,<span class="n">0.194751728074236</span>);
                            (<span class="n">1.0</span>,<span class="n">0.19619340600353</span>);
                            (<span class="n">2.0</span>,<span class="n">0.192399997024925</span>);
                            (<span class="n">3.0</span>,<span class="n">0.191733301529111</span>);
                            (<span class="n">4.0</span>,<span class="n">0.189276479115615</span>);
                            (<span class="n">5.0</span>,<span class="n">0.18700481201725</span>);
                            (<span class="n">7.0</span>,<span class="n">0.179412496332435</span>);
                            (<span class="n">10.0</span>,<span class="n">0.169832870147339</span>);]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>Could not find reference 'simpleTargetVols'</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
<span class="l">57: </span>
<span class="l">58: </span>
<span class="l">59: </span>
<span class="l">60: </span>
<span class="l">61: </span>
<span class="l">62: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">UncVolLimit</span> <span class="o">=</span> <span class="n">0.2208</span>

<span class="c">// parameter seeds</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">automaticIncreaseMaxFactor</span> <span class="o">=</span> <span class="k">true</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">maxFactorIncrease</span> <span class="o">=</span> <span class="n">1.25</span>

<span class="c">// unconditional targets</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">weightsDecayFactor</span> <span class="o">=</span> <span class="n">0.5</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">seedMinFactor</span> <span class="o">=</span> <span class="n">1.05</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs7', 7)" onmouseover="showTip(event, 'fs7', 7)" class="i">initialSeedMaxFactor</span> <span class="o">=</span> <span class="n">1.4</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 8)" onmouseover="showTip(event, 'fs8', 8)" class="i">seedAlpha</span> <span class="o">=</span> <span class="n">0.5</span>


<span class="c">(* If we choose to &quot;automaticIncreaseMaxFactor&quot; then we check if the maximum market data point already exceeds the maxLimit. </span>
<span class="c">If so, then we increase this by the defined maxFactorIncrease</span>
<span class="c">**)</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 9)" onmouseover="showTip(event, 'fs9', 9)" class="i">seedMaxFactor</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 10)" onmouseover="showTip(event, 'fs10', 10)" class="i">initialMaxLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">initialSeedMaxFactor</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs2', 12)" onmouseover="showTip(event, 'fs2', 12)" class="i">UncVolLimit</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs11', 13)" onmouseover="showTip(event, 'fs11', 13)" class="i">actualFactorIncrease</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs3', 14)" onmouseover="showTip(event, 'fs3', 14)" class="i">automaticIncreaseMaxFactor</span> 
                                <span class="k">then</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs1', 15)" onmouseover="showTip(event, 'fs1', 15)" class="i">simpleTargetVols</span><span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="f">maxBy</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 18)" onmouseover="showTip(event, 'fs14', 18)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 19)" onmouseover="showTip(event, 'fs15', 19)" class="i">v</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs15', 20)" onmouseover="showTip(event, 'fs15', 20)" class="i">v</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 21)" onmouseover="showTip(event, 'fs16', 21)" class="f">snd</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs10', 22)" onmouseover="showTip(event, 'fs10', 22)" class="i">initialMaxLimit</span> <span class="k">then</span> <span class="n">1.25</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs7', 23)" onmouseover="showTip(event, 'fs7', 23)" class="i">initialSeedMaxFactor</span> <span class="k">else</span> <span class="n">1.0</span>
                                <span class="k">else</span> <span class="n">1.0</span>
    <span onmouseout="hideTip(event, 'fs11', 24)" onmouseover="showTip(event, 'fs11', 24)" class="i">actualFactorIncrease</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs7', 25)" onmouseover="showTip(event, 'fs7', 25)" class="i">initialSeedMaxFactor</span>

<span class="c">// Now we can set the final max/min limits</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 26)" onmouseover="showTip(event, 'fs17', 26)" class="i">maxLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs9', 27)" onmouseover="showTip(event, 'fs9', 27)" class="i">seedMaxFactor</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs2', 28)" onmouseover="showTip(event, 'fs2', 28)" class="i">UncVolLimit</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 29)" onmouseover="showTip(event, 'fs18', 29)" class="i">minLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs6', 30)" onmouseover="showTip(event, 'fs6', 30)" class="i">seedMinFactor</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs2', 31)" onmouseover="showTip(event, 'fs2', 31)" class="i">UncVolLimit</span>

<span class="c">(* We will need to set the bounds of the model parameters for the optimisation routine.</span>
<span class="c">**)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 32)" onmouseover="showTip(event, 'fs19', 32)" class="i">seedSigmaZeroLowerBound</span> <span class="o">=</span> <span class="n">0.0001</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 33)" onmouseover="showTip(event, 'fs20', 33)" class="i">seedSigmaZeroUpperBound</span> <span class="o">=</span> <span class="n">100.0</span> <span class="c">//unbounded, so &quot;something big&quot;</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 34)" onmouseover="showTip(event, 'fs21', 34)" class="i">seedSigmaInfLowerBound</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 35)" onmouseover="showTip(event, 'fs18', 35)" class="i">minLimit</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 36)" onmouseover="showTip(event, 'fs22', 36)" class="i">seedSigmaInfUpperBound</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 37)" onmouseover="showTip(event, 'fs17', 37)" class="i">maxLimit</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs23', 38)" onmouseover="showTip(event, 'fs23', 38)" class="i">seedAlphaLowerBound</span> <span class="o">=</span> <span class="n">0.05</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 39)" onmouseover="showTip(event, 'fs24', 39)" class="i">seedAlphaUpperBound</span> <span class="o">=</span> <span class="n">100.0</span> <span class="c">//unbounded, so &quot;something big&quot;</span>

<span class="c">(* We define the terms that we wish to evaluate for our final answer. </span>
<span class="c">Note that the final extrapolated ATM vol curve will be replaced with the actual market values up to the maximum term of the market data.</span>
<span class="c">**)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 40)" onmouseover="showTip(event, 'fs25', 40)" class="i">outMaturities</span> <span class="o">=</span> [<span class="n">0.25</span>;<span class="n">0.5</span>;<span class="n">0.75</span>] <span class="o">@</span> [<span class="n">1.0</span><span class="o">..</span><span class="n">10.0</span>] <span class="o">@</span> [<span class="n">15.0</span> ;<span class="n">20.0</span>; <span class="n">25.0</span>; <span class="n">30.0</span>;<span class="n">40.0</span>;<span class="n">50.0</span>]


<span class="c">// functions</span>
<span class="c">// Try with a type as the Seed input</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs26', 41)" onmouseover="showTip(event, 'fs26', 41)" class="t">ModelParams</span> <span class="o">=</span> {<span onmouseout="hideTip(event, 'fs27', 42)" onmouseover="showTip(event, 'fs27', 42)" class="i">sigmaZero</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs28', 43)" onmouseover="showTip(event, 'fs28', 43)" class="t">float</span>; <span onmouseout="hideTip(event, 'fs29', 44)" onmouseover="showTip(event, 'fs29', 44)" class="i">sigmaInf</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs28', 45)" onmouseover="showTip(event, 'fs28', 45)" class="t">float</span>; <span onmouseout="hideTip(event, 'fs30', 46)" onmouseover="showTip(event, 'fs30', 46)" class="i">alpha</span><span class="o">:</span><span onmouseout="hideTip(event, 'fs28', 47)" onmouseover="showTip(event, 'fs28', 47)" class="t">float</span> }

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs31', 48)" onmouseover="showTip(event, 'fs31', 48)" class="i">modelParamSeeds</span> <span class="o">=</span> {<span class="i">sigmaZero</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs18', 49)" onmouseover="showTip(event, 'fs18', 49)" class="i">minLimit</span>; <span class="i">sigmaInf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs17', 50)" onmouseover="showTip(event, 'fs17', 50)" class="i">maxLimit</span>; <span class="i">alpha</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 51)" onmouseover="showTip(event, 'fs8', 51)" class="i">seedAlpha</span> }

<span class="c">//If we want to optimise, then we will need to provide upper and lower bounds to the problem</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 52)" onmouseover="showTip(event, 'fs32', 52)" class="i">seedsLowerBound</span> <span class="o">=</span> {<span class="i">sigmaZero</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs19', 53)" onmouseover="showTip(event, 'fs19', 53)" class="i">seedSigmaZeroLowerBound</span>; <span class="i">sigmaInf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs21', 54)" onmouseover="showTip(event, 'fs21', 54)" class="i">seedSigmaInfLowerBound</span>; <span class="i">alpha</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs23', 55)" onmouseover="showTip(event, 'fs23', 55)" class="i">seedAlphaLowerBound</span> }
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs33', 56)" onmouseover="showTip(event, 'fs33', 56)" class="i">seedsUpperBound</span> <span class="o">=</span> {<span class="i">sigmaZero</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs20', 57)" onmouseover="showTip(event, 'fs20', 57)" class="i">seedSigmaZeroUpperBound</span>; <span class="i">sigmaInf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs22', 58)" onmouseover="showTip(event, 'fs22', 58)" class="i">seedSigmaInfUpperBound</span>; <span class="i">alpha</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 59)" onmouseover="showTip(event, 'fs24', 59)" class="i">seedAlphaUpperBound</span> }

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs34', 60)" onmouseover="showTip(event, 'fs34', 60)" class="t">OptimiserParams</span> <span class="o">=</span> {<span onmouseout="hideTip(event, 'fs35', 61)" onmouseover="showTip(event, 'fs35', 61)" class="i">seeds</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs26', 62)" onmouseover="showTip(event, 'fs26', 62)" class="t">ModelParams</span>; <span onmouseout="hideTip(event, 'fs36', 63)" onmouseover="showTip(event, 'fs36', 63)" class="i">lowerBound</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs26', 64)" onmouseover="showTip(event, 'fs26', 64)" class="t">ModelParams</span>; <span onmouseout="hideTip(event, 'fs37', 65)" onmouseover="showTip(event, 'fs37', 65)" class="i">upperBound</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs26', 66)" onmouseover="showTip(event, 'fs26', 66)" class="t">ModelParams</span>}

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 67)" onmouseover="showTip(event, 'fs38', 67)" class="i">optimiserStartParams</span> <span class="o">=</span> {<span class="i">seeds</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs31', 68)" onmouseover="showTip(event, 'fs31', 68)" class="i">modelParamSeeds</span>; <span class="i">lowerBound</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 69)" onmouseover="showTip(event, 'fs32', 69)" class="i">seedsLowerBound</span>; <span class="i">upperBound</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs33', 70)" onmouseover="showTip(event, 'fs33', 70)" class="i">seedsUpperBound</span>}
</code></pre></td>
</tr>
</table>
<a name="Extrapolation"></a>
<h2>Calculating the model</h2>
<p>The actual model that we are trying to calibrate here can be defined in one line:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">  1: </span>
<span class="l">  2: </span>
<span class="l">  3: </span>
<span class="l">  4: </span>
<span class="l">  5: </span>
<span class="l">  6: </span>
<span class="l">  7: </span>
<span class="l">  8: </span>
<span class="l">  9: </span>
<span class="l"> 10: </span>
<span class="l"> 11: </span>
<span class="l"> 12: </span>
<span class="l"> 13: </span>
<span class="l"> 14: </span>
<span class="l"> 15: </span>
<span class="l"> 16: </span>
<span class="l"> 17: </span>
<span class="l"> 18: </span>
<span class="l"> 19: </span>
<span class="l"> 20: </span>
<span class="l"> 21: </span>
<span class="l"> 22: </span>
<span class="l"> 23: </span>
<span class="l"> 24: </span>
<span class="l"> 25: </span>
<span class="l"> 26: </span>
<span class="l"> 27: </span>
<span class="l"> 28: </span>
<span class="l"> 29: </span>
<span class="l"> 30: </span>
<span class="l"> 31: </span>
<span class="l"> 32: </span>
<span class="l"> 33: </span>
<span class="l"> 34: </span>
<span class="l"> 35: </span>
<span class="l"> 36: </span>
<span class="l"> 37: </span>
<span class="l"> 38: </span>
<span class="l"> 39: </span>
<span class="l"> 40: </span>
<span class="l"> 41: </span>
<span class="l"> 42: </span>
<span class="l"> 43: </span>
<span class="l"> 44: </span>
<span class="l"> 45: </span>
<span class="l"> 46: </span>
<span class="l"> 47: </span>
<span class="l"> 48: </span>
<span class="l"> 49: </span>
<span class="l"> 50: </span>
<span class="l"> 51: </span>
<span class="l"> 52: </span>
<span class="l"> 53: </span>
<span class="l"> 54: </span>
<span class="l"> 55: </span>
<span class="l"> 56: </span>
<span class="l"> 57: </span>
<span class="l"> 58: </span>
<span class="l"> 59: </span>
<span class="l"> 60: </span>
<span class="l"> 61: </span>
<span class="l"> 62: </span>
<span class="l"> 63: </span>
<span class="l"> 64: </span>
<span class="l"> 65: </span>
<span class="l"> 66: </span>
<span class="l"> 67: </span>
<span class="l"> 68: </span>
<span class="l"> 69: </span>
<span class="l"> 70: </span>
<span class="l"> 71: </span>
<span class="l"> 72: </span>
<span class="l"> 73: </span>
<span class="l"> 74: </span>
<span class="l"> 75: </span>
<span class="l"> 76: </span>
<span class="l"> 77: </span>
<span class="l"> 78: </span>
<span class="l"> 79: </span>
<span class="l"> 80: </span>
<span class="l"> 81: </span>
<span class="l"> 82: </span>
<span class="l"> 83: </span>
<span class="l"> 84: </span>
<span class="l"> 85: </span>
<span class="l"> 86: </span>
<span class="l"> 87: </span>
<span class="l"> 88: </span>
<span class="l"> 89: </span>
<span class="l"> 90: </span>
<span class="l"> 91: </span>
<span class="l"> 92: </span>
<span class="l"> 93: </span>
<span class="l"> 94: </span>
<span class="l"> 95: </span>
<span class="l"> 96: </span>
<span class="l"> 97: </span>
<span class="l"> 98: </span>
<span class="l"> 99: </span>
<span class="l">100: </span>
<span class="l">101: </span>
<span class="l">102: </span>
<span class="l">103: </span>
<span class="l">104: </span>
<span class="l">105: </span>
<span class="l">106: </span>
<span class="l">107: </span>
<span class="l">108: </span>
<span class="l">109: </span>
<span class="l">110: </span>
<span class="l">111: </span>
<span class="l">112: </span>
<span class="l">113: </span>
<span class="l">114: </span>
<span class="l">115: </span>
<span class="l">116: </span>
<span class="l">117: </span>
<span class="l">118: </span>
<span class="l">119: </span>
<span class="l">120: </span>
<span class="l">121: </span>
<span class="l">122: </span>
<span class="l">123: </span>
<span class="l">124: </span>
<span class="l">125: </span>
<span class="l">126: </span>
<span class="l">127: </span>
<span class="l">128: </span>
<span class="l">129: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs39', 71)" onmouseover="showTip(event, 'fs39', 71)" class="f">modelImpliedVolatility</span> <span onmouseout="hideTip(event, 'fs40', 72)" onmouseover="showTip(event, 'fs40', 72)" class="i">modelParams</span> <span onmouseout="hideTip(event, 'fs14', 73)" onmouseover="showTip(event, 'fs14', 73)" class="i">t</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 74)" onmouseover="showTip(event, 'fs41', 74)" class="f">sqrt</span>((<span onmouseout="hideTip(event, 'fs40', 75)" onmouseover="showTip(event, 'fs40', 75)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 76)" onmouseover="showTip(event, 'fs29', 76)" class="i">sigmaInf</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs40', 77)" onmouseover="showTip(event, 'fs40', 77)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 78)" onmouseover="showTip(event, 'fs29', 78)" class="i">sigmaInf</span>) <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs42', 79)" onmouseover="showTip(event, 'fs42', 79)" class="f">exp</span>(<span class="o">-</span><span onmouseout="hideTip(event, 'fs40', 80)" onmouseover="showTip(event, 'fs40', 80)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 81)" onmouseover="showTip(event, 'fs30', 81)" class="i">alpha</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs14', 82)" onmouseover="showTip(event, 'fs14', 82)" class="i">t</span>)) <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs40', 83)" onmouseover="showTip(event, 'fs40', 83)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 84)" onmouseover="showTip(event, 'fs27', 84)" class="i">sigmaZero</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs40', 85)" onmouseover="showTip(event, 'fs40', 85)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 86)" onmouseover="showTip(event, 'fs27', 86)" class="i">sigmaZero</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs40', 87)" onmouseover="showTip(event, 'fs40', 87)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 88)" onmouseover="showTip(event, 'fs29', 88)" class="i">sigmaInf</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs40', 89)" onmouseover="showTip(event, 'fs40', 89)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 90)" onmouseover="showTip(event, 'fs29', 90)" class="i">sigmaInf</span>) <span class="o">/</span> (<span onmouseout="hideTip(event, 'fs40', 91)" onmouseover="showTip(event, 'fs40', 91)" class="i">modelParams</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 92)" onmouseover="showTip(event, 'fs30', 92)" class="i">alpha</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs14', 93)" onmouseover="showTip(event, 'fs14', 93)" class="i">t</span>))

<span class="c">// And, we can test this works straight away</span>
<span onmouseout="hideTip(event, 'fs39', 94)" onmouseover="showTip(event, 'fs39', 94)" class="f">modelImpliedVolatility</span> <span onmouseout="hideTip(event, 'fs31', 95)" onmouseover="showTip(event, 'fs31', 95)" class="i">modelParamSeeds</span> <span class="n">5.0</span> <span class="c">//  = 0.2832060327621</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs43', 96)" onmouseover="showTip(event, 'fs43', 96)" class="t">WeightMethod</span> <span class="o">=</span>  <span onmouseout="hideTip(event, 'fs44', 97)" onmouseover="showTip(event, 'fs44', 97)" class="p">VShaped</span> | <span onmouseout="hideTip(event, 'fs45', 98)" onmouseover="showTip(event, 'fs45', 98)" class="p">Standard</span>

<span class="c">// Apply weights to the Target </span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 99)" onmouseover="showTip(event, 'fs46', 99)" class="f">weightedTargetWithDecay</span> <span onmouseout="hideTip(event, 'fs47', 100)" onmouseover="showTip(event, 'fs47', 100)" class="i">decayFactor</span> <span onmouseout="hideTip(event, 'fs48', 101)" onmouseover="showTip(event, 'fs48', 101)" class="i">wtMethod</span> <span onmouseout="hideTip(event, 'fs49', 102)" onmouseover="showTip(event, 'fs49', 102)" class="i">simpleTarget</span>  <span class="o">=</span> 

    <span class="c">// find the final point of the market data</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs50', 103)" onmouseover="showTip(event, 'fs50', 103)" class="i">maxTerm</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs49', 104)" onmouseover="showTip(event, 'fs49', 104)" class="i">simpleTarget</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 105)" onmouseover="showTip(event, 'fs12', 105)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 106)" onmouseover="showTip(event, 'fs51', 106)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 107)" onmouseover="showTip(event, 'fs14', 107)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 108)" onmouseover="showTip(event, 'fs15', 108)" class="i">v</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 109)" onmouseover="showTip(event, 'fs14', 109)" class="i">t</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 110)" onmouseover="showTip(event, 'fs12', 110)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 111)" onmouseover="showTip(event, 'fs52', 111)" class="f">max</span>  
    
    <span class="c">// There is a complicated bit in setting the weights, where we find the slope of the curve at the final point, and remove the weight on any point that is not going in the same direction.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 112)" onmouseover="showTip(event, 'fs53', 112)" class="i">termDeltas</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs49', 113)" onmouseover="showTip(event, 'fs49', 113)" class="i">simpleTarget</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 114)" onmouseover="showTip(event, 'fs12', 114)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 115)" onmouseover="showTip(event, 'fs54', 115)" class="f">pairwise</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 116)" onmouseover="showTip(event, 'fs12', 116)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 117)" onmouseover="showTip(event, 'fs51', 117)" class="f">map</span> (<span class="k">fun</span> ((<span onmouseout="hideTip(event, 'fs55', 118)" onmouseover="showTip(event, 'fs55', 118)" class="i">t1</span>, <span onmouseout="hideTip(event, 'fs56', 119)" onmouseover="showTip(event, 'fs56', 119)" class="i">v1</span>),(<span onmouseout="hideTip(event, 'fs57', 120)" onmouseover="showTip(event, 'fs57', 120)" class="i">t2</span>, <span onmouseout="hideTip(event, 'fs58', 121)" onmouseover="showTip(event, 'fs58', 121)" class="i">v2</span>)) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs55', 122)" onmouseover="showTip(event, 'fs55', 122)" class="i">t1</span>, (<span onmouseout="hideTip(event, 'fs58', 123)" onmouseover="showTip(event, 'fs58', 123)" class="i">v2</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs56', 124)" onmouseover="showTip(event, 'fs56', 124)" class="i">v1</span>) <span class="o">/</span> (<span class="i">t2</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs55', 125)" onmouseover="showTip(event, 'fs55', 125)" class="i">t1</span>)) ) 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs59', 126)" onmouseover="showTip(event, 'fs59', 126)" class="i">lastDelta</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 127)" onmouseover="showTip(event, 'fs53', 127)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 128)" onmouseover="showTip(event, 'fs12', 128)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 129)" onmouseover="showTip(event, 'fs60', 129)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 130)" onmouseover="showTip(event, 'fs12', 130)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 131)" onmouseover="showTip(event, 'fs61', 131)" class="f">head</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 132)" onmouseover="showTip(event, 'fs16', 132)" class="f">snd</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 133)" onmouseover="showTip(event, 'fs62', 133)" class="i">secondLastDelta</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 134)" onmouseover="showTip(event, 'fs53', 134)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 135)" onmouseover="showTip(event, 'fs12', 135)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 136)" onmouseover="showTip(event, 'fs60', 136)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 137)" onmouseover="showTip(event, 'fs12', 137)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 138)" onmouseover="showTip(event, 'fs63', 138)" class="f">item</span> <span class="n">1</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 139)" onmouseover="showTip(event, 'fs16', 139)" class="f">snd</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 140)" onmouseover="showTip(event, 'fs64', 140)" class="i">secondLastMarketTerm</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 141)" onmouseover="showTip(event, 'fs53', 141)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 142)" onmouseover="showTip(event, 'fs12', 142)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 143)" onmouseover="showTip(event, 'fs60', 143)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 144)" onmouseover="showTip(event, 'fs12', 144)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 145)" onmouseover="showTip(event, 'fs61', 145)" class="f">head</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs65', 146)" onmouseover="showTip(event, 'fs65', 146)" class="f">fst</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 147)" onmouseover="showTip(event, 'fs66', 147)" class="f">isDeltaTheSameDirection</span> <span onmouseout="hideTip(event, 'fs67', 148)" onmouseover="showTip(event, 'fs67', 148)" class="i">lastVal</span> <span onmouseout="hideTip(event, 'fs68', 149)" onmouseover="showTip(event, 'fs68', 149)" class="i">thisVal</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs67', 150)" onmouseover="showTip(event, 'fs67', 150)" class="i">lastVal</span> <span class="o">&lt;</span> <span class="n">0.0</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs68', 151)" onmouseover="showTip(event, 'fs68', 151)" class="i">thisVal</span> <span class="o">&lt;</span> <span class="n">0.0</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs68', 152)" onmouseover="showTip(event, 'fs68', 152)" class="i">thisVal</span> <span class="o">&gt;</span> <span class="n">0.0</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 153)" onmouseover="showTip(event, 'fs69', 153)" class="i">ignoreSlopeMap</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 154)" onmouseover="showTip(event, 'fs53', 154)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 155)" onmouseover="showTip(event, 'fs12', 155)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 156)" onmouseover="showTip(event, 'fs51', 156)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 157)" onmouseover="showTip(event, 'fs14', 157)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 158)" onmouseover="showTip(event, 'fs15', 158)" class="i">v</span>) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs14', 159)" onmouseover="showTip(event, 'fs14', 159)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs66', 160)" onmouseover="showTip(event, 'fs66', 160)" class="f">isDeltaTheSameDirection</span> <span onmouseout="hideTip(event, 'fs59', 161)" onmouseover="showTip(event, 'fs59', 161)" class="i">lastDelta</span> <span onmouseout="hideTip(event, 'fs15', 162)" onmouseover="showTip(event, 'fs15', 162)" class="i">v</span>)) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs70', 163)" onmouseover="showTip(event, 'fs70', 163)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs71', 164)" onmouseover="showTip(event, 'fs71', 164)" class="f">ofList</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs72', 165)" onmouseover="showTip(event, 'fs72', 165)" class="i">fullIgnoreSlopeMap</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs69', 166)" onmouseover="showTip(event, 'fs69', 166)" class="i">ignoreSlopeMap</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs73', 167)" onmouseover="showTip(event, 'fs73', 167)" class="f">Add</span>(<span onmouseout="hideTip(event, 'fs50', 168)" onmouseover="showTip(event, 'fs50', 168)" class="i">maxTerm</span>, <span class="k">true</span>)

    <span class="c">// also we check if there is a V present at the end of the series  </span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs74', 169)" onmouseover="showTip(event, 'fs74', 169)" class="i">isVPresent</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs59', 170)" onmouseover="showTip(event, 'fs59', 170)" class="i">lastDelta</span> <span class="o">&gt;</span> <span class="n">0.0</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs62', 171)" onmouseover="showTip(event, 'fs62', 171)" class="i">secondLastDelta</span> <span class="o">&lt;</span> <span class="n">0.0</span>

    <span class="c">// We can now find the exponentially decaying weights for all market points.</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs75', 172)" onmouseover="showTip(event, 'fs75', 172)" class="i">extrapWeightsTargetVols</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs49', 173)" onmouseover="showTip(event, 'fs49', 173)" class="i">simpleTarget</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 174)" onmouseover="showTip(event, 'fs12', 174)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 175)" onmouseover="showTip(event, 'fs51', 175)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 176)" onmouseover="showTip(event, 'fs14', 176)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 177)" onmouseover="showTip(event, 'fs15', 177)" class="i">v</span>) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs14', 178)" onmouseover="showTip(event, 'fs14', 178)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 179)" onmouseover="showTip(event, 'fs15', 179)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs42', 180)" onmouseover="showTip(event, 'fs42', 180)" class="f">exp</span>(<span class="o">-</span><span onmouseout="hideTip(event, 'fs47', 181)" onmouseover="showTip(event, 'fs47', 181)" class="i">decayFactor</span> <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs50', 182)" onmouseover="showTip(event, 'fs50', 182)" class="i">maxTerm</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs14', 183)" onmouseover="showTip(event, 'fs14', 183)" class="i">t</span>))))

    <span class="c">// Finally, we adjust depending on the method chosen. </span>
    <span class="c">// For the standard case, we ignore the points with a change in direction before it</span>
    <span class="c">// For the V case, we ignore the penultimate point only</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 184)" onmouseover="showTip(event, 'fs76', 184)" class="i">finalExtrapWeightsTargetVols</span> <span class="o">=</span> 
        <span class="k">match</span> <span onmouseout="hideTip(event, 'fs48', 185)" onmouseover="showTip(event, 'fs48', 185)" class="i">wtMethod</span> <span class="k">with</span>
        | <span onmouseout="hideTip(event, 'fs45', 186)" onmouseover="showTip(event, 'fs45', 186)" class="p">Standard</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs75', 187)" onmouseover="showTip(event, 'fs75', 187)" class="i">extrapWeightsTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 188)" onmouseover="showTip(event, 'fs12', 188)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 189)" onmouseover="showTip(event, 'fs51', 189)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 190)" onmouseover="showTip(event, 'fs14', 190)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 191)" onmouseover="showTip(event, 'fs15', 191)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs77', 192)" onmouseover="showTip(event, 'fs77', 192)" class="i">w</span>) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs14', 193)" onmouseover="showTip(event, 'fs14', 193)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 194)" onmouseover="showTip(event, 'fs15', 194)" class="i">v</span>, <span class="k">if</span> <span onmouseout="hideTip(event, 'fs72', 195)" onmouseover="showTip(event, 'fs72', 195)" class="i">fullIgnoreSlopeMap</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs14', 196)" onmouseover="showTip(event, 'fs14', 196)" class="i">t</span>] <span class="k">then</span> <span onmouseout="hideTip(event, 'fs77', 197)" onmouseover="showTip(event, 'fs77', 197)" class="i">w</span> <span class="k">else</span> <span class="n">0.0</span>))
        | <span onmouseout="hideTip(event, 'fs44', 198)" onmouseover="showTip(event, 'fs44', 198)" class="p">VShaped</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs75', 199)" onmouseover="showTip(event, 'fs75', 199)" class="i">extrapWeightsTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 200)" onmouseover="showTip(event, 'fs12', 200)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 201)" onmouseover="showTip(event, 'fs51', 201)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 202)" onmouseover="showTip(event, 'fs14', 202)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 203)" onmouseover="showTip(event, 'fs15', 203)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs77', 204)" onmouseover="showTip(event, 'fs77', 204)" class="i">w</span>) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs14', 205)" onmouseover="showTip(event, 'fs14', 205)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 206)" onmouseover="showTip(event, 'fs15', 206)" class="i">v</span>, <span class="k">if</span> (<span onmouseout="hideTip(event, 'fs14', 207)" onmouseover="showTip(event, 'fs14', 207)" class="i">t</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 208)" onmouseover="showTip(event, 'fs64', 208)" class="i">secondLastMarketTerm</span>) <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs74', 209)" onmouseover="showTip(event, 'fs74', 209)" class="i">isVPresent</span>  <span class="k">then</span> <span class="n">0.0</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs77', 210)" onmouseover="showTip(event, 'fs77', 210)" class="i">w</span> ))
    
    <span onmouseout="hideTip(event, 'fs76', 211)" onmouseover="showTip(event, 'fs76', 211)" class="i">finalExtrapWeightsTargetVols</span>

<span class="c">// We can &quot;bake in&quot; the decay factor, as this will rarely change</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 212)" onmouseover="showTip(event, 'fs78', 212)" class="f">weightedTarget</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs46', 213)" onmouseover="showTip(event, 'fs46', 213)" class="f">weightedTargetWithDecay</span> <span onmouseout="hideTip(event, 'fs5', 214)" onmouseover="showTip(event, 'fs5', 214)" class="i">weightsDecayFactor</span> 

<span class="c">// Likewise, we can bake in the Method</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs79', 215)" onmouseover="showTip(event, 'fs79', 215)" class="f">standardWeightedTarget</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs78', 216)" onmouseover="showTip(event, 'fs78', 216)" class="f">weightedTarget</span> <span onmouseout="hideTip(event, 'fs43', 217)" onmouseover="showTip(event, 'fs43', 217)" class="t">WeightMethod</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs45', 218)" onmouseover="showTip(event, 'fs45', 218)" class="p">Standard</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs80', 219)" onmouseover="showTip(event, 'fs80', 219)" class="f">vShapedWeightedTarget</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs78', 220)" onmouseover="showTip(event, 'fs78', 220)" class="f">weightedTarget</span> <span onmouseout="hideTip(event, 'fs43', 221)" onmouseover="showTip(event, 'fs43', 221)" class="t">WeightMethod</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs44', 222)" onmouseover="showTip(event, 'fs44', 222)" class="p">VShaped</span>

<span class="c">// Finally, we can feed in the target IV data to produce the weighted version of the target</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs81', 223)" onmouseover="showTip(event, 'fs81', 223)" class="i">finalWeightedTarget</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs79', 224)" onmouseover="showTip(event, 'fs79', 224)" class="f">standardWeightedTarget</span> <span onmouseout="hideTip(event, 'fs1', 225)" onmouseover="showTip(event, 'fs1', 225)" class="i">simpleTargetVols</span>


<span class="c">// Test cases for the V-shaped data</span>

<span class="c">// no v-shape, so no weights removed</span>
<span onmouseout="hideTip(event, 'fs80', 226)" onmouseover="showTip(event, 'fs80', 226)" class="f">vShapedWeightedTarget</span> <span onmouseout="hideTip(event, 'fs1', 227)" onmouseover="showTip(event, 'fs1', 227)" class="i">simpleTargetVols</span>


<span class="k">let</span> <span onmouseout="hideTip(event, 'fs82', 228)" onmouseover="showTip(event, 'fs82', 228)" class="i">testVShapedVols</span> <span class="o">=</span>  [  (<span class="n">0.25</span>,<span class="n">0.18938213810157</span>);
                            (<span class="n">0.5</span>,<span class="n">0.192238397377696</span>);
                            (<span class="n">0.75</span>,<span class="n">0.194751728074236</span>);
                            (<span class="n">1.0</span>,<span class="n">0.19619340600353</span>);
                            (<span class="n">2.0</span>,<span class="n">0.192399997024925</span>);
                            (<span class="n">3.0</span>,<span class="n">0.191733301529111</span>);
                            (<span class="n">4.0</span>,<span class="n">0.189276479115615</span>);
                            (<span class="n">5.0</span>,<span class="n">0.190</span>);
                            (<span class="n">7.0</span>,<span class="n">0.180</span>);
                            (<span class="n">10.0</span>,<span class="n">0.20</span>);]

<span class="c">// Should be unweighted below the last 2 points</span>
<span onmouseout="hideTip(event, 'fs79', 229)" onmouseover="showTip(event, 'fs79', 229)" class="f">standardWeightedTarget</span> <span onmouseout="hideTip(event, 'fs82', 230)" onmouseover="showTip(event, 'fs82', 230)" class="i">testVShapedVols</span>

<span class="c">// should have the penultimate point zeroed out</span>
<span onmouseout="hideTip(event, 'fs80', 231)" onmouseover="showTip(event, 'fs80', 231)" class="f">vShapedWeightedTarget</span> <span onmouseout="hideTip(event, 'fs82', 232)" onmouseover="showTip(event, 'fs82', 232)" class="i">testVShapedVols</span>


<span class="c">//TODO turn this into a function that returns &quot;extrapSqdError&quot; given the model parameters only</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs83', 233)" onmouseover="showTip(event, 'fs83', 233)" class="f">errorToMinimise</span> <span onmouseout="hideTip(event, 'fs40', 234)" onmouseover="showTip(event, 'fs40', 234)" class="i">modelParams</span> <span onmouseout="hideTip(event, 'fs84', 235)" onmouseover="showTip(event, 'fs84', 235)" class="i">target</span> <span class="o">=</span> 

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 236)" onmouseover="showTip(event, 'fs85', 236)" class="i">weightedMktModelPairs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs84', 237)" onmouseover="showTip(event, 'fs84', 237)" class="i">target</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 238)" onmouseover="showTip(event, 'fs12', 238)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 239)" onmouseover="showTip(event, 'fs51', 239)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 240)" onmouseover="showTip(event, 'fs14', 240)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 241)" onmouseover="showTip(event, 'fs15', 241)" class="i">v</span>, <span onmouseout="hideTip(event, 'fs77', 242)" onmouseover="showTip(event, 'fs77', 242)" class="i">w</span>) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs15', 243)" onmouseover="showTip(event, 'fs15', 243)" class="i">v</span>,  <span onmouseout="hideTip(event, 'fs39', 244)" onmouseover="showTip(event, 'fs39', 244)" class="f">modelImpliedVolatility</span> <span onmouseout="hideTip(event, 'fs40', 245)" onmouseover="showTip(event, 'fs40', 245)" class="i">modelParams</span> <span onmouseout="hideTip(event, 'fs14', 246)" onmouseover="showTip(event, 'fs14', 246)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs77', 247)" onmouseover="showTip(event, 'fs77', 247)" class="i">w</span>))
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 248)" onmouseover="showTip(event, 'fs86', 248)" class="i">numWeightedPoints</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs85', 249)" onmouseover="showTip(event, 'fs85', 249)" class="i">weightedMktModelPairs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 250)" onmouseover="showTip(event, 'fs12', 250)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 251)" onmouseover="showTip(event, 'fs51', 251)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs87', 252)" onmouseover="showTip(event, 'fs87', 252)" class="i">mkt</span>, <span onmouseout="hideTip(event, 'fs88', 253)" onmouseover="showTip(event, 'fs88', 253)" class="i">mdl</span>, <span onmouseout="hideTip(event, 'fs89', 254)" onmouseover="showTip(event, 'fs89', 254)" class="i">weight</span>) <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs89', 255)" onmouseover="showTip(event, 'fs89', 255)" class="i">weight</span> <span class="o">=</span> <span class="n">0.0</span> <span class="k">then</span> <span class="n">0.0</span> <span class="k">else</span> <span class="n">1.0</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 256)" onmouseover="showTip(event, 'fs12', 256)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 257)" onmouseover="showTip(event, 'fs90', 257)" class="f">sum</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs91', 258)" onmouseover="showTip(event, 'fs91', 258)" class="i">mktModelErrors</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs85', 259)" onmouseover="showTip(event, 'fs85', 259)" class="i">weightedMktModelPairs</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 260)" onmouseover="showTip(event, 'fs12', 260)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 261)" onmouseover="showTip(event, 'fs51', 261)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs87', 262)" onmouseover="showTip(event, 'fs87', 262)" class="i">mkt</span>, <span onmouseout="hideTip(event, 'fs88', 263)" onmouseover="showTip(event, 'fs88', 263)" class="i">mdl</span>, <span onmouseout="hideTip(event, 'fs89', 264)" onmouseover="showTip(event, 'fs89', 264)" class="i">weight</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs89', 265)" onmouseover="showTip(event, 'fs89', 265)" class="i">weight</span> <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs87', 266)" onmouseover="showTip(event, 'fs87', 266)" class="i">mkt</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs88', 267)" onmouseover="showTip(event, 'fs88', 267)" class="i">mdl</span>) <span class="o">*</span> (<span onmouseout="hideTip(event, 'fs87', 268)" onmouseover="showTip(event, 'fs87', 268)" class="i">mkt</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs88', 269)" onmouseover="showTip(event, 'fs88', 269)" class="i">mdl</span>) )
    <span onmouseout="hideTip(event, 'fs12', 270)" onmouseover="showTip(event, 'fs12', 270)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs90', 271)" onmouseover="showTip(event, 'fs90', 271)" class="f">sum</span> <span onmouseout="hideTip(event, 'fs91', 272)" onmouseover="showTip(event, 'fs91', 272)" class="i">mktModelErrors</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs86', 273)" onmouseover="showTip(event, 'fs86', 273)" class="i">numWeightedPoints</span>



<span class="c">//To use an optimiser, we need to turn this into a function that returns &quot;extrapSqdError&quot; given the model parameters only.</span>
<span class="c">// i.e. we have a function that we want to minimise in value, by changing its input parameter</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs92', 274)" onmouseover="showTip(event, 'fs92', 274)" class="f">extrapSqdError</span> <span onmouseout="hideTip(event, 'fs40', 275)" onmouseover="showTip(event, 'fs40', 275)" class="i">modelParams</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs81', 276)" onmouseover="showTip(event, 'fs81', 276)" class="i">finalWeightedTarget</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs83', 277)" onmouseover="showTip(event, 'fs83', 277)" class="f">errorToMinimise</span> <span onmouseout="hideTip(event, 'fs40', 278)" onmouseover="showTip(event, 'fs40', 278)" class="i">modelParams</span> 

<span class="c">// Calculate the Error, based on the starting modelParams</span>
<span onmouseout="hideTip(event, 'fs92', 279)" onmouseover="showTip(event, 'fs92', 279)" class="f">extrapSqdError</span> <span onmouseout="hideTip(event, 'fs31', 280)" onmouseover="showTip(event, 'fs31', 280)" class="i">modelParamSeeds</span>


<span class="c">//let errorToMinimise modelParams = </span>


<span class="c">// We can plot the market points Vs the model values</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 281)" onmouseover="showTip(event, 'fs93', 281)" class="f">modelValuesAtMats</span> <span onmouseout="hideTip(event, 'fs40', 282)" onmouseover="showTip(event, 'fs40', 282)" class="i">modelParams</span> <span onmouseout="hideTip(event, 'fs94', 283)" onmouseover="showTip(event, 'fs94', 283)" class="i">marketPoints</span> <span onmouseout="hideTip(event, 'fs95', 284)" onmouseover="showTip(event, 'fs95', 284)" class="i">maturities</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs50', 285)" onmouseover="showTip(event, 'fs50', 285)" class="i">maxTerm</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs94', 286)" onmouseover="showTip(event, 'fs94', 286)" class="i">marketPoints</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 287)" onmouseover="showTip(event, 'fs12', 287)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 288)" onmouseover="showTip(event, 'fs51', 288)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 289)" onmouseover="showTip(event, 'fs14', 289)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs15', 290)" onmouseover="showTip(event, 'fs15', 290)" class="i">v</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 291)" onmouseover="showTip(event, 'fs14', 291)" class="i">t</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 292)" onmouseover="showTip(event, 'fs12', 292)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs52', 293)" onmouseover="showTip(event, 'fs52', 293)" class="f">max</span>  
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs96', 294)" onmouseover="showTip(event, 'fs96', 294)" class="i">newValues</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs95', 295)" onmouseover="showTip(event, 'fs95', 295)" class="i">maturities</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 296)" onmouseover="showTip(event, 'fs12', 296)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 297)" onmouseover="showTip(event, 'fs97', 297)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs14', 298)" onmouseover="showTip(event, 'fs14', 298)" class="i">t</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 299)" onmouseover="showTip(event, 'fs14', 299)" class="i">t</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs50', 300)" onmouseover="showTip(event, 'fs50', 300)" class="i">maxTerm</span>)  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 301)" onmouseover="showTip(event, 'fs12', 301)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 302)" onmouseover="showTip(event, 'fs51', 302)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 303)" onmouseover="showTip(event, 'fs14', 303)" class="i">t</span>) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs14', 304)" onmouseover="showTip(event, 'fs14', 304)" class="i">t</span>,  <span onmouseout="hideTip(event, 'fs39', 305)" onmouseover="showTip(event, 'fs39', 305)" class="f">modelImpliedVolatility</span> <span onmouseout="hideTip(event, 'fs40', 306)" onmouseover="showTip(event, 'fs40', 306)" class="i">modelParams</span> <span onmouseout="hideTip(event, 'fs14', 307)" onmouseover="showTip(event, 'fs14', 307)" class="i">t</span>))
    <span onmouseout="hideTip(event, 'fs94', 308)" onmouseover="showTip(event, 'fs94', 308)" class="i">marketPoints</span> <span class="o">@</span> <span onmouseout="hideTip(event, 'fs96', 309)" onmouseover="showTip(event, 'fs96', 309)" class="i">newValues</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs98', 310)" onmouseover="showTip(event, 'fs98', 310)" class="f">modelValues</span> <span onmouseout="hideTip(event, 'fs40', 311)" onmouseover="showTip(event, 'fs40', 311)" class="i">modelParams</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs93', 312)" onmouseover="showTip(event, 'fs93', 312)" class="f">modelValuesAtMats</span> <span onmouseout="hideTip(event, 'fs40', 313)" onmouseover="showTip(event, 'fs40', 313)" class="i">modelParams</span> <span onmouseout="hideTip(event, 'fs1', 314)" onmouseover="showTip(event, 'fs1', 314)" class="i">simpleTargetVols</span> <span onmouseout="hideTip(event, 'fs25', 315)" onmouseover="showTip(event, 'fs25', 315)" class="i">outMaturities</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs99', 316)" onmouseover="showTip(event, 'fs99', 316)" class="i">extrapModel</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs98', 317)" onmouseover="showTip(event, 'fs98', 317)" class="f">modelValues</span> <span onmouseout="hideTip(event, 'fs31', 318)" onmouseover="showTip(event, 'fs31', 318)" class="i">modelParamSeeds</span>


<span class="k">open</span> <span onmouseout="hideTip(event, 'fs100', 319)" onmouseover="showTip(event, 'fs100', 319)" class="i">XPlot</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs101', 320)" onmouseover="showTip(event, 'fs101', 320)" class="i">GoogleCharts</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs102', 321)" onmouseover="showTip(event, 'fs102', 321)" class="f">plotResult</span> <span onmouseout="hideTip(event, 'fs103', 322)" onmouseover="showTip(event, 'fs103', 322)" class="i">model</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs104', 323)" onmouseover="showTip(event, 'fs104', 323)" class="i">options</span> <span class="o">=</span>
        <span onmouseout="hideTip(event, 'fs105', 324)" onmouseover="showTip(event, 'fs105', 324)" class="t">Options</span>(
            <span class="i">title</span> <span class="o">=</span> <span class="s">&quot;Equity Extrapolation&quot;</span>,
            <span class="i">vAxis</span> <span class="o">=</span>
                <span onmouseout="hideTip(event, 'fs106', 325)" onmouseover="showTip(event, 'fs106', 325)" class="t">Axis</span>(
                    <span class="i">title</span> <span class="o">=</span> <span class="s">&quot;Implied Volatility&quot;</span>               
                ),
            <span class="i">hAxis</span> <span class="o">=</span>
                <span onmouseout="hideTip(event, 'fs106', 326)" onmouseover="showTip(event, 'fs106', 326)" class="t">Axis</span>(
                    <span class="i">title</span> <span class="o">=</span> <span class="s">&quot;Option Maturity&quot;</span>               
                )

        )
 

    [<span onmouseout="hideTip(event, 'fs103', 327)" onmouseover="showTip(event, 'fs103', 327)" class="i">model</span>; <span onmouseout="hideTip(event, 'fs1', 328)" onmouseover="showTip(event, 'fs1', 328)" class="i">simpleTargetVols</span>] 
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs107', 329)" onmouseover="showTip(event, 'fs107', 329)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs108', 330)" onmouseover="showTip(event, 'fs108', 330)" class="f">Scatter</span> 
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs107', 331)" onmouseover="showTip(event, 'fs107', 331)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs109', 332)" onmouseover="showTip(event, 'fs109', 332)" class="f">WithOptions</span> <span onmouseout="hideTip(event, 'fs104', 333)" onmouseover="showTip(event, 'fs104', 333)" class="i">options</span>
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs107', 334)" onmouseover="showTip(event, 'fs107', 334)" class="t">Chart</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs110', 335)" onmouseover="showTip(event, 'fs110', 335)" class="f">WithLabels</span> [<span class="s">&quot;Extrapolated Model&quot;</span>; <span class="s">&quot;Market&quot;</span>]

<span class="c">// plot the evaluated seeds</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs102', 336)" onmouseover="showTip(event, 'fs102', 336)" class="f">plotResult</span> <span onmouseout="hideTip(event, 'fs99', 337)" onmouseover="showTip(event, 'fs99', 337)" class="i">extrapModel</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output">
    <script type="text/javascript">
        google.setOnLoadCallback(drawChart);
            function drawChart() {
                var data = new google.visualization.DataTable({"cols": [{"type": "number" ,"id": "Column 1" ,"label": "Column 1" }, {"type": "number" ,"id": "Extrapolated Model" ,"label": "Extrapolated Model" }, {"type": "number" ,"id": "Market" ,"label": "Market" }], "rows" : [{"c" : [{"v": 0.25}, {"v": 0.18938213810157}, {"v": 0.18938213810157}]}, {"c" : [{"v": 0.5}, {"v": 0.192238397377696}, {"v": 0.192238397377696}]}, {"c" : [{"v": 0.75}, {"v": 0.194751728074236}, {"v": 0.194751728074236}]}, {"c" : [{"v": 1}, {"v": 0.19619340600353}, {"v": 0.19619340600353}]}, {"c" : [{"v": 2}, {"v": 0.192399997024925}, {"v": 0.192399997024925}]}, {"c" : [{"v": 3}, {"v": 0.191733301529111}, {"v": 0.191733301529111}]}, {"c" : [{"v": 4}, {"v": 0.189276479115615}, {"v": 0.189276479115615}]}, {"c" : [{"v": 5}, {"v": 0.18700481201725}, {"v": 0.18700481201725}]}, {"c" : [{"v": 7}, {"v": 0.179412496332435}, {"v": 0.179412496332435}]}, {"c" : [{"v": 10}, {"v": 0.169832870147339}, {"v": 0.169832870147339}]}, {"c" : [{"v": 15}, {"v": 0.299973674646545}, {}]}, {"c" : [{"v": 20}, {"v": 0.302282691062805}, {}]}, {"c" : [{"v": 25}, {"v": 0.303662239601065}, {}]}, {"c" : [{"v": 30}, {"v": 0.304578642279063}, {}]}, {"c" : [{"v": 40}, {"v": 0.305720305122686}, {}]}, {"c" : [{"v": 50}, {"v": 0.306403261810352}, {}]}]});

                var options = {"backgroundColor":{"fill":"transparent"},"chartArea":{"backgroundColor":{"fill":"#f4f4f4"}},"colors":["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],"hAxis":{"baselineColor":"#fdfdfd","gridlines":{"color":"#fdfdfd"},"textStyle":{"color":"black"},"title":"Option Maturity"},"legend":{"position":"right","textStyle":{"color":"black"}},"title":"Equity Extrapolation","titleTextStyle":{"color":"black"},"vAxis":{"baselineColor":"#fdfdfd","gridlines":{"color":"#fdfdfd"},"textStyle":{"color":"black"},"title":"Implied Volatility"},"datalessRegionColor":"#fdfdfd"} 

                var chart = new google.visualization.ScatterChart(document.getElementById('54ea272d-6eab-42df-ad67-23cd3c9c6304'));
                chart.draw(data, options);
            }
    </script>
    <div id="54ea272d-6eab-42df-ad67-23cd3c9c6304" style="width: 800px; height: 450px;"></div></div>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// show the initial solution, before we assess the cases</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs111', 338)" onmouseover="showTip(event, 'fs111', 338)" class="i">initialSolution</span> <span class="o">=</span> {<span class="i">sigmaZero</span> <span class="o">=</span> <span class="n">0.158840464328897</span>; <span class="i">sigmaInf</span> <span class="o">=</span> <span class="n">0.23184</span>; <span class="i">alpha</span> <span class="o">=</span> <span class="n">0.05</span> }

<span class="c">// show results for final answer</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs112', 339)" onmouseover="showTip(event, 'fs112', 339)" class="i">solution</span> <span class="o">=</span> {<span class="i">sigmaZero</span> <span class="o">=</span> <span class="n">0.158840464328897</span>; <span class="i">sigmaInf</span> <span class="o">=</span> <span class="n">0.23184</span>; <span class="i">alpha</span> <span class="o">=</span> <span class="n">0.05</span> }
<span onmouseout="hideTip(event, 'fs112', 340)" onmouseover="showTip(event, 'fs112', 340)" class="i">solution</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs98', 341)" onmouseover="showTip(event, 'fs98', 341)" class="f">modelValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs102', 342)" onmouseover="showTip(event, 'fs102', 342)" class="f">plotResult</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output">
    <script type="text/javascript">
        google.setOnLoadCallback(drawChart);
            function drawChart() {
                var data = new google.visualization.DataTable({"cols": [{"type": "number" ,"id": "Column 1" ,"label": "Column 1" }, {"type": "number" ,"id": "Extrapolated Model" ,"label": "Extrapolated Model" }, {"type": "number" ,"id": "Market" ,"label": "Market" }], "rows" : [{"c" : [{"v": 0.25}, {"v": 0.18938213810157}, {"v": 0.18938213810157}]}, {"c" : [{"v": 0.5}, {"v": 0.192238397377696}, {"v": 0.192238397377696}]}, {"c" : [{"v": 0.75}, {"v": 0.194751728074236}, {"v": 0.194751728074236}]}, {"c" : [{"v": 1}, {"v": 0.19619340600353}, {"v": 0.19619340600353}]}, {"c" : [{"v": 2}, {"v": 0.192399997024925}, {"v": 0.192399997024925}]}, {"c" : [{"v": 3}, {"v": 0.191733301529111}, {"v": 0.191733301529111}]}, {"c" : [{"v": 4}, {"v": 0.189276479115615}, {"v": 0.189276479115615}]}, {"c" : [{"v": 5}, {"v": 0.18700481201725}, {"v": 0.18700481201725}]}, {"c" : [{"v": 7}, {"v": 0.179412496332435}, {"v": 0.179412496332435}]}, {"c" : [{"v": 10}, {"v": 0.169832870147339}, {"v": 0.169832870147339}]}, {"c" : [{"v": 15}, {"v": 0.183537465975334}, {}]}, {"c" : [{"v": 20}, {"v": 0.189002719738603}, {}]}, {"c" : [{"v": 25}, {"v": 0.193574194377521}, {}]}, {"c" : [{"v": 30}, {"v": 0.19743141397333}, {}]}, {"c" : [{"v": 40}, {"v": 0.20351876117739}, {}]}, {"c" : [{"v": 50}, {"v": 0.208034606746245}, {}]}]});

                var options = {"backgroundColor":{"fill":"transparent"},"chartArea":{"backgroundColor":{"fill":"#f4f4f4"}},"colors":["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],"hAxis":{"baselineColor":"#fdfdfd","gridlines":{"color":"#fdfdfd"},"textStyle":{"color":"black"},"title":"Option Maturity"},"legend":{"position":"right","textStyle":{"color":"black"}},"title":"Equity Extrapolation","titleTextStyle":{"color":"black"},"vAxis":{"baselineColor":"#fdfdfd","gridlines":{"color":"#fdfdfd"},"textStyle":{"color":"black"},"title":"Implied Volatility"},"datalessRegionColor":"#fdfdfd"} 

                var chart = new google.visualization.ScatterChart(document.getElementById('cdd4782a-2ab6-4806-a325-1dfd9a98aa5d'));
                chart.draw(data, options);
            }
    </script>
    <div id="cdd4782a-2ab6-4806-a325-1dfd9a98aa5d" style="width: 800px; height: 450px;"></div></div>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Calculate the Error, based on the solution</span>
<span onmouseout="hideTip(event, 'fs92', 343)" onmouseover="showTip(event, 'fs92', 343)" class="f">extrapSqdError</span> <span onmouseout="hideTip(event, 'fs112', 344)" onmouseover="showTip(event, 'fs112', 344)" class="i">solution</span>
</code></pre></td>
</tr>
</table>
<a name="refitConditions"></a>
<h2>Refining the optimised solution</h2>
<p>To evaluate the solution, we need to evaluate properties about the fit.
We then can decide if we need to retry.</p>
<p>We can define our rounding functions we will use as follows, and test that they behave as expected.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 345)" onmouseover="showTip(event, 'fs113', 345)" class="f">nearest5</span>(<span onmouseout="hideTip(event, 'fs114', 346)" onmouseover="showTip(event, 'fs114', 346)" class="i">percentage</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs115', 347)" onmouseover="showTip(event, 'fs115', 347)" class="f">round</span>(<span class="n">20.0</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs114', 348)" onmouseover="showTip(event, 'fs114', 348)" class="i">percentage</span>) <span class="o">/</span> <span class="n">20.0</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs116', 349)" onmouseover="showTip(event, 'fs116', 349)" class="f">roundUpToNearest5</span> <span onmouseout="hideTip(event, 'fs114', 350)" onmouseover="showTip(event, 'fs114', 350)" class="i">percentage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs117', 351)" onmouseover="showTip(event, 'fs117', 351)" class="f">ceil</span>(<span class="n">20.0</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs114', 352)" onmouseover="showTip(event, 'fs114', 352)" class="i">percentage</span>) <span class="o">/</span> <span class="n">20.0</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs118', 353)" onmouseover="showTip(event, 'fs118', 353)" class="f">roundDownToNearest5</span> <span onmouseout="hideTip(event, 'fs114', 354)" onmouseover="showTip(event, 'fs114', 354)" class="i">percentage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs119', 355)" onmouseover="showTip(event, 'fs119', 355)" class="f">floor</span>(<span class="n">20.0</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs114', 356)" onmouseover="showTip(event, 'fs114', 356)" class="i">percentage</span>) <span class="o">/</span> <span class="n">20.0</span>


<span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 357)" onmouseover="showTip(event, 'fs120', 357)" class="i">testPercentages</span> <span class="o">=</span> [<span class="n">0.7</span>;<span class="n">0.72</span>;<span class="n">0.725</span>;<span class="n">0.73</span>;<span class="n">1.0</span>;<span class="n">1.02</span>;<span class="n">1.025</span>;<span class="n">1.03</span>;<span class="n">1.07</span>;<span class="n">1.08</span>;<span class="n">1.3</span>]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs121', 358)" onmouseover="showTip(event, 'fs121', 358)" class="i">testRoundDown</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 359)" onmouseover="showTip(event, 'fs12', 359)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 360)" onmouseover="showTip(event, 'fs51', 360)" class="f">map</span> <span onmouseout="hideTip(event, 'fs118', 361)" onmouseover="showTip(event, 'fs118', 361)" class="f">roundDownToNearest5</span> <span onmouseout="hideTip(event, 'fs120', 362)" onmouseover="showTip(event, 'fs120', 362)" class="i">testPercentages</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs122', 363)" onmouseover="showTip(event, 'fs122', 363)" class="i">testRoundUp</span>  <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 364)" onmouseover="showTip(event, 'fs12', 364)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 365)" onmouseover="showTip(event, 'fs51', 365)" class="f">map</span> <span onmouseout="hideTip(event, 'fs116', 366)" onmouseover="showTip(event, 'fs116', 366)" class="f">roundUpToNearest5</span> <span onmouseout="hideTip(event, 'fs120', 367)" onmouseover="showTip(event, 'fs120', 367)" class="i">testPercentages</span>
</code></pre></td>
</tr>
</table>
<p>Some properties will be described as small, i.e. less than a threshold.
If a number is NOT small, by this definition it is large.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// this is our definition of a small number - we can use this as an &quot;equals, within tolerance&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs123', 368)" onmouseover="showTip(event, 'fs123', 368)" class="i">tolerance</span> <span class="o">=</span> <span class="n">0.00001</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs124', 369)" onmouseover="showTip(event, 'fs124', 369)" class="f">withinTolerance</span> <span onmouseout="hideTip(event, 'fs125', 370)" onmouseover="showTip(event, 'fs125', 370)" class="i">x</span> <span onmouseout="hideTip(event, 'fs14', 371)" onmouseover="showTip(event, 'fs14', 371)" class="i">t</span> <span class="o">=</span>  <span onmouseout="hideTip(event, 'fs126', 372)" onmouseover="showTip(event, 'fs126', 372)" class="f">abs</span> <span onmouseout="hideTip(event, 'fs125', 373)" onmouseover="showTip(event, 'fs125', 373)" class="i">x</span> <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs14', 374)" onmouseover="showTip(event, 'fs14', 374)" class="i">t</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs127', 375)" onmouseover="showTip(event, 'fs127', 375)" class="f">isSmall</span> <span onmouseout="hideTip(event, 'fs125', 376)" onmouseover="showTip(event, 'fs125', 376)" class="i">x</span> <span class="o">=</span>  <span onmouseout="hideTip(event, 'fs124', 377)" onmouseover="showTip(event, 'fs124', 377)" class="f">withinTolerance</span> <span onmouseout="hideTip(event, 'fs125', 378)" onmouseover="showTip(event, 'fs125', 378)" class="i">x</span> <span onmouseout="hideTip(event, 'fs123', 379)" onmouseover="showTip(event, 'fs123', 379)" class="i">tolerance</span>
</code></pre></td>
</tr>
</table>
<p>We will test the gradient between the market data points.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 380)" onmouseover="showTip(event, 'fs128', 380)" class="i">termDeltas</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 381)" onmouseover="showTip(event, 'fs1', 381)" class="i">simpleTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 382)" onmouseover="showTip(event, 'fs12', 382)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs54', 383)" onmouseover="showTip(event, 'fs54', 383)" class="f">pairwise</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 384)" onmouseover="showTip(event, 'fs12', 384)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 385)" onmouseover="showTip(event, 'fs51', 385)" class="f">map</span> (<span class="k">fun</span> ((<span onmouseout="hideTip(event, 'fs55', 386)" onmouseover="showTip(event, 'fs55', 386)" class="i">t1</span>, <span onmouseout="hideTip(event, 'fs56', 387)" onmouseover="showTip(event, 'fs56', 387)" class="i">v1</span>),(<span onmouseout="hideTip(event, 'fs57', 388)" onmouseover="showTip(event, 'fs57', 388)" class="i">t2</span>, <span onmouseout="hideTip(event, 'fs58', 389)" onmouseover="showTip(event, 'fs58', 389)" class="i">v2</span>)) <span class="k">-&gt;</span> (<span onmouseout="hideTip(event, 'fs55', 390)" onmouseover="showTip(event, 'fs55', 390)" class="i">t1</span>, (<span onmouseout="hideTip(event, 'fs58', 391)" onmouseover="showTip(event, 'fs58', 391)" class="i">v2</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs56', 392)" onmouseover="showTip(event, 'fs56', 392)" class="i">v1</span>) <span class="o">/</span> (<span class="i">t2</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs55', 393)" onmouseover="showTip(event, 'fs55', 393)" class="i">t1</span>)) ) 

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 394)" onmouseover="showTip(event, 'fs129', 394)" class="i">isLastMarketGradientSmall</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs128', 395)" onmouseover="showTip(event, 'fs128', 395)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 396)" onmouseover="showTip(event, 'fs12', 396)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 397)" onmouseover="showTip(event, 'fs60', 397)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 398)" onmouseover="showTip(event, 'fs12', 398)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 399)" onmouseover="showTip(event, 'fs61', 399)" class="f">head</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 400)" onmouseover="showTip(event, 'fs16', 400)" class="f">snd</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs127', 401)" onmouseover="showTip(event, 'fs127', 401)" class="f">isSmall</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 402)" onmouseover="showTip(event, 'fs130', 402)" class="i">isPenultimateMarketGradientSmall</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs128', 403)" onmouseover="showTip(event, 'fs128', 403)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 404)" onmouseover="showTip(event, 'fs12', 404)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 405)" onmouseover="showTip(event, 'fs60', 405)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 406)" onmouseover="showTip(event, 'fs12', 406)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs63', 407)" onmouseover="showTip(event, 'fs63', 407)" class="f">item</span> <span class="n">2</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 408)" onmouseover="showTip(event, 'fs16', 408)" class="f">snd</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs127', 409)" onmouseover="showTip(event, 'fs127', 409)" class="f">isSmall</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs131', 410)" onmouseover="showTip(event, 'fs131', 410)" class="i">isLastMarketGradientPositive</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs128', 411)" onmouseover="showTip(event, 'fs128', 411)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 412)" onmouseover="showTip(event, 'fs12', 412)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 413)" onmouseover="showTip(event, 'fs60', 413)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 414)" onmouseover="showTip(event, 'fs12', 414)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 415)" onmouseover="showTip(event, 'fs61', 415)" class="f">head</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 416)" onmouseover="showTip(event, 'fs16', 416)" class="f">snd</span> <span class="o">&gt;</span> <span class="n">0.0</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs132', 417)" onmouseover="showTip(event, 'fs132', 417)" class="i">isLastMarketGradientStrictlyPositive</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs128', 418)" onmouseover="showTip(event, 'fs128', 418)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 419)" onmouseover="showTip(event, 'fs12', 419)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 420)" onmouseover="showTip(event, 'fs60', 420)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 421)" onmouseover="showTip(event, 'fs12', 421)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 422)" onmouseover="showTip(event, 'fs61', 422)" class="f">head</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 423)" onmouseover="showTip(event, 'fs16', 423)" class="f">snd</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">0.0015</span> <span class="c">//can&#39;t see this number in the spec</span>


<span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 424)" onmouseover="showTip(event, 'fs133', 424)" class="i">areFinalMarketPointsSlopingUpward</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs128', 425)" onmouseover="showTip(event, 'fs128', 425)" class="i">termDeltas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 426)" onmouseover="showTip(event, 'fs12', 426)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 427)" onmouseover="showTip(event, 'fs60', 427)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 428)" onmouseover="showTip(event, 'fs12', 428)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 429)" onmouseover="showTip(event, 'fs61', 429)" class="f">head</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs16', 430)" onmouseover="showTip(event, 'fs16', 430)" class="f">snd</span> <span class="o">&gt;</span> <span class="n">0.0</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs134', 431)" onmouseover="showTip(event, 'fs134', 431)" class="i">areFinalMarketPointsSlopingDownward</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 432)" onmouseover="showTip(event, 'fs135', 432)" class="f">not</span> <span onmouseout="hideTip(event, 'fs133', 433)" onmouseover="showTip(event, 'fs133', 433)" class="i">areFinalMarketPointsSlopingUpward</span>
</code></pre></td>
</tr>
</table>
<p>Analyse the market data for a V-shape</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs136', 434)" onmouseover="showTip(event, 'fs136', 434)" class="i">lastMarketPoint</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 435)" onmouseover="showTip(event, 'fs1', 435)" class="i">simpleTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 436)" onmouseover="showTip(event, 'fs12', 436)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 437)" onmouseover="showTip(event, 'fs60', 437)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 438)" onmouseover="showTip(event, 'fs12', 438)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 439)" onmouseover="showTip(event, 'fs61', 439)" class="f">head</span> 
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs137', 440)" onmouseover="showTip(event, 'fs137', 440)" class="i">secondLastMarketPoint</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 441)" onmouseover="showTip(event, 'fs1', 441)" class="i">simpleTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 442)" onmouseover="showTip(event, 'fs12', 442)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 443)" onmouseover="showTip(event, 'fs60', 443)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 444)" onmouseover="showTip(event, 'fs12', 444)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs138', 445)" onmouseover="showTip(event, 'fs138', 445)" class="f">skip</span> <span class="n">1</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 446)" onmouseover="showTip(event, 'fs12', 446)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 447)" onmouseover="showTip(event, 'fs61', 447)" class="f">head</span> 
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs139', 448)" onmouseover="showTip(event, 'fs139', 448)" class="i">thirdLastMarketPoint</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 449)" onmouseover="showTip(event, 'fs1', 449)" class="i">simpleTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 450)" onmouseover="showTip(event, 'fs12', 450)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs60', 451)" onmouseover="showTip(event, 'fs60', 451)" class="f">rev</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 452)" onmouseover="showTip(event, 'fs12', 452)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs138', 453)" onmouseover="showTip(event, 'fs138', 453)" class="f">skip</span> <span class="n">2</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 454)" onmouseover="showTip(event, 'fs12', 454)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 455)" onmouseover="showTip(event, 'fs61', 455)" class="f">head</span> 

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs140', 456)" onmouseover="showTip(event, 'fs140', 456)" class="i">isVPresent</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs16', 457)" onmouseover="showTip(event, 'fs16', 457)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs139', 458)" onmouseover="showTip(event, 'fs139', 458)" class="i">thirdLastMarketPoint</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs16', 459)" onmouseover="showTip(event, 'fs16', 459)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs137', 460)" onmouseover="showTip(event, 'fs137', 460)" class="i">secondLastMarketPoint</span>) <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs123', 461)" onmouseover="showTip(event, 'fs123', 461)" class="i">tolerance</span> <span class="o">&amp;&amp;</span> (<span onmouseout="hideTip(event, 'fs16', 462)" onmouseover="showTip(event, 'fs16', 462)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs137', 463)" onmouseover="showTip(event, 'fs137', 463)" class="i">secondLastMarketPoint</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs16', 464)" onmouseover="showTip(event, 'fs16', 464)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs136', 465)" onmouseover="showTip(event, 'fs136', 465)" class="i">lastMarketPoint</span>) <span class="o">&lt;</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs123', 466)" onmouseover="showTip(event, 'fs123', 466)" class="i">tolerance</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs141', 467)" onmouseover="showTip(event, 'fs141', 467)" class="i">isMarketThirdLastLargerThanSecondLast</span>  <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs16', 468)" onmouseover="showTip(event, 'fs16', 468)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs139', 469)" onmouseover="showTip(event, 'fs139', 469)" class="i">thirdLastMarketPoint</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs16', 470)" onmouseover="showTip(event, 'fs16', 470)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs137', 471)" onmouseover="showTip(event, 'fs137', 471)" class="i">secondLastMarketPoint</span>)  <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs123', 472)" onmouseover="showTip(event, 'fs123', 472)" class="i">tolerance</span>
</code></pre></td>
</tr>
</table>
<p>Short-end behavior</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs142', 473)" onmouseover="showTip(event, 'fs142', 473)" class="i">oneYearMarketAverage</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs1', 474)" onmouseover="showTip(event, 'fs1', 474)" class="i">simpleTargetVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 475)" onmouseover="showTip(event, 'fs12', 475)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 476)" onmouseover="showTip(event, 'fs97', 476)" class="f">filter</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 477)" onmouseover="showTip(event, 'fs14', 477)" class="i">t</span>,<span onmouseout="hideTip(event, 'fs15', 478)" onmouseover="showTip(event, 'fs15', 478)" class="i">v</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs14', 479)" onmouseover="showTip(event, 'fs14', 479)" class="i">t</span> <span class="o">&lt;=</span> <span class="n">1.0</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 480)" onmouseover="showTip(event, 'fs12', 480)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs143', 481)" onmouseover="showTip(event, 'fs143', 481)" class="f">averageBy</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs14', 482)" onmouseover="showTip(event, 'fs14', 482)" class="i">t</span>,<span onmouseout="hideTip(event, 'fs15', 483)" onmouseover="showTip(event, 'fs15', 483)" class="i">v</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs15', 484)" onmouseover="showTip(event, 'fs15', 484)" class="i">v</span>)
</code></pre></td>
</tr>
</table>
<p>Long-end behavior</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs144', 485)" onmouseover="showTip(event, 'fs144', 485)" class="i">isLastMarketDataPointBelowStartingMin</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs16', 486)" onmouseover="showTip(event, 'fs16', 486)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs136', 487)" onmouseover="showTip(event, 'fs136', 487)" class="i">lastMarketPoint</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs18', 488)" onmouseover="showTip(event, 'fs18', 488)" class="i">minLimit</span>) <span class="o">&lt;</span> <span class="o">-</span><span onmouseout="hideTip(event, 'fs123', 489)" onmouseover="showTip(event, 'fs123', 489)" class="i">tolerance</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs145', 490)" onmouseover="showTip(event, 'fs145', 490)" class="i">isLastMarketDataPointAboveStartingMin</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 491)" onmouseover="showTip(event, 'fs135', 491)" class="f">not</span> <span onmouseout="hideTip(event, 'fs144', 492)" onmouseover="showTip(event, 'fs144', 492)" class="i">isLastMarketDataPointBelowStartingMin</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs146', 493)" onmouseover="showTip(event, 'fs146', 493)" class="i">isLastMarketDataPointLessThanSigmaInf</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs16', 494)" onmouseover="showTip(event, 'fs16', 494)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs136', 495)" onmouseover="showTip(event, 'fs136', 495)" class="i">lastMarketPoint</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs112', 496)" onmouseover="showTip(event, 'fs112', 496)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 497)" onmouseover="showTip(event, 'fs29', 497)" class="i">sigmaInf</span>) <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs123', 498)" onmouseover="showTip(event, 'fs123', 498)" class="i">tolerance</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs147', 499)" onmouseover="showTip(event, 'fs147', 499)" class="i">isLastMarketDataPointGreaterThanSigmaInf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 500)" onmouseover="showTip(event, 'fs135', 500)" class="f">not</span> <span onmouseout="hideTip(event, 'fs146', 501)" onmouseover="showTip(event, 'fs146', 501)" class="i">isLastMarketDataPointLessThanSigmaInf</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs148', 502)" onmouseover="showTip(event, 'fs148', 502)" class="i">isAlphaOnTheLowerBound</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs127', 503)" onmouseover="showTip(event, 'fs127', 503)" class="f">isSmall</span> (<span onmouseout="hideTip(event, 'fs112', 504)" onmouseover="showTip(event, 'fs112', 504)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 505)" onmouseover="showTip(event, 'fs30', 505)" class="i">alpha</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs23', 506)" onmouseover="showTip(event, 'fs23', 506)" class="i">seedAlphaLowerBound</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs149', 507)" onmouseover="showTip(event, 'fs149', 507)" class="i">isSigmaInfAtTheMinLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs127', 508)" onmouseover="showTip(event, 'fs127', 508)" class="f">isSmall</span> (<span onmouseout="hideTip(event, 'fs112', 509)" onmouseover="showTip(event, 'fs112', 509)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 510)" onmouseover="showTip(event, 'fs29', 510)" class="i">sigmaInf</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs18', 511)" onmouseover="showTip(event, 'fs18', 511)" class="i">minLimit</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs150', 512)" onmouseover="showTip(event, 'fs150', 512)" class="i">isSigmaInfAtTheMaxLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs127', 513)" onmouseover="showTip(event, 'fs127', 513)" class="f">isSmall</span> (<span onmouseout="hideTip(event, 'fs112', 514)" onmouseover="showTip(event, 'fs112', 514)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 515)" onmouseover="showTip(event, 'fs29', 515)" class="i">sigmaInf</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs17', 516)" onmouseover="showTip(event, 'fs17', 516)" class="i">maxLimit</span>)

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs151', 517)" onmouseover="showTip(event, 'fs151', 517)" class="i">isAlphaLargerThanTheLB</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs112', 518)" onmouseover="showTip(event, 'fs112', 518)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 519)" onmouseover="showTip(event, 'fs30', 519)" class="i">alpha</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs23', 520)" onmouseover="showTip(event, 'fs23', 520)" class="i">seedAlphaLowerBound</span>) <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs123', 521)" onmouseover="showTip(event, 'fs123', 521)" class="i">tolerance</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs152', 522)" onmouseover="showTip(event, 'fs152', 522)" class="i">isSigmaInfAboveTheMinLimit</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs112', 523)" onmouseover="showTip(event, 'fs112', 523)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 524)" onmouseover="showTip(event, 'fs29', 524)" class="i">sigmaInf</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs18', 525)" onmouseover="showTip(event, 'fs18', 525)" class="i">minLimit</span>) <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs123', 526)" onmouseover="showTip(event, 'fs123', 526)" class="i">tolerance</span> <span class="c">// does the &quot;Max Limit&quot; move?</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs153', 527)" onmouseover="showTip(event, 'fs153', 527)" class="i">isSigmaInfAboveTheMaxLimit</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs112', 528)" onmouseover="showTip(event, 'fs112', 528)" class="i">solution</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs29', 529)" onmouseover="showTip(event, 'fs29', 529)" class="i">sigmaInf</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs17', 530)" onmouseover="showTip(event, 'fs17', 530)" class="i">maxLimit</span>) <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs123', 531)" onmouseover="showTip(event, 'fs123', 531)" class="i">tolerance</span> <span class="c">// does the &quot;Max Limit&quot; move?</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs154', 532)" onmouseover="showTip(event, 'fs154', 532)" class="i">isSigmaInfBelowTheMinLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 533)" onmouseover="showTip(event, 'fs135', 533)" class="f">not</span> <span onmouseout="hideTip(event, 'fs152', 534)" onmouseover="showTip(event, 'fs152', 534)" class="i">isSigmaInfAboveTheMinLimit</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs155', 535)" onmouseover="showTip(event, 'fs155', 535)" class="i">isSigmaInfBelowTheMaxLimit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 536)" onmouseover="showTip(event, 'fs135', 536)" class="f">not</span> <span onmouseout="hideTip(event, 'fs153', 537)" onmouseover="showTip(event, 'fs153', 537)" class="i">isSigmaInfAboveTheMaxLimit</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs156', 538)" onmouseover="showTip(event, 'fs156', 538)" class="i">isLastMarketGradientLarge</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 539)" onmouseover="showTip(event, 'fs135', 539)" class="f">not</span> <span onmouseout="hideTip(event, 'fs129', 540)" onmouseover="showTip(event, 'fs129', 540)" class="i">isLastMarketGradientSmall</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs157', 541)" onmouseover="showTip(event, 'fs157', 541)" class="i">isPenultimateMarketGradientLarge</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 542)" onmouseover="showTip(event, 'fs135', 542)" class="f">not</span> <span onmouseout="hideTip(event, 'fs130', 543)" onmouseover="showTip(event, 'fs130', 543)" class="i">isPenultimateMarketGradientSmall</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs158', 544)" onmouseover="showTip(event, 'fs158', 544)" class="i">weSayTheMarketIsUpwardSloping</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs142', 545)" onmouseover="showTip(event, 'fs142', 545)" class="i">oneYearMarketAverage</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs16', 546)" onmouseover="showTip(event, 'fs16', 546)" class="f">snd</span> <span onmouseout="hideTip(event, 'fs136', 547)" onmouseover="showTip(event, 'fs136', 547)" class="i">lastMarketPoint</span>) <span class="o">&lt;</span> <span onmouseout="hideTip(event, 'fs123', 548)" onmouseover="showTip(event, 'fs123', 548)" class="i">tolerance</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs159', 549)" onmouseover="showTip(event, 'fs159', 549)" class="i">weSayTheMarketIsDownwardSloping</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs135', 550)" onmouseover="showTip(event, 'fs135', 550)" class="f">not</span> <span onmouseout="hideTip(event, 'fs158', 551)" onmouseover="showTip(event, 'fs158', 551)" class="i">weSayTheMarketIsUpwardSloping</span>
</code></pre></td>
</tr>
</table>
<p>We can now try to evaluate what "case" we have produced, and decide if there is to be any adjustments and refitting done.</p>
<p>There is an orignial case, where if the extrapolated value exceeds the max limit, we add the max limit as a target point and weight it.
Is this even possible, given the constraints?</p>
<p>Otherwise, we can identify the cases as specified in the documentation and revised excel tool code.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs160', 552)" onmouseover="showTip(event, 'fs160', 552)" class="i">isCase11</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs129', 553)" onmouseover="showTip(event, 'fs129', 553)" class="i">isLastMarketGradientSmall</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs131', 554)" onmouseover="showTip(event, 'fs131', 554)" class="i">isLastMarketGradientPositive</span>) <span class="o">||</span> <span onmouseout="hideTip(event, 'fs130', 555)" onmouseover="showTip(event, 'fs130', 555)" class="i">isPenultimateMarketGradientSmall</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs161', 556)" onmouseover="showTip(event, 'fs161', 556)" class="i">isCase12</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 557)" onmouseover="showTip(event, 'fs144', 557)" class="i">isLastMarketDataPointBelowStartingMin</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs151', 558)" onmouseover="showTip(event, 'fs151', 558)" class="i">isAlphaLargerThanTheLB</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs152', 559)" onmouseover="showTip(event, 'fs152', 559)" class="i">isSigmaInfAboveTheMinLimit</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs140', 560)" onmouseover="showTip(event, 'fs140', 560)" class="i">isVPresent</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs156', 561)" onmouseover="showTip(event, 'fs156', 561)" class="i">isLastMarketGradientLarge</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs157', 562)" onmouseover="showTip(event, 'fs157', 562)" class="i">isPenultimateMarketGradientLarge</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs162', 563)" onmouseover="showTip(event, 'fs162', 563)" class="i">isCase13</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs133', 564)" onmouseover="showTip(event, 'fs133', 564)" class="i">areFinalMarketPointsSlopingUpward</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs144', 565)" onmouseover="showTip(event, 'fs144', 565)" class="i">isLastMarketDataPointBelowStartingMin</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs148', 566)" onmouseover="showTip(event, 'fs148', 566)" class="i">isAlphaOnTheLowerBound</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs149', 567)" onmouseover="showTip(event, 'fs149', 567)" class="i">isSigmaInfAtTheMinLimit</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs156', 568)" onmouseover="showTip(event, 'fs156', 568)" class="i">isLastMarketGradientLarge</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs157', 569)" onmouseover="showTip(event, 'fs157', 569)" class="i">isPenultimateMarketGradientLarge</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs163', 570)" onmouseover="showTip(event, 'fs163', 570)" class="i">isCase2</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs133', 571)" onmouseover="showTip(event, 'fs133', 571)" class="i">areFinalMarketPointsSlopingUpward</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs146', 572)" onmouseover="showTip(event, 'fs146', 572)" class="i">isLastMarketDataPointLessThanSigmaInf</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs150', 573)" onmouseover="showTip(event, 'fs150', 573)" class="i">isSigmaInfAtTheMaxLimit</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs145', 574)" onmouseover="showTip(event, 'fs145', 574)" class="i">isLastMarketDataPointAboveStartingMin</span>  <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs156', 575)" onmouseover="showTip(event, 'fs156', 575)" class="i">isLastMarketGradientLarge</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs157', 576)" onmouseover="showTip(event, 'fs157', 576)" class="i">isPenultimateMarketGradientLarge</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs164', 577)" onmouseover="showTip(event, 'fs164', 577)" class="i">isCase321</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs134', 578)" onmouseover="showTip(event, 'fs134', 578)" class="i">areFinalMarketPointsSlopingDownward</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs159', 579)" onmouseover="showTip(event, 'fs159', 579)" class="i">weSayTheMarketIsDownwardSloping</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs146', 580)" onmouseover="showTip(event, 'fs146', 580)" class="i">isLastMarketDataPointLessThanSigmaInf</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs165', 581)" onmouseover="showTip(event, 'fs165', 581)" class="i">isCase322</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs134', 582)" onmouseover="showTip(event, 'fs134', 582)" class="i">areFinalMarketPointsSlopingDownward</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs158', 583)" onmouseover="showTip(event, 'fs158', 583)" class="i">weSayTheMarketIsUpwardSloping</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs147', 584)" onmouseover="showTip(event, 'fs147', 584)" class="i">isLastMarketDataPointGreaterThanSigmaInf</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs166', 585)" onmouseover="showTip(event, 'fs166', 585)" class="i">isCase311</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs134', 586)" onmouseover="showTip(event, 'fs134', 586)" class="i">areFinalMarketPointsSlopingDownward</span>  <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs158', 587)" onmouseover="showTip(event, 'fs158', 587)" class="i">weSayTheMarketIsUpwardSloping</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs146', 588)" onmouseover="showTip(event, 'fs146', 588)" class="i">isLastMarketDataPointLessThanSigmaInf</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs141', 589)" onmouseover="showTip(event, 'fs141', 589)" class="i">isMarketThirdLastLargerThanSecondLast</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs167', 590)" onmouseover="showTip(event, 'fs167', 590)" class="i">isCase312</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs134', 591)" onmouseover="showTip(event, 'fs134', 591)" class="i">areFinalMarketPointsSlopingDownward</span>  <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs158', 592)" onmouseover="showTip(event, 'fs158', 592)" class="i">weSayTheMarketIsUpwardSloping</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs146', 593)" onmouseover="showTip(event, 'fs146', 593)" class="i">isLastMarketDataPointLessThanSigmaInf</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs154', 594)" onmouseover="showTip(event, 'fs154', 594)" class="i">isSigmaInfBelowTheMinLimit</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs132', 595)" onmouseover="showTip(event, 'fs132', 595)" class="i">isLastMarketGradientStrictlyPositive</span>

<span class="c">//Final case is if we have not reached any other case, plus the extra condition &quot;isSigmaInfAtTheMinLimit&quot;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs168', 596)" onmouseover="showTip(event, 'fs168', 596)" class="i">isCase14</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 597)" onmouseover="showTip(event, 'fs12', 597)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs169', 598)" onmouseover="showTip(event, 'fs169', 598)" class="f">forall</span> (<span onmouseout="hideTip(event, 'fs135', 599)" onmouseover="showTip(event, 'fs135', 599)" class="f">not</span>) [<span onmouseout="hideTip(event, 'fs160', 600)" onmouseover="showTip(event, 'fs160', 600)" class="i">isCase11</span>;<span onmouseout="hideTip(event, 'fs161', 601)" onmouseover="showTip(event, 'fs161', 601)" class="i">isCase12</span>;<span onmouseout="hideTip(event, 'fs162', 602)" onmouseover="showTip(event, 'fs162', 602)" class="i">isCase13</span>;<span onmouseout="hideTip(event, 'fs163', 603)" onmouseover="showTip(event, 'fs163', 603)" class="i">isCase2</span>;<span onmouseout="hideTip(event, 'fs166', 604)" onmouseover="showTip(event, 'fs166', 604)" class="i">isCase311</span>;<span onmouseout="hideTip(event, 'fs167', 605)" onmouseover="showTip(event, 'fs167', 605)" class="i">isCase312</span>;<span onmouseout="hideTip(event, 'fs164', 606)" onmouseover="showTip(event, 'fs164', 606)" class="i">isCase321</span>;<span onmouseout="hideTip(event, 'fs165', 607)" onmouseover="showTip(event, 'fs165', 607)" class="i">isCase322</span>] <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs149', 608)" onmouseover="showTip(event, 'fs149', 608)" class="i">isSigmaInfAtTheMinLimit</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs170', 609)" onmouseover="showTip(event, 'fs170', 609)" class="i">caseList</span> <span class="o">=</span> [<span class="s">&quot;Case11&quot;</span>;<span class="s">&quot;Case12&quot;</span>;<span class="s">&quot;Case13&quot;</span>;<span class="s">&quot;Case2&quot;</span>;<span class="s">&quot;Case311&quot;</span>;<span class="s">&quot;Case312&quot;</span>;<span class="s">&quot;Case321&quot;</span>;<span class="s">&quot;Case322&quot;</span>;<span class="s">&quot;Case14&quot;</span>;<span class="s">&quot;noAdjustmentCase&quot;</span>]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs171', 610)" onmouseover="showTip(event, 'fs171', 610)" class="i">isCaseList</span> <span class="o">=</span> [<span onmouseout="hideTip(event, 'fs160', 611)" onmouseover="showTip(event, 'fs160', 611)" class="i">isCase11</span>;<span onmouseout="hideTip(event, 'fs161', 612)" onmouseover="showTip(event, 'fs161', 612)" class="i">isCase12</span>;<span onmouseout="hideTip(event, 'fs162', 613)" onmouseover="showTip(event, 'fs162', 613)" class="i">isCase13</span>;<span onmouseout="hideTip(event, 'fs163', 614)" onmouseover="showTip(event, 'fs163', 614)" class="i">isCase2</span>;<span onmouseout="hideTip(event, 'fs166', 615)" onmouseover="showTip(event, 'fs166', 615)" class="i">isCase311</span>;<span onmouseout="hideTip(event, 'fs167', 616)" onmouseover="showTip(event, 'fs167', 616)" class="i">isCase312</span>;<span onmouseout="hideTip(event, 'fs164', 617)" onmouseover="showTip(event, 'fs164', 617)" class="i">isCase321</span>;<span onmouseout="hideTip(event, 'fs165', 618)" onmouseover="showTip(event, 'fs165', 618)" class="i">isCase322</span>;<span onmouseout="hideTip(event, 'fs168', 619)" onmouseover="showTip(event, 'fs168', 619)" class="i">isCase14</span>;<span class="k">true</span>]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs172', 620)" onmouseover="showTip(event, 'fs172', 620)" class="i">caseMap</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 621)" onmouseover="showTip(event, 'fs12', 621)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs173', 622)" onmouseover="showTip(event, 'fs173', 622)" class="f">zip</span> <span onmouseout="hideTip(event, 'fs170', 623)" onmouseover="showTip(event, 'fs170', 623)" class="i">caseList</span> <span onmouseout="hideTip(event, 'fs171', 624)" onmouseover="showTip(event, 'fs171', 624)" class="i">isCaseList</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs174', 625)" onmouseover="showTip(event, 'fs174', 625)" class="i">thisCaseIs</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs172', 626)" onmouseover="showTip(event, 'fs172', 626)" class="i">caseMap</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs12', 627)" onmouseover="showTip(event, 'fs12', 627)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs175', 628)" onmouseover="showTip(event, 'fs175', 628)" class="f">find</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs176', 629)" onmouseover="showTip(event, 'fs176', 629)" class="i">k</span>, <span onmouseout="hideTip(event, 'fs177', 630)" onmouseover="showTip(event, 'fs177', 630)" class="i">v</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs177', 631)" onmouseover="showTip(event, 'fs177', 631)" class="i">v</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs65', 632)" onmouseover="showTip(event, 'fs65', 632)" class="f">fst</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs178', 633)" onmouseover="showTip(event, 'fs178', 633)" class="f">doTheCase</span> <span onmouseout="hideTip(event, 'fs179', 634)" onmouseover="showTip(event, 'fs179', 634)" class="i">caseIs</span> <span class="o">=</span> 
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs179', 635)" onmouseover="showTip(event, 'fs179', 635)" class="i">caseIs</span> <span class="k">with</span>
    | <span class="s">&quot;Case11&quot;</span> <span class="k">-&gt;</span> ()
    | _ <span class="k">-&gt;</span> ()
             
</code></pre></td>
</tr>
</table>
<div class="tip" id="fs1">val simpleTargetVols : (float * float) list<br /><br />Full name: ExtrapolationExample.simpleTargetVols</div>
<div class="tip" id="fs2">val UncVolLimit : float<br /><br />Full name: ExtrapolationExample.UncVolLimit</div>
<div class="tip" id="fs3">val automaticIncreaseMaxFactor : bool<br /><br />Full name: ExtrapolationExample.automaticIncreaseMaxFactor</div>
<div class="tip" id="fs4">val maxFactorIncrease : float<br /><br />Full name: ExtrapolationExample.maxFactorIncrease</div>
<div class="tip" id="fs5">val weightsDecayFactor : float<br /><br />Full name: ExtrapolationExample.weightsDecayFactor</div>
<div class="tip" id="fs6">val seedMinFactor : float<br /><br />Full name: ExtrapolationExample.seedMinFactor</div>
<div class="tip" id="fs7">val initialSeedMaxFactor : float<br /><br />Full name: ExtrapolationExample.initialSeedMaxFactor</div>
<div class="tip" id="fs8">val seedAlpha : float<br /><br />Full name: ExtrapolationExample.seedAlpha</div>
<div class="tip" id="fs9">val seedMaxFactor : float<br /><br />Full name: ExtrapolationExample.seedMaxFactor</div>
<div class="tip" id="fs10">val initialMaxLimit : float</div>
<div class="tip" id="fs11">val actualFactorIncrease : float</div>
<div class="tip" id="fs12">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs13">val maxBy : projection:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.List.maxBy</div>
<div class="tip" id="fs14">val t : float</div>
<div class="tip" id="fs15">val v : float</div>
<div class="tip" id="fs16">val snd : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T2<br /><br />Full name: Microsoft.FSharp.Core.Operators.snd</div>
<div class="tip" id="fs17">val maxLimit : float<br /><br />Full name: ExtrapolationExample.maxLimit</div>
<div class="tip" id="fs18">val minLimit : float<br /><br />Full name: ExtrapolationExample.minLimit</div>
<div class="tip" id="fs19">val seedSigmaZeroLowerBound : float<br /><br />Full name: ExtrapolationExample.seedSigmaZeroLowerBound</div>
<div class="tip" id="fs20">val seedSigmaZeroUpperBound : float<br /><br />Full name: ExtrapolationExample.seedSigmaZeroUpperBound</div>
<div class="tip" id="fs21">val seedSigmaInfLowerBound : float<br /><br />Full name: ExtrapolationExample.seedSigmaInfLowerBound</div>
<div class="tip" id="fs22">val seedSigmaInfUpperBound : float<br /><br />Full name: ExtrapolationExample.seedSigmaInfUpperBound</div>
<div class="tip" id="fs23">val seedAlphaLowerBound : float<br /><br />Full name: ExtrapolationExample.seedAlphaLowerBound</div>
<div class="tip" id="fs24">val seedAlphaUpperBound : float<br /><br />Full name: ExtrapolationExample.seedAlphaUpperBound</div>
<div class="tip" id="fs25">val outMaturities : float list<br /><br />Full name: ExtrapolationExample.outMaturities</div>
<div class="tip" id="fs26">type ModelParams =<br />&#160;&#160;{sigmaZero: float;<br />&#160;&#160;&#160;sigmaInf: float;<br />&#160;&#160;&#160;alpha: float;}<br /><br />Full name: ExtrapolationExample.ModelParams</div>
<div class="tip" id="fs27">ModelParams.sigmaZero: float</div>
<div class="tip" id="fs28">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = System.Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs29">ModelParams.sigmaInf: float</div>
<div class="tip" id="fs30">ModelParams.alpha: float</div>
<div class="tip" id="fs31">val modelParamSeeds : ModelParams<br /><br />Full name: ExtrapolationExample.modelParamSeeds</div>
<div class="tip" id="fs32">val seedsLowerBound : ModelParams<br /><br />Full name: ExtrapolationExample.seedsLowerBound</div>
<div class="tip" id="fs33">val seedsUpperBound : ModelParams<br /><br />Full name: ExtrapolationExample.seedsUpperBound</div>
<div class="tip" id="fs34">type OptimiserParams =<br />&#160;&#160;{seeds: ModelParams;<br />&#160;&#160;&#160;lowerBound: ModelParams;<br />&#160;&#160;&#160;upperBound: ModelParams;}<br /><br />Full name: ExtrapolationExample.OptimiserParams</div>
<div class="tip" id="fs35">OptimiserParams.seeds: ModelParams</div>
<div class="tip" id="fs36">OptimiserParams.lowerBound: ModelParams</div>
<div class="tip" id="fs37">OptimiserParams.upperBound: ModelParams</div>
<div class="tip" id="fs38">val optimiserStartParams : OptimiserParams<br /><br />Full name: ExtrapolationExample.optimiserStartParams</div>
<div class="tip" id="fs39">val modelImpliedVolatility : modelParams:ModelParams -&gt; t:float -&gt; float<br /><br />Full name: ExtrapolationExample.modelImpliedVolatility</div>
<div class="tip" id="fs40">val modelParams : ModelParams</div>
<div class="tip" id="fs41">val sqrt : value:&#39;T -&gt; &#39;U (requires member Sqrt)<br /><br />Full name: Microsoft.FSharp.Core.Operators.sqrt</div>
<div class="tip" id="fs42">val exp : value:&#39;T -&gt; &#39;T (requires member Exp)<br /><br />Full name: Microsoft.FSharp.Core.Operators.exp</div>
<div class="tip" id="fs43">type WeightMethod =<br />&#160;&#160;| VShaped<br />&#160;&#160;| Standard<br /><br />Full name: ExtrapolationExample.WeightMethod</div>
<div class="tip" id="fs44">union case WeightMethod.VShaped: WeightMethod</div>
<div class="tip" id="fs45">union case WeightMethod.Standard: WeightMethod</div>
<div class="tip" id="fs46">val weightedTargetWithDecay : decayFactor:float -&gt; wtMethod:WeightMethod -&gt; simpleTarget:(float * float) list -&gt; (float * float * float) list<br /><br />Full name: ExtrapolationExample.weightedTargetWithDecay</div>
<div class="tip" id="fs47">val decayFactor : float</div>
<div class="tip" id="fs48">val wtMethod : WeightMethod</div>
<div class="tip" id="fs49">val simpleTarget : (float * float) list</div>
<div class="tip" id="fs50">val maxTerm : float</div>
<div class="tip" id="fs51">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs52">val max : list:&#39;T list -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.List.max</div>
<div class="tip" id="fs53">val termDeltas : (float * float) list</div>
<div class="tip" id="fs54">val pairwise : list:&#39;T list -&gt; (&#39;T * &#39;T) list<br /><br />Full name: Microsoft.FSharp.Collections.List.pairwise</div>
<div class="tip" id="fs55">val t1 : float</div>
<div class="tip" id="fs56">val v1 : float</div>
<div class="tip" id="fs57">val t2 : float</div>
<div class="tip" id="fs58">val v2 : float</div>
<div class="tip" id="fs59">val lastDelta : float</div>
<div class="tip" id="fs60">val rev : list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.rev</div>
<div class="tip" id="fs61">val head : list:&#39;T list -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.List.head</div>
<div class="tip" id="fs62">val secondLastDelta : float</div>
<div class="tip" id="fs63">val item : index:int -&gt; list:&#39;T list -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.List.item</div>
<div class="tip" id="fs64">val secondLastMarketTerm : float</div>
<div class="tip" id="fs65">val fst : tuple:(&#39;T1 * &#39;T2) -&gt; &#39;T1<br /><br />Full name: Microsoft.FSharp.Core.Operators.fst</div>
<div class="tip" id="fs66">val isDeltaTheSameDirection : (float -&gt; float -&gt; bool)</div>
<div class="tip" id="fs67">val lastVal : float</div>
<div class="tip" id="fs68">val thisVal : float</div>
<div class="tip" id="fs69">val ignoreSlopeMap : Map&lt;float,bool&gt;</div>
<div class="tip" id="fs70">Multiple items<br />module Map<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Map&lt;&#39;Key,&#39;Value (requires comparison)&gt; =<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface ICollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface IDictionary&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member Add : key:&#39;Key * value:&#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member ContainsKey : key:&#39;Key -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member Remove : key:&#39;Key -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Map&lt;_,_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="tip" id="fs71">val ofList : elements:(&#39;Key * &#39;T) list -&gt; Map&lt;&#39;Key,&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.ofList</div>
<div class="tip" id="fs72">val fullIgnoreSlopeMap : Map&lt;float,bool&gt;</div>
<div class="tip" id="fs73">member Map.Add : key:&#39;Key * value:&#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="tip" id="fs74">val isVPresent : bool</div>
<div class="tip" id="fs75">val extrapWeightsTargetVols : (float * float * float) list</div>
<div class="tip" id="fs76">val finalExtrapWeightsTargetVols : (float * float * float) list</div>
<div class="tip" id="fs77">val w : float</div>
<div class="tip" id="fs78">val weightedTarget : (WeightMethod -&gt; (float * float) list -&gt; (float * float * float) list)<br /><br />Full name: ExtrapolationExample.weightedTarget</div>
<div class="tip" id="fs79">val standardWeightedTarget : ((float * float) list -&gt; (float * float * float) list)<br /><br />Full name: ExtrapolationExample.standardWeightedTarget</div>
<div class="tip" id="fs80">val vShapedWeightedTarget : ((float * float) list -&gt; (float * float * float) list)<br /><br />Full name: ExtrapolationExample.vShapedWeightedTarget</div>
<div class="tip" id="fs81">val finalWeightedTarget : (float * float * float) list<br /><br />Full name: ExtrapolationExample.finalWeightedTarget</div>
<div class="tip" id="fs82">val testVShapedVols : (float * float) list<br /><br />Full name: ExtrapolationExample.testVShapedVols</div>
<div class="tip" id="fs83">val errorToMinimise : modelParams:ModelParams -&gt; target:(float * float * float) list -&gt; float<br /><br />Full name: ExtrapolationExample.errorToMinimise</div>
<div class="tip" id="fs84">val target : (float * float * float) list</div>
<div class="tip" id="fs85">val weightedMktModelPairs : (float * float * float) list</div>
<div class="tip" id="fs86">val numWeightedPoints : float</div>
<div class="tip" id="fs87">val mkt : float</div>
<div class="tip" id="fs88">val mdl : float</div>
<div class="tip" id="fs89">val weight : float</div>
<div class="tip" id="fs90">val sum : list:&#39;T list -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.List.sum</div>
<div class="tip" id="fs91">val mktModelErrors : float list</div>
<div class="tip" id="fs92">val extrapSqdError : modelParams:ModelParams -&gt; float<br /><br />Full name: ExtrapolationExample.extrapSqdError</div>
<div class="tip" id="fs93">val modelValuesAtMats : modelParams:ModelParams -&gt; marketPoints:(float * float) list -&gt; maturities:float list -&gt; (float * float) list<br /><br />Full name: ExtrapolationExample.modelValuesAtMats</div>
<div class="tip" id="fs94">val marketPoints : (float * float) list</div>
<div class="tip" id="fs95">val maturities : float list</div>
<div class="tip" id="fs96">val newValues : (float * float) list</div>
<div class="tip" id="fs97">val filter : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.filter</div>
<div class="tip" id="fs98">val modelValues : modelParams:ModelParams -&gt; (float * float) list<br /><br />Full name: ExtrapolationExample.modelValues</div>
<div class="tip" id="fs99">val extrapModel : (float * float) list<br /><br />Full name: ExtrapolationExample.extrapModel</div>
<div class="tip" id="fs100">namespace XPlot</div>
<div class="tip" id="fs101">namespace XPlot.GoogleCharts</div>
<div class="tip" id="fs102">val plotResult : model:(float * float) list -&gt; GoogleChart<br /><br />Full name: ExtrapolationExample.plotResult</div>
<div class="tip" id="fs103">val model : (float * float) list</div>
<div class="tip" id="fs104">val options : Options</div>
<div class="tip" id="fs105">Multiple items<br />type Options =<br />&#160;&#160;new : unit -&gt; Options<br />&#160;&#160;member ShouldSerializeaggregationTarget : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeallValuesSuffix : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeallowHtml : unit -&gt; bool<br />&#160;&#160;member ShouldSerializealternatingRowStyle : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeanimation : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeannotations : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeannotationsWidth : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeareaOpacity : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeavoidOverlappingGridLines : unit -&gt; bool<br />&#160;&#160;...<br /><br />Full name: XPlot.GoogleCharts.Configuration.Options<br /><br />--------------------<br />new : unit -&gt; Options</div>
<div class="tip" id="fs106">Multiple items<br />type Axis =<br />&#160;&#160;new : unit -&gt; Axis<br />&#160;&#160;member ShouldSerializeallowContainerBoundaryTextCufoff : unit -&gt; bool<br />&#160;&#160;member ShouldSerializebaseline : unit -&gt; bool<br />&#160;&#160;member ShouldSerializebaselineColor : unit -&gt; bool<br />&#160;&#160;member ShouldSerializedirection : unit -&gt; bool<br />&#160;&#160;member ShouldSerializeformat : unit -&gt; bool<br />&#160;&#160;member ShouldSerializegridlines : unit -&gt; bool<br />&#160;&#160;member ShouldSerializelogScale : unit -&gt; bool<br />&#160;&#160;member ShouldSerializemaxAlternation : unit -&gt; bool<br />&#160;&#160;member ShouldSerializemaxTextLines : unit -&gt; bool<br />&#160;&#160;...<br /><br />Full name: XPlot.GoogleCharts.Configuration.Axis<br /><br />--------------------<br />new : unit -&gt; Axis</div>
<div class="tip" id="fs107">type Chart =<br />&#160;&#160;static member Annotation : data:seq&lt;#seq&lt;DateTime * &#39;V * string * string&gt;&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart (requires &#39;V :&gt; value)<br />&#160;&#160;static member Annotation : data:seq&lt;DateTime * #value * string * string&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;static member Area : data:seq&lt;#seq&lt;&#39;K * &#39;V&gt;&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart (requires &#39;K :&gt; key and &#39;V :&gt; value)<br />&#160;&#160;static member Area : data:seq&lt;#key * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;static member Bar : data:seq&lt;#seq&lt;&#39;K * &#39;V&gt;&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart (requires &#39;K :&gt; key and &#39;V :&gt; value)<br />&#160;&#160;static member Bar : data:seq&lt;#key * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;static member Bubble : data:seq&lt;string * #value * #value * #value * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;static member Bubble : data:seq&lt;string * #value * #value * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;static member Bubble : data:seq&lt;string * #value * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;static member Calendar : data:seq&lt;DateTime * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart<br />&#160;&#160;...<br /><br />Full name: XPlot.GoogleCharts.Chart</div>
<div class="tip" id="fs108">static member Chart.Scatter : data:Deedle.Frame&lt;&#39;K,&#39;V&gt; * ?Options:Options -&gt; GoogleChart (requires equality and equality)<br />static member Chart.Scatter : data:Deedle.Series&lt;&#39;K,#value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart (requires equality and &#39;K :&gt; key)<br />static member Chart.Scatter : data:seq&lt;Deedle.Series&lt;&#39;K,#value&gt;&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart (requires equality and &#39;K :&gt; key)<br />static member Chart.Scatter : data:seq&lt;#seq&lt;&#39;K * &#39;V&gt;&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart (requires &#39;K :&gt; key and &#39;V :&gt; value)<br />static member Chart.Scatter : data:seq&lt;#key * #value&gt; * ?Labels:seq&lt;string&gt; * ?Options:Options -&gt; GoogleChart</div>
<div class="tip" id="fs109">static member Chart.WithOptions : options:Options -&gt; chart:GoogleChart -&gt; GoogleChart</div>
<div class="tip" id="fs110">static member Chart.WithLabels : labels:seq&lt;string&gt; -&gt; chart:GoogleChart -&gt; GoogleChart</div>
<div class="tip" id="fs111">val initialSolution : ModelParams<br /><br />Full name: ExtrapolationExample.initialSolution</div>
<div class="tip" id="fs112">val solution : ModelParams<br /><br />Full name: ExtrapolationExample.solution</div>
<div class="tip" id="fs113">val nearest5 : percentage:float -&gt; float<br /><br />Full name: ExtrapolationExample.nearest5</div>
<div class="tip" id="fs114">val percentage : float</div>
<div class="tip" id="fs115">val round : value:&#39;T -&gt; &#39;T (requires member Round)<br /><br />Full name: Microsoft.FSharp.Core.Operators.round</div>
<div class="tip" id="fs116">val roundUpToNearest5 : percentage:float -&gt; float<br /><br />Full name: ExtrapolationExample.roundUpToNearest5</div>
<div class="tip" id="fs117">val ceil : value:&#39;T -&gt; &#39;T (requires member Ceiling)<br /><br />Full name: Microsoft.FSharp.Core.Operators.ceil</div>
<div class="tip" id="fs118">val roundDownToNearest5 : percentage:float -&gt; float<br /><br />Full name: ExtrapolationExample.roundDownToNearest5</div>
<div class="tip" id="fs119">val floor : value:&#39;T -&gt; &#39;T (requires member Floor)<br /><br />Full name: Microsoft.FSharp.Core.Operators.floor</div>
<div class="tip" id="fs120">val testPercentages : float list<br /><br />Full name: ExtrapolationExample.testPercentages</div>
<div class="tip" id="fs121">val testRoundDown : float list<br /><br />Full name: ExtrapolationExample.testRoundDown</div>
<div class="tip" id="fs122">val testRoundUp : float list<br /><br />Full name: ExtrapolationExample.testRoundUp</div>
<div class="tip" id="fs123">val tolerance : float<br /><br />Full name: ExtrapolationExample.tolerance</div>
<div class="tip" id="fs124">val withinTolerance : x:float -&gt; t:float -&gt; bool<br /><br />Full name: ExtrapolationExample.withinTolerance</div>
<div class="tip" id="fs125">val x : float</div>
<div class="tip" id="fs126">val abs : value:&#39;T -&gt; &#39;T (requires member Abs)<br /><br />Full name: Microsoft.FSharp.Core.Operators.abs</div>
<div class="tip" id="fs127">val isSmall : x:float -&gt; bool<br /><br />Full name: ExtrapolationExample.isSmall</div>
<div class="tip" id="fs128">val termDeltas : (float * float) list<br /><br />Full name: ExtrapolationExample.termDeltas</div>
<div class="tip" id="fs129">val isLastMarketGradientSmall : bool<br /><br />Full name: ExtrapolationExample.isLastMarketGradientSmall</div>
<div class="tip" id="fs130">val isPenultimateMarketGradientSmall : bool<br /><br />Full name: ExtrapolationExample.isPenultimateMarketGradientSmall</div>
<div class="tip" id="fs131">val isLastMarketGradientPositive : bool<br /><br />Full name: ExtrapolationExample.isLastMarketGradientPositive</div>
<div class="tip" id="fs132">val isLastMarketGradientStrictlyPositive : bool<br /><br />Full name: ExtrapolationExample.isLastMarketGradientStrictlyPositive</div>
<div class="tip" id="fs133">val areFinalMarketPointsSlopingUpward : bool<br /><br />Full name: ExtrapolationExample.areFinalMarketPointsSlopingUpward</div>
<div class="tip" id="fs134">val areFinalMarketPointsSlopingDownward : bool<br /><br />Full name: ExtrapolationExample.areFinalMarketPointsSlopingDownward</div>
<div class="tip" id="fs135">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs136">val lastMarketPoint : float * float<br /><br />Full name: ExtrapolationExample.lastMarketPoint</div>
<div class="tip" id="fs137">val secondLastMarketPoint : float * float<br /><br />Full name: ExtrapolationExample.secondLastMarketPoint</div>
<div class="tip" id="fs138">val skip : count:int -&gt; list:&#39;T list -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List.skip</div>
<div class="tip" id="fs139">val thirdLastMarketPoint : float * float<br /><br />Full name: ExtrapolationExample.thirdLastMarketPoint</div>
<div class="tip" id="fs140">val isVPresent : bool<br /><br />Full name: ExtrapolationExample.isVPresent</div>
<div class="tip" id="fs141">val isMarketThirdLastLargerThanSecondLast : bool<br /><br />Full name: ExtrapolationExample.isMarketThirdLastLargerThanSecondLast</div>
<div class="tip" id="fs142">val oneYearMarketAverage : float<br /><br />Full name: ExtrapolationExample.oneYearMarketAverage</div>
<div class="tip" id="fs143">val averageBy : projection:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U (requires member ( + ) and member DivideByInt and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.List.averageBy</div>
<div class="tip" id="fs144">val isLastMarketDataPointBelowStartingMin : bool<br /><br />Full name: ExtrapolationExample.isLastMarketDataPointBelowStartingMin</div>
<div class="tip" id="fs145">val isLastMarketDataPointAboveStartingMin : bool<br /><br />Full name: ExtrapolationExample.isLastMarketDataPointAboveStartingMin</div>
<div class="tip" id="fs146">val isLastMarketDataPointLessThanSigmaInf : bool<br /><br />Full name: ExtrapolationExample.isLastMarketDataPointLessThanSigmaInf</div>
<div class="tip" id="fs147">val isLastMarketDataPointGreaterThanSigmaInf : bool<br /><br />Full name: ExtrapolationExample.isLastMarketDataPointGreaterThanSigmaInf</div>
<div class="tip" id="fs148">val isAlphaOnTheLowerBound : bool<br /><br />Full name: ExtrapolationExample.isAlphaOnTheLowerBound</div>
<div class="tip" id="fs149">val isSigmaInfAtTheMinLimit : bool<br /><br />Full name: ExtrapolationExample.isSigmaInfAtTheMinLimit</div>
<div class="tip" id="fs150">val isSigmaInfAtTheMaxLimit : bool<br /><br />Full name: ExtrapolationExample.isSigmaInfAtTheMaxLimit</div>
<div class="tip" id="fs151">val isAlphaLargerThanTheLB : bool<br /><br />Full name: ExtrapolationExample.isAlphaLargerThanTheLB</div>
<div class="tip" id="fs152">val isSigmaInfAboveTheMinLimit : bool<br /><br />Full name: ExtrapolationExample.isSigmaInfAboveTheMinLimit</div>
<div class="tip" id="fs153">val isSigmaInfAboveTheMaxLimit : bool<br /><br />Full name: ExtrapolationExample.isSigmaInfAboveTheMaxLimit</div>
<div class="tip" id="fs154">val isSigmaInfBelowTheMinLimit : bool<br /><br />Full name: ExtrapolationExample.isSigmaInfBelowTheMinLimit</div>
<div class="tip" id="fs155">val isSigmaInfBelowTheMaxLimit : bool<br /><br />Full name: ExtrapolationExample.isSigmaInfBelowTheMaxLimit</div>
<div class="tip" id="fs156">val isLastMarketGradientLarge : bool<br /><br />Full name: ExtrapolationExample.isLastMarketGradientLarge</div>
<div class="tip" id="fs157">val isPenultimateMarketGradientLarge : bool<br /><br />Full name: ExtrapolationExample.isPenultimateMarketGradientLarge</div>
<div class="tip" id="fs158">val weSayTheMarketIsUpwardSloping : bool<br /><br />Full name: ExtrapolationExample.weSayTheMarketIsUpwardSloping</div>
<div class="tip" id="fs159">val weSayTheMarketIsDownwardSloping : bool<br /><br />Full name: ExtrapolationExample.weSayTheMarketIsDownwardSloping</div>
<div class="tip" id="fs160">val isCase11 : bool<br /><br />Full name: ExtrapolationExample.isCase11</div>
<div class="tip" id="fs161">val isCase12 : bool<br /><br />Full name: ExtrapolationExample.isCase12</div>
<div class="tip" id="fs162">val isCase13 : bool<br /><br />Full name: ExtrapolationExample.isCase13</div>
<div class="tip" id="fs163">val isCase2 : bool<br /><br />Full name: ExtrapolationExample.isCase2</div>
<div class="tip" id="fs164">val isCase321 : bool<br /><br />Full name: ExtrapolationExample.isCase321</div>
<div class="tip" id="fs165">val isCase322 : bool<br /><br />Full name: ExtrapolationExample.isCase322</div>
<div class="tip" id="fs166">val isCase311 : bool<br /><br />Full name: ExtrapolationExample.isCase311</div>
<div class="tip" id="fs167">val isCase312 : bool<br /><br />Full name: ExtrapolationExample.isCase312</div>
<div class="tip" id="fs168">val isCase14 : bool<br /><br />Full name: ExtrapolationExample.isCase14</div>
<div class="tip" id="fs169">val forall : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; bool<br /><br />Full name: Microsoft.FSharp.Collections.List.forall</div>
<div class="tip" id="fs170">val caseList : string list<br /><br />Full name: ExtrapolationExample.caseList</div>
<div class="tip" id="fs171">val isCaseList : bool list<br /><br />Full name: ExtrapolationExample.isCaseList</div>
<div class="tip" id="fs172">val caseMap : (string * bool) list<br /><br />Full name: ExtrapolationExample.caseMap</div>
<div class="tip" id="fs173">val zip : list1:&#39;T1 list -&gt; list2:&#39;T2 list -&gt; (&#39;T1 * &#39;T2) list<br /><br />Full name: Microsoft.FSharp.Collections.List.zip</div>
<div class="tip" id="fs174">val thisCaseIs : string<br /><br />Full name: ExtrapolationExample.thisCaseIs</div>
<div class="tip" id="fs175">val find : predicate:(&#39;T -&gt; bool) -&gt; list:&#39;T list -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.List.find</div>
<div class="tip" id="fs176">val k : string</div>
<div class="tip" id="fs177">val v : bool</div>
<div class="tip" id="fs178">val doTheCase : caseIs:string -&gt; unit<br /><br />Full name: ExtrapolationExample.doTheCase</div>
<div class="tip" id="fs179">val caseIs : string</div>


          
        </div>
        <div class="span1"></div>
      </div>
      <hr style="margin-top:50px;"/>
      <footer class="footer" style="text-align:center">
        Brought to you by the <a href="http://fsharp.org/technical-groups/">F# Data Science working group</a> and <a href="http://twitter.com/fslaborg">@fslaborg</a>.<br />
        Submit <a href="https://github.com/fslaborg/FsLab">feedback on GitHub</a> and help us improve FsLab!
      </footer>
    </div>
  </body>
</html>
