<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <!--
      The RWTS - Multivariate Statistics parameters will be replaced with the
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>RWTS - Multivariate Statistics</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML'></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles/style.css" />
    <script src="styles/tips.js" type="text/javascript"></script>
    
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({ tex2jax: {inlineMath: [["$","$"],["\\(","\\)"]]} });
  </script>

  <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

  <script type="text/javascript">
    MathJax.Hub.Queue(function() {
      $(".mathnet").show();
      if (window.fsiResizeContent) window.fsiResizeContent($(".mathnet").outerHeight() + 20);
    });
  </script>


  <style type="text/css">
    .mathnet .MathJax_Display {
      margin:0px;
    }
    .mathnet {
      color:black;
      display:none;
    }
  </style>

<style type="text/css">
  .grid {
    font-size:11pt;
    font-family:sans-serif;
    color:black;
  }

  .grid ::-webkit-scrollbar  {
    width:6px;
    height:6px;
    background:transparent;
  }

  .grid ::-webkit-scrollbar-track {
    background:transparent;
  }

  .grid ::-webkit-scrollbar-thumb {
    border-radius:3px;
    background-color:#c1c1c1;
  }

  .grid .faded {
    color:#a0a0a0;
  }

  .grid tr {
    background-color: #fdfdfd;
  }

  .grid tbody tr:nth-child(odd) {
    background-color: #f4f4f4;
  }

  .grid thead tr {
    background: #fdfdfd;
  }

  .grid table {
    top:0px;
    left:0px;
    width:100%;
    border-spacing: 0;
    border-collapse: collapse;
  }

  .grid td, .grid th {
    border-bottom:1px solid #a0a0a0;
    padding:4px 10px 4px 10px;
    min-width:50px;
  }

  .grid thead th {
    border-bottom:3px solid #a0a0a0;
  }

  .grid th {
    padding:4px 20px 4px 10px;
    text-align:left;
    font-weight:bold;
  }

  .live-grid {
    position:relative;
    overflow:hidden;
  }

  .live-grid .scroller {
    overflow-y: scroll;
    position:absolute;
    width:100%;
  }

  .live-grid table {
    position:absolute;
  }
</style>

<script type="text/javascript">
  function setupGrid(id, viewHeight, serviceUrl) {

    // Create table with given column names & specified number of empty rows
    function createRows(rowCount, columns) {
      var head = $(id + " .head").empty();
      $("<th />").html("#").appendTo(head);
      for (var i = 0; i < columns.length; i++) {
        $("<th />").html(columns[i]).appendTo(head);
      }

      var rows = [];
      var body = $(id + " .body").empty();
      for (var i = 0; i < rowCount; i++) {
        var row = { columns: [] };
        var tr = $("<tr />").appendTo(body);
        var th = $("<th />").html("&nbsp;").appendTo(tr);
        for (var j = 0; j < columns.length; j++) {
          row.columns.push($("<td />").html("&nbsp;").appendTo(tr));
        }
        row.key = th;
        row.tr = tr;
        rows.push(row);
      }
      return rows;
    }

    // Once we receive meta-data about the grid from the servier, 
    // we create the grid, set height of scrollbar and register 
    // scroll event to update the data on change
    function initialize(meta) {
      var rowHeight = $(id + " tbody tr").height() - 1; // Magic constant
      var thHeight = $(id + " thead tr").height() + 2; // Magic constant 
      var totalRows = meta.rows;
      var viewCount = Math.ceil((viewHeight - thHeight) / rowHeight - 1);
      var tableHeight = rowHeight * Math.min(viewCount, totalRows);

      // Resize and report new size to FSI container (if defined)
      $(id + " .spacer").css("min-height", (rowHeight * totalRows) + "px");
      $(id).height(tableHeight + thHeight);
      $(id + " .scroller").css("margin-top", thHeight + "px");
      $(id + " .scroller").height(tableHeight);
      if (window.fsiResizeContent) window.fsiResizeContent();

      // Create table rows of the view
      var rows = createRows(viewCount, meta.columns);
      
      // Update that gets triggered once the current one is done
      var nextUpdate = null;

      // Update the displayed data on scroll
      function update(offset) {
        nextUpdate = offset;
        for (var i = 0; i < viewCount; i++) {
          rows[i].tr.show();
          rows[i].key.addClass("faded");
          for (var j = 0; j < rows[i].columns.length; j++)
            rows[i].columns[j].addClass("faded");
        }

        $.ajax({ url: serviceUrl + "/rows/" + offset + "?count=" + viewCount }).done(function (res) {
          var data = JSON.parse(res);
          for (var i = 0; i < viewCount; i++) {
            var point = data[i];
            if (point == null) rows[i].tr.hide();
            else {
              rows[i].tr.show();
              rows[i].key.removeClass("faded").html(point.key);
              for (var j = 0; j < rows[i].columns.length; j++)
                rows[i].columns[j].removeClass("faded").html(point.columns[j]);
            }
          }
          if (nextUpdate != null && nextUpdate != offset) {
            console.log("Next: {0}", nextUpdate);
            update(nextUpdate);
          }
          nextUpdate = null;
        });
      }

      // Setup scroll handler & call to load first block of data
      $(id + " .scroller").on("scroll", function () {
        var offset = Math.ceil($(id + " .scroller").scrollTop() / rowHeight);
        if (nextUpdate == null)
          update(offset);
        else
          nextUpdate = offset;
      });
      update(0);
    }

    $.ajax({ url: serviceUrl + "/metadata" }).done(function (res) {
      initialize(JSON.parse(res));
    });
  }
</script>
<script type="text/javascript">
      $(function () { setupGrid("#fslab-grid-37340-1", 500, "http://localhost:9689/0"); });
    </script>
    <script language="javascript" type="text/javascript">
      function init()
      {
        try {
          websocket = new WebSocket("ws://" + window.location.hostname + ":" + window.location.port + "/websocket");
          websocket.onmessage = function(evt) { location.reload(); };
        } catch (e) { /* silently ignore lack of websockets */ }
      }
      window.addEventListener("load", init, false);
    </script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fslab.org">fslab.org</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Data/">F# Data</a></li>
          <li><a href="http://bluemountaincapital.github.io/Deedle">Deedle</a></li>
          <li><a href="http://bluemountaincapital.github.io/FSharpRProvider">R Provider</a></li>
          <li><a href="http://tahahachana.github.io/XPlot/">XPlot</a></li>
          <li><a href="http://www.mathdotnet.com/">Math.Net</a></li>
        </ul>
        <h3 class="muted">Journal</h3>
      </div>
      <hr />
      <div class="row" style="margin-top:30px">
        <div class="span1"></div>
        <div class="span10" id="main">
          <a name="Top"></a>
<h1>RWTS - Multivariate Statistics</h1>
<p>Multivariate - using more than one variable.</p>
<p>For RWTS, that is to say focusing on multiple Assets together, focusing on the relationship between assets - i.e. correlation-style calculations.</p>
<p>We will define a <em>portfolio</em> of Assets that we will use to determine the coverage. From this definition, we can return some additional portfolio statistics.</p>
<h1>Required Packages</h1>
<p>We will require references to:</p>
<p>System - for DateTime.</p>
<p>Deedle - to arrange time series data into Key -&gt; Value "Frames", and for univariate statistical functions.</p>
<p>Mathnet.Numerics - for off the shelf multivariate statistical functions, and for Matrix algebra.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">System</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Deedle</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">MathNet</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">Numerics</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="i">MathNet</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="i">Numerics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="i">Statistics</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs3', 8)" onmouseover="showTip(event, 'fs3', 8)" class="i">MathNet</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 9)" onmouseover="showTip(event, 'fs4', 9)" class="i">Numerics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="i">LinearAlgebra</span>
</code></pre></td>
</tr>
</table>
<a name="import"></a>
<h1>Data Import</h1>
<p>Like in the multivariate case , we can mock up a "database" of time series data by pulling in a full set of data, up to EndDec2016.
Here, we will jump ahead to the "Annualised quarterly returns" series - this will mimic the process when we have a tool or service that will provide returns as a time series.<br />
The data here is the original RWTS total return results from the database.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// I can create a function to return all &lt;float&gt; values for each Asset</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="f">ReturnSeries</span> (<span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">allSeries</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="t">Frame</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="t">DateTime</span>,<span onmouseout="hideTip(event, 'fs12', 16)" onmouseover="showTip(event, 'fs12', 16)" class="t">string</span><span class="o">&gt;</span>) <span onmouseout="hideTip(event, 'fs13', 17)" onmouseover="showTip(event, 'fs13', 17)" class="i">asset</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs9', 18)" onmouseover="showTip(event, 'fs9', 18)" class="i">allSeries</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 19)" onmouseover="showTip(event, 'fs14', 19)" class="f">GetColumn</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="t">string</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="i">asset</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 22)" onmouseover="showTip(event, 'fs15', 22)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 23)" onmouseover="showTip(event, 'fs16', 23)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs17', 24)" onmouseover="showTip(event, 'fs17', 24)" class="i">k</span> <span onmouseout="hideTip(event, 'fs18', 25)" onmouseover="showTip(event, 'fs18', 25)" class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 26)" onmouseover="showTip(event, 'fs18', 26)" class="i">v</span> <span class="o">&lt;&gt;</span> <span class="s">&quot;null&quot;</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 27)" onmouseover="showTip(event, 'fs15', 27)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs19', 28)" onmouseover="showTip(event, 'fs19', 28)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs17', 29)" onmouseover="showTip(event, 'fs17', 29)" class="i">k</span> <span onmouseout="hideTip(event, 'fs18', 30)" onmouseover="showTip(event, 'fs18', 30)" class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs20', 31)" onmouseover="showTip(event, 'fs20', 31)" class="f">float</span> <span onmouseout="hideTip(event, 'fs18', 32)" onmouseover="showTip(event, 'fs18', 32)" class="i">v</span>)

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs21', 33)" onmouseover="showTip(event, 'fs21', 33)" class="i">XSReturnsfromCSV</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs10', 34)" onmouseover="showTip(event, 'fs10', 34)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 35)" onmouseover="showTip(event, 'fs22', 35)" class="f">ReadCsv</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs11', 36)" onmouseover="showTip(event, 'fs11', 36)" class="t">DateTime</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs7', 37)" onmouseover="showTip(event, 'fs7', 37)" class="i">root</span> <span class="o">+</span> <span class="s">&quot;HistoricReturnsQuarterly_EndDec2016_InColumns.csv&quot;</span>, <span class="i">indexCol</span><span class="o">=</span><span class="s">&quot;Index&quot;</span>, <span class="i">missingValues</span><span class="o">=</span>[|<span class="s">&quot;null&quot;</span>|])
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 38)" onmouseover="showTip(event, 'fs10', 38)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 39)" onmouseover="showTip(event, 'fs23', 39)" class="f">sortRowsByKey</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs24', 40)" onmouseover="showTip(event, 'fs24', 40)" class="f">returnXSReturnSeries</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs8', 41)" onmouseover="showTip(event, 'fs8', 41)" class="f">ReturnSeries</span> <span onmouseout="hideTip(event, 'fs21', 42)" onmouseover="showTip(event, 'fs21', 42)" class="i">XSReturnsfromCSV</span>

<span class="c">// We can now call this function to &quot;import&quot; our time series of data</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs25', 43)" onmouseover="showTip(event, 'fs25', 43)" class="i">testXSRetSeries</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 44)" onmouseover="showTip(event, 'fs24', 44)" class="f">returnXSReturnSeries</span> <span class="s">&quot;E_CNY&quot;</span>
</code></pre></td>
</tr>
</table>
<a name="tenyearcorrel"></a>
<h1>Historic 10Y Correlations</h1>
<p>We can introduce how we will approach multivariate statistics by taking the simplest example.<br />
We wish to calculate "Historic 10Y Correlations", which are simply the correlation between asset returns over the last 10 years.</p>
<p>We begin with the avaliable time series of quarterly returns for each asset X and Y.</p>
<p><span class="math">\(\vec{S^{X}} =  \begin{bmatrix}v^X_{t_0} \\ v^X_{t_1}  \\ \vdots \\ v^X_{t_{max}} \end{bmatrix}\)</span>
<span class="math">\(\vec{S^{Y}} =  \begin{bmatrix}v^Y_{t_0} \\ v^Y_{t_1}  \\ \vdots \\ v^Y_{t_{max}} \end{bmatrix}\)</span></p>
<p>Specifically, the correlation here is the "Pearson product moment coefficient". We can take this function from a standard library.</p>
<p><span class="math">\(\rho _{X,Y}=\mathrm {corr} (\vec{S^{X}},\vec{S^{Y}})\)</span></p>
<p>So to calculate correlation between a number of assets, we will need to pull in all avaliable returns for our assets.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs26', 45)" onmouseover="showTip(event, 'fs26', 45)" class="i">exampleReturnDataFrame</span> <span class="o">=</span> [ 
      <span class="s">&quot;ASX_200_A_REIT&quot;</span> <span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs24', 46)" onmouseover="showTip(event, 'fs24', 46)" class="f">returnXSReturnSeries</span> <span class="s">&quot;ASX_200_A_REIT&quot;</span>;  
      <span class="s">&quot;ASX_200_BANKS&quot;</span> <span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs24', 47)" onmouseover="showTip(event, 'fs24', 47)" class="f">returnXSReturnSeries</span> <span class="s">&quot;ASX_200_BANKS&quot;</span> ;
      <span class="s">&quot;China_25&quot;</span> <span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs24', 48)" onmouseover="showTip(event, 'fs24', 48)" class="f">returnXSReturnSeries</span> <span class="s">&quot;China_25&quot;</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 49)" onmouseover="showTip(event, 'fs10', 49)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 50)" onmouseover="showTip(event, 'fs27', 50)" class="f">ofColumns</span>
</code></pre></td>
</tr>
</table>
<p>To define the 10Y period, we will need to define our calibration date.</p>
<p>We can set:</p>
<p><span class="math">\(t^{XY}_T = CalibrationDate\)</span></p>
<p>Our start date will be T-10Y or the beginning of the latest starting series, if this does not go back as far as 10Y.</p>
<p><span class="math">\(t^{XY}_0 =  \max ((t^{XY}_T-10Y),t^{X}_0,t^{Y}_0)\)</span></p>
<p>In practice, all of our data series will span back 10Y.</p>
<p>We can now slice both time series over the same period:</p>
<p><span class="math">\(\vec{S^{X^{'}}} =  \begin{bmatrix}v^X_{t^{XY}_0}  \\ \vdots \\ v^X_{t^{XY}_T} \end{bmatrix}\)</span>
<span class="math">\(\vec{S^{Y^{'}}} =  \begin{bmatrix}v^Y_{t^{XY}_0}  \\ \vdots \\ v^Y_{t^{XY}_T} \end{bmatrix}\)</span></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs28', 51)" onmouseover="showTip(event, 'fs28', 51)" class="i">calibrationDate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 52)" onmouseover="showTip(event, 'fs11', 52)" class="t">DateTime</span>(<span class="n">2016</span>, <span class="n">12</span>, <span class="n">31</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 53)" onmouseover="showTip(event, 'fs29', 53)" class="i">tenYearsAgo</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs28', 54)" onmouseover="showTip(event, 'fs28', 54)" class="i">calibrationDate</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 55)" onmouseover="showTip(event, 'fs30', 55)" class="f">AddYears</span>(<span class="o">-</span><span class="n">10</span>)

<span class="c">// slice on a series</span>
<span onmouseout="hideTip(event, 'fs25', 56)" onmouseover="showTip(event, 'fs25', 56)" class="i">testXSRetSeries</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs31', 57)" onmouseover="showTip(event, 'fs31', 57)" class="f">Between</span>(<span onmouseout="hideTip(event, 'fs29', 58)" onmouseover="showTip(event, 'fs29', 58)" class="i">tenYearsAgo</span>, <span onmouseout="hideTip(event, 'fs28', 59)" onmouseover="showTip(event, 'fs28', 59)" class="i">calibrationDate</span>)
<span class="c">// or on the combined frame</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs32', 60)" onmouseover="showTip(event, 'fs32', 60)" class="i">exampleHist10YReturns</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs26', 61)" onmouseover="showTip(event, 'fs26', 61)" class="i">exampleReturnDataFrame</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 62)" onmouseover="showTip(event, 'fs10', 62)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 63)" onmouseover="showTip(event, 'fs33', 63)" class="f">filterRows</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs17', 64)" onmouseover="showTip(event, 'fs17', 64)" class="i">k</span> <span onmouseout="hideTip(event, 'fs34', 65)" onmouseover="showTip(event, 'fs34', 65)" class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs17', 66)" onmouseover="showTip(event, 'fs17', 66)" class="i">k</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs29', 67)" onmouseover="showTip(event, 'fs29', 67)" class="i">tenYearsAgo</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs17', 68)" onmouseover="showTip(event, 'fs17', 68)" class="i">k</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs28', 69)" onmouseover="showTip(event, 'fs28', 69)" class="i">calibrationDate</span>)
</code></pre></td>
</tr>
</table>
<p>Now that we have identically alligned time series, and assuming no missing values, we can take these series and calculate the correlation between them.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs35', 70)" onmouseover="showTip(event, 'fs35', 70)" class="i">myX</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 71)" onmouseover="showTip(event, 'fs32', 71)" class="i">exampleHist10YReturns</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 72)" onmouseover="showTip(event, 'fs14', 72)" class="f">GetColumn</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 73)" onmouseover="showTip(event, 'fs20', 73)" class="t">float</span><span class="o">&gt;</span>(<span class="s">&quot;ASX_200_A_REIT&quot;</span>)<span class="o">.</span><span class="i">ValuesAll</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 74)" onmouseover="showTip(event, 'fs36', 74)" class="i">myY</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 75)" onmouseover="showTip(event, 'fs32', 75)" class="i">exampleHist10YReturns</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 76)" onmouseover="showTip(event, 'fs14', 76)" class="f">GetColumn</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 77)" onmouseover="showTip(event, 'fs20', 77)" class="t">float</span><span class="o">&gt;</span>(<span class="s">&quot;ASX_200_BANKS&quot;</span>)<span class="o">.</span><span class="i">ValuesAll</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs37', 78)" onmouseover="showTip(event, 'fs37', 78)" class="i">myZ</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs32', 79)" onmouseover="showTip(event, 'fs32', 79)" class="i">exampleHist10YReturns</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 80)" onmouseover="showTip(event, 'fs14', 80)" class="f">GetColumn</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 81)" onmouseover="showTip(event, 'fs20', 81)" class="t">float</span><span class="o">&gt;</span>(<span class="s">&quot;China_25&quot;</span>)<span class="o">.</span><span class="i">ValuesAll</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs38', 82)" onmouseover="showTip(event, 'fs38', 82)" class="i">myCorrelXY</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 83)" onmouseover="showTip(event, 'fs39', 83)" class="i">Statistics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 84)" onmouseover="showTip(event, 'fs40', 84)" class="t">Correlation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 85)" onmouseover="showTip(event, 'fs41', 85)" class="f">Pearson</span>(<span onmouseout="hideTip(event, 'fs35', 86)" onmouseover="showTip(event, 'fs35', 86)" class="i">myX</span>, <span onmouseout="hideTip(event, 'fs36', 87)" onmouseover="showTip(event, 'fs36', 87)" class="i">myY</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 88)" onmouseover="showTip(event, 'fs42', 88)" class="i">myCorrelXZ</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 89)" onmouseover="showTip(event, 'fs39', 89)" class="i">Statistics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 90)" onmouseover="showTip(event, 'fs40', 90)" class="t">Correlation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 91)" onmouseover="showTip(event, 'fs41', 91)" class="f">Pearson</span>(<span onmouseout="hideTip(event, 'fs35', 92)" onmouseover="showTip(event, 'fs35', 92)" class="i">myX</span>, <span onmouseout="hideTip(event, 'fs37', 93)" onmouseover="showTip(event, 'fs37', 93)" class="i">myZ</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs43', 94)" onmouseover="showTip(event, 'fs43', 94)" class="i">myCorrelYZ</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 95)" onmouseover="showTip(event, 'fs39', 95)" class="i">Statistics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 96)" onmouseover="showTip(event, 'fs40', 96)" class="t">Correlation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 97)" onmouseover="showTip(event, 'fs41', 97)" class="f">Pearson</span>(<span onmouseout="hideTip(event, 'fs36', 98)" onmouseover="showTip(event, 'fs36', 98)" class="i">myY</span>, <span onmouseout="hideTip(event, 'fs37', 99)" onmouseover="showTip(event, 'fs37', 99)" class="i">myZ</span>)
</code></pre></td>
</tr>
</table>
<p>We can arrange this data into a matrix if we wish, using the LinearAlgebra package's matrix type.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs44', 100)" onmouseover="showTip(event, 'fs44', 100)" class="i">correlMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs45', 101)" onmouseover="showTip(event, 'fs45', 101)" class="f">matrix</span> [ [<span class="n">1.0</span>; <span onmouseout="hideTip(event, 'fs38', 102)" onmouseover="showTip(event, 'fs38', 102)" class="i">myCorrelXY</span>; <span onmouseout="hideTip(event, 'fs42', 103)" onmouseover="showTip(event, 'fs42', 103)" class="i">myCorrelXZ</span>]
                            [<span onmouseout="hideTip(event, 'fs38', 104)" onmouseover="showTip(event, 'fs38', 104)" class="i">myCorrelXY</span>; <span class="n">1.0</span>; <span onmouseout="hideTip(event, 'fs43', 105)" onmouseover="showTip(event, 'fs43', 105)" class="i">myCorrelYZ</span>]
                            [<span onmouseout="hideTip(event, 'fs42', 106)" onmouseover="showTip(event, 'fs42', 106)" class="i">myCorrelXZ</span>; <span onmouseout="hideTip(event, 'fs43', 107)" onmouseover="showTip(event, 'fs43', 107)" class="i">myCorrelYZ</span>; <span class="n">1.0</span>] ]
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
1 & 0.63 & 0.42\\ 
0.63 & 1 & 0.51\\ 
0.42 & 0.51 & 1
\end{bmatrix}$$</div></div>
<p>BONUS: We can test if a matrix is PSD like so:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 108)" onmouseover="showTip(event, 'fs46', 108)" class="f">isPSD</span> (<span onmouseout="hideTip(event, 'fs47', 109)" onmouseover="showTip(event, 'fs47', 109)" class="i">matrix</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs48', 110)" onmouseover="showTip(event, 'fs48', 110)" class="t">Matrix</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 111)" onmouseover="showTip(event, 'fs20', 111)" class="t">float</span><span class="o">&gt;</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs47', 112)" onmouseover="showTip(event, 'fs47', 112)" class="i">matrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 113)" onmouseover="showTip(event, 'fs49', 113)" class="f">Evd</span>()<span class="o">.</span><span class="i">EigenValues</span><span class="o">.</span><span class="f">Real</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 114)" onmouseover="showTip(event, 'fs50', 114)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 115)" onmouseover="showTip(event, 'fs51', 115)" class="f">min</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">0.000001</span>
<span onmouseout="hideTip(event, 'fs46', 116)" onmouseover="showTip(event, 'fs46', 116)" class="f">isPSD</span> <span onmouseout="hideTip(event, 'fs44', 117)" onmouseover="showTip(event, 'fs44', 117)" class="i">correlMatrix</span>
</code></pre></td>
</tr>
</table>
<p>We do not need to test this for our historic 10Y correlation matrix.</p>
<a name="unccorrel"></a>
<h1>Unconditional Correlations</h1>
<p>A slightly tricker calculation is the way in which we set our unconditional correlations.</p>
<p>Like the historic correlations, we need to work with pairs of time series.
For this calculation however, we need to be careful about the time period we are working over, conditional on the lifespan of both series in the pair.</p>
<p>For this example, we can go back in time to the pre-DB RWTS sheet, so we can compare results. The TR series are slightly different, but we should get a similar result.</p>
<p>For an EWMA correlation, we will need to refer to the full definition for the Pearson correlation.</p>
<p><span class="math">\(\rho _{X,Y}=\mathrm {corr} (X,Y)={\mathrm {cov} (X,Y) \over \sigma _{X}\sigma _{Y}}={E[(X-\mu _{X})(Y-\mu _{Y})] \over \sigma _{X}\sigma _{Y}}\)</span></p>
<p>For the unconditional correlation, we will take EWMA versions of covariance and variance, and plug these into the formula above.</p>
<p>Like for the 10Y correlations, we begin with the avaliable time series of quarterly returns for each asset X and Y.</p>
<p><span class="math">\(\vec{S^{X}} =  \begin{bmatrix}v^X_{t_0} \\ v^X_{t_1}  \\ \vdots \\ v^X_{t_{max}} \end{bmatrix}\)</span>
<span class="math">\(\vec{S^{Y}} =  \begin{bmatrix}v^Y_{t_0} \\ v^Y_{t_1}  \\ \vdots \\ v^Y_{t_{max}} \end{bmatrix}\)</span></p>
<p>The shared maximum date will be at our calibration date:</p>
<p><span class="math">\(t^{XY}_T = CalibrationDate\)</span></p>
<p>Note that we take the mean values used in the correlation calculations at this stage, NOT over the shared period we will use later in the EWMA calculation:</p>
<p><span class="math">\(\mu _{X} = mean(\begin{bmatrix}v^X_{t^{X}_0}  \\ \vdots \\ v^X_{t^{XY}_T} \end{bmatrix})\)</span></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Set the calibration date</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs52', 118)" onmouseover="showTip(event, 'fs52', 118)" class="i">oldCalibrationDate</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs11', 119)" onmouseover="showTip(event, 'fs11', 119)" class="t">DateTime</span>(<span class="n">2009</span>, <span class="n">12</span>, <span class="n">31</span>)

<span class="c">// We will take a pair of TR series, and truncate these to include data up to the calibration date only</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs53', 120)" onmouseover="showTip(event, 'fs53', 120)" class="i">seriesLH</span> <span class="o">=</span>  (<span onmouseout="hideTip(event, 'fs24', 121)" onmouseover="showTip(event, 'fs24', 121)" class="f">returnXSReturnSeries</span> <span class="s">&quot;E_AUD&quot;</span>)<span class="o">.</span><span class="f">EndAt</span>(<span onmouseout="hideTip(event, 'fs52', 122)" onmouseover="showTip(event, 'fs52', 122)" class="i">oldCalibrationDate</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs54', 123)" onmouseover="showTip(event, 'fs54', 123)" class="i">seriesRH</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs24', 124)" onmouseover="showTip(event, 'fs24', 124)" class="f">returnXSReturnSeries</span> <span class="s">&quot;E_HKD&quot;</span>)<span class="o">.</span><span class="f">EndAt</span>(<span onmouseout="hideTip(event, 'fs52', 125)" onmouseover="showTip(event, 'fs52', 125)" class="i">oldCalibrationDate</span>)

<span class="c">// we will need to take the mean value for each series. This is over the entire lifespan of each series. </span>
<span class="c">// the Deedle Series class has its own univariate statistics, which we can use for simple stuff like mean, standard dev. etc.</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs55', 126)" onmouseover="showTip(event, 'fs55', 126)" class="i">seriesMeanLHS</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 127)" onmouseover="showTip(event, 'fs53', 127)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 128)" onmouseover="showTip(event, 'fs56', 128)" class="f">Mean</span>()
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs57', 129)" onmouseover="showTip(event, 'fs57', 129)" class="i">seriesMeanRHS</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs54', 130)" onmouseover="showTip(event, 'fs54', 130)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 131)" onmouseover="showTip(event, 'fs56', 131)" class="f">Mean</span>()
</code></pre></td>
</tr>
</table>
<p>The shared start date will be at the beginning of the latest starting series.</p>
<p><span class="math">\(t^{XY}_0 =  \max (t^{X}_0,t^{Y}_0)\)</span></p>
<p>And we can produce the X' and Y' series that we will use.</p>
<p><span class="math">\(\vec{S^{X^{'}}} =  \begin{bmatrix}v^X_{t^{XY}_0}  \\ \vdots \\ v^X_{t^{XY}_T} \end{bmatrix}\)</span>
<span class="math">\(\vec{S^{Y^{'}}} =  \begin{bmatrix}v^Y_{t^{XY}_0}  \\ \vdots \\ v^Y_{t^{XY}_T} \end{bmatrix}\)</span></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// For the EWMA part of this calculation, we need to start at the first point in time where both series are avaliable</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs58', 132)" onmouseover="showTip(event, 'fs58', 132)" class="i">combinedStartDate</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs53', 133)" onmouseover="showTip(event, 'fs53', 133)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 134)" onmouseover="showTip(event, 'fs59', 134)" class="f">FirstKey</span>() <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs54', 135)" onmouseover="showTip(event, 'fs54', 135)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 136)" onmouseover="showTip(event, 'fs59', 136)" class="f">FirstKey</span>() <span class="k">then</span> <span onmouseout="hideTip(event, 'fs53', 137)" onmouseover="showTip(event, 'fs53', 137)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 138)" onmouseover="showTip(event, 'fs59', 138)" class="f">FirstKey</span>() <span class="k">else</span> <span onmouseout="hideTip(event, 'fs54', 139)" onmouseover="showTip(event, 'fs54', 139)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 140)" onmouseover="showTip(event, 'fs59', 140)" class="f">FirstKey</span>()

<span class="c">// we can now truncate the data series, and from now on will be working with series of equal length</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs60', 141)" onmouseover="showTip(event, 'fs60', 141)" class="i">ewmaReturnsLH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs53', 142)" onmouseover="showTip(event, 'fs53', 142)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 143)" onmouseover="showTip(event, 'fs61', 143)" class="f">StartAt</span>(<span onmouseout="hideTip(event, 'fs58', 144)" onmouseover="showTip(event, 'fs58', 144)" class="i">combinedStartDate</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs62', 145)" onmouseover="showTip(event, 'fs62', 145)" class="i">ewmaReturnsRH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs54', 146)" onmouseover="showTip(event, 'fs54', 146)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 147)" onmouseover="showTip(event, 'fs61', 147)" class="f">StartAt</span>(<span onmouseout="hideTip(event, 'fs58', 148)" onmouseover="showTip(event, 'fs58', 148)" class="i">combinedStartDate</span>)
</code></pre></td>
</tr>
</table>
<p>We will need to define our constants for the EWMA calculation.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// for the EWMA part of this, we will need to determine the initialisation value and the lambda value.</span>

<span class="c">// lambda can be expressed as a value, or in terms of the Mean age of the data (25y) and the observations per year (4 for quarterly data) </span>
<span class="c">// Again, this can differ for &quot;Emerging&quot; assets</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs63', 149)" onmouseover="showTip(event, 'fs63', 149)" class="i">uncCorrelLambda</span> <span class="o">=</span> (<span class="n">1.0</span> <span class="o">-</span> (<span class="n">1.0</span><span class="o">/</span><span class="n">4.0</span>) <span class="o">/</span> <span class="n">25.0</span>) <span class="c">//0.99</span>

<span class="c">// the initialisation value is 0.005625, but will be scaled based on the asset type (equity or bond) and if the underlying economy matches for the assets</span>
<span class="c">// in our example case, we will investigate equity assets that have different underlying economies, which gives us a scaling factor of 0.5</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs64', 150)" onmouseover="showTip(event, 'fs64', 150)" class="i">uncVarInit</span> <span class="o">=</span> <span class="n">0.005625</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs65', 151)" onmouseover="showTip(event, 'fs65', 151)" class="i">uncCovarInit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs64', 152)" onmouseover="showTip(event, 'fs64', 152)" class="i">uncVarInit</span> <span class="o">*</span> <span class="n">0.5</span>
</code></pre></td>
</tr>
</table>
<p>We can create our "Expected Covariance" series from the trimmed total return series and the population means.</p>
<p><span class="math">\({cov} (\vec{S^{X^{'}}},\vec{S^{Y^{'}}} ) =  E[(\vec{S^{X^{'}}}-\mu _{X})(\vec{S^{Y^{'}}}-\mu _{Y})] = E[\vec{C^{X^{'}Y^{'}}}]\)</span></p>
<p>Where:</p>
<p><span class="math">\(\vec{C^{X^{'}Y^{'}}} =  \begin{bmatrix}(v^X_{t^{XY}_0} - \mu _{X}) \times (v^Y_{t^{XY}_0} - \mu _{Y})  \\ \vdots \\ (v^X_{t^{XY}_T} - \mu _{X}) \times (v^Y_{t^{XY}_T} - \mu _{Y}) \end{bmatrix} =  \begin{bmatrix}C_{t_0}  \\ \vdots \\ C_{t_{max}} \end{bmatrix}\)</span></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Use the Series mu (over all points) rather than the mean of the ewma period, to calculate the covariance</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs66', 153)" onmouseover="showTip(event, 'fs66', 153)" class="i">seriesLHMinusMu</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs60', 154)" onmouseover="showTip(event, 'fs60', 154)" class="i">ewmaReturnsLH</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs55', 155)" onmouseover="showTip(event, 'fs55', 155)" class="i">seriesMeanLHS</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs67', 156)" onmouseover="showTip(event, 'fs67', 156)" class="i">seriesRHMinusMu</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs62', 157)" onmouseover="showTip(event, 'fs62', 157)" class="i">ewmaReturnsRH</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs57', 158)" onmouseover="showTip(event, 'fs57', 158)" class="i">seriesMeanRHS</span>

<span class="c">// Multiplying series is pointwise</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs68', 159)" onmouseover="showTip(event, 'fs68', 159)" class="i">ewmaCovar</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs66', 160)" onmouseover="showTip(event, 'fs66', 160)" class="i">seriesLHMinusMu</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs67', 161)" onmouseover="showTip(event, 'fs67', 161)" class="i">seriesRHMinusMu</span>
</code></pre></td>
</tr>
</table>
<p>We can now calculate the "weighted covar" - the EWMA value of the <span class="math">\(\vec{C^{X^{'}Y^{'}}}\)</span> series.</p>
<p>The EWMA variance is:</p>
<p><span class="math">\({cov} (\vec{S^{X^{'}}},\vec{S^{Y^{'}}} )_t = cov_t  = \lambda^{XY}_{cov} \times cov_{t-1} + (1 - \lambda^{XY}_{cov}) \times C_{t}\)</span></p>
<p>And similarly, we can calculate the EWMA variances over the series.</p>
<p><span class="math">\({\sigma_{X^{'}}} = var^X_t  = \lambda^X_{var} \times var^X_{t-1} + (1 - \lambda^X_{var}) \times (v^X_{t} - \mu _{X}) ^2\)</span></p>
<p><span class="math">\({\sigma_{Y^{'}}} = var^Y_t  = \lambda^Y_{var} \times var^Y_{t-1} + (1 - \lambda^Y_{var}) \times (v^Y_{t} - \mu _{Y}) ^2\)</span></p>
<p>We can use Deedle's "Series.scanValues" function to perform the EWMA weighted Covariance and series Variances.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs69', 162)" onmouseover="showTip(event, 'fs69', 162)" class="i">ewmaWeightedCovar</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs68', 163)" onmouseover="showTip(event, 'fs68', 163)" class="i">ewmaCovar</span>      
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 164)" onmouseover="showTip(event, 'fs15', 164)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 165)" onmouseover="showTip(event, 'fs70', 165)" class="f">scanValues</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs71', 166)" onmouseover="showTip(event, 'fs71', 166)" class="i">lastweightedCovar</span> <span onmouseout="hideTip(event, 'fs72', 167)" onmouseover="showTip(event, 'fs72', 167)" class="i">thisCovar</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs63', 168)" onmouseover="showTip(event, 'fs63', 168)" class="i">uncCorrelLambda</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs71', 169)" onmouseover="showTip(event, 'fs71', 169)" class="i">lastweightedCovar</span> <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs63', 170)" onmouseover="showTip(event, 'fs63', 170)" class="i">uncCorrelLambda</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs72', 171)" onmouseover="showTip(event, 'fs72', 171)" class="i">thisCovar</span> ) <span onmouseout="hideTip(event, 'fs65', 172)" onmouseover="showTip(event, 'fs65', 172)" class="i">uncCovarInit</span>
    
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs73', 173)" onmouseover="showTip(event, 'fs73', 173)" class="i">ewmaVarLH</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs66', 174)" onmouseover="showTip(event, 'fs66', 174)" class="i">seriesLHMinusMu</span>      
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 175)" onmouseover="showTip(event, 'fs15', 175)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 176)" onmouseover="showTip(event, 'fs70', 176)" class="f">scanValues</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs74', 177)" onmouseover="showTip(event, 'fs74', 177)" class="i">lastweightedVar</span> <span onmouseout="hideTip(event, 'fs75', 178)" onmouseover="showTip(event, 'fs75', 178)" class="i">thisVar</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs63', 179)" onmouseover="showTip(event, 'fs63', 179)" class="i">uncCorrelLambda</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs74', 180)" onmouseover="showTip(event, 'fs74', 180)" class="i">lastweightedVar</span> <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs63', 181)" onmouseover="showTip(event, 'fs63', 181)" class="i">uncCorrelLambda</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs75', 182)" onmouseover="showTip(event, 'fs75', 182)" class="i">thisVar</span> <span class="o">**</span> <span class="n">2.0</span> ) <span onmouseout="hideTip(event, 'fs64', 183)" onmouseover="showTip(event, 'fs64', 183)" class="i">uncVarInit</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs76', 184)" onmouseover="showTip(event, 'fs76', 184)" class="i">ewmaVarRH</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs67', 185)" onmouseover="showTip(event, 'fs67', 185)" class="i">seriesRHMinusMu</span>      
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 186)" onmouseover="showTip(event, 'fs15', 186)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 187)" onmouseover="showTip(event, 'fs70', 187)" class="f">scanValues</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs74', 188)" onmouseover="showTip(event, 'fs74', 188)" class="i">lastweightedVar</span> <span onmouseout="hideTip(event, 'fs75', 189)" onmouseover="showTip(event, 'fs75', 189)" class="i">thisVar</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs63', 190)" onmouseover="showTip(event, 'fs63', 190)" class="i">uncCorrelLambda</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs74', 191)" onmouseover="showTip(event, 'fs74', 191)" class="i">lastweightedVar</span> <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs63', 192)" onmouseover="showTip(event, 'fs63', 192)" class="i">uncCorrelLambda</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs75', 193)" onmouseover="showTip(event, 'fs75', 193)" class="i">thisVar</span> <span class="o">**</span> <span class="n">2.0</span> ) <span onmouseout="hideTip(event, 'fs64', 194)" onmouseover="showTip(event, 'fs64', 194)" class="i">uncVarInit</span>
</code></pre></td>
</tr>
</table>
<p>We can now calculate the correlation based on weighted covariance and variance, and take the value at our calibration date T as the unconditional correlation.</p>
<p><span class="math">\(\rho _{X,Y}^{UNC} = cov^{XY}_T / \sqrt{var^X_T*var^Y_T}\)</span></p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs77', 195)" onmouseover="showTip(event, 'fs77', 195)" class="i">ewmaCorrel</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs69', 196)" onmouseover="showTip(event, 'fs69', 196)" class="i">ewmaWeightedCovar</span> <span class="o">/</span> (<span onmouseout="hideTip(event, 'fs73', 197)" onmouseover="showTip(event, 'fs73', 197)" class="i">ewmaVarLH</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs76', 198)" onmouseover="showTip(event, 'fs76', 198)" class="i">ewmaVarRH</span>) <span class="o">**</span> <span class="n">0.5</span>

<span class="c">// finally, the contribution to the current unconditional correlation matrix for this pair is the ewmaCorrel value at the calibration date</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs78', 199)" onmouseover="showTip(event, 'fs78', 199)" class="i">finalUnconditionalCorrelation</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs77', 200)" onmouseover="showTip(event, 'fs77', 200)" class="i">ewmaCorrel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs79', 201)" onmouseover="showTip(event, 'fs79', 201)" class="f">Get</span>(<span onmouseout="hideTip(event, 'fs52', 202)" onmouseover="showTip(event, 'fs52', 202)" class="i">oldCalibrationDate</span>)
</code></pre></td>
</tr>
</table>
<h2>Refactoring Into Pair functions</h2>
<p>For mostly my own benifit, I want to see how we can use this code to calculate an entire correlation matrix.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Refactor into a function that returns correlation from a pair (correlation with itself is 1.0)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs80', 203)" onmouseover="showTip(event, 'fs80', 203)" class="f">get10YCorrelFromPair</span> (<span onmouseout="hideTip(event, 'fs81', 204)" onmouseover="showTip(event, 'fs81', 204)" class="i">calibrationDate</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 205)" onmouseover="showTip(event, 'fs11', 205)" class="t">DateTime</span>) <span onmouseout="hideTip(event, 'fs82', 206)" onmouseover="showTip(event, 'fs82', 206)" class="i">assetLH</span> <span onmouseout="hideTip(event, 'fs83', 207)" onmouseover="showTip(event, 'fs83', 207)" class="i">assetRH</span> <span class="o">=</span> 
    
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs82', 208)" onmouseover="showTip(event, 'fs82', 208)" class="i">assetLH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs83', 209)" onmouseover="showTip(event, 'fs83', 209)" class="i">assetRH</span> <span class="k">with</span>
    | <span class="k">true</span> <span class="k">-&gt;</span> <span class="n">1.0</span>
    | _ <span class="k">-&gt;</span> 
            <span class="c">// To ignore missing data, we need to truncate the trailing missing values</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs84', 210)" onmouseover="showTip(event, 'fs84', 210)" class="i">seriesLH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 211)" onmouseover="showTip(event, 'fs24', 211)" class="f">returnXSReturnSeries</span> <span onmouseout="hideTip(event, 'fs82', 212)" onmouseover="showTip(event, 'fs82', 212)" class="i">assetLH</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 213)" onmouseover="showTip(event, 'fs85', 213)" class="i">seriesRH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs24', 214)" onmouseover="showTip(event, 'fs24', 214)" class="f">returnXSReturnSeries</span> <span onmouseout="hideTip(event, 'fs83', 215)" onmouseover="showTip(event, 'fs83', 215)" class="i">assetRH</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 216)" onmouseover="showTip(event, 'fs86', 216)" class="i">combinedStartDate</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs84', 217)" onmouseover="showTip(event, 'fs84', 217)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 218)" onmouseover="showTip(event, 'fs59', 218)" class="f">FirstKey</span>() <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs85', 219)" onmouseover="showTip(event, 'fs85', 219)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 220)" onmouseover="showTip(event, 'fs59', 220)" class="f">FirstKey</span>() <span class="k">then</span> <span onmouseout="hideTip(event, 'fs84', 221)" onmouseover="showTip(event, 'fs84', 221)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 222)" onmouseover="showTip(event, 'fs59', 222)" class="f">FirstKey</span>() <span class="k">else</span> <span onmouseout="hideTip(event, 'fs85', 223)" onmouseover="showTip(event, 'fs85', 223)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 224)" onmouseover="showTip(event, 'fs59', 224)" class="f">FirstKey</span>()

            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs87', 225)" onmouseover="showTip(event, 'fs87', 225)" class="i">exampleReturnDataFrame</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 226)" onmouseover="showTip(event, 'fs10', 226)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs27', 227)" onmouseover="showTip(event, 'fs27', 227)" class="f">ofColumns</span> [ <span onmouseout="hideTip(event, 'fs82', 228)" onmouseover="showTip(event, 'fs82', 228)" class="i">assetLH</span> <span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs84', 229)" onmouseover="showTip(event, 'fs84', 229)" class="i">seriesLH</span>; <span onmouseout="hideTip(event, 'fs83', 230)" onmouseover="showTip(event, 'fs83', 230)" class="i">assetRH</span> <span class="o">=&gt;</span> <span onmouseout="hideTip(event, 'fs85', 231)" onmouseover="showTip(event, 'fs85', 231)" class="i">seriesRH</span> ]  
                
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs88', 232)" onmouseover="showTip(event, 'fs88', 232)" class="i">tenYearsAgo</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs81', 233)" onmouseover="showTip(event, 'fs81', 233)" class="i">calibrationDate</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs30', 234)" onmouseover="showTip(event, 'fs30', 234)" class="f">AddYears</span>(<span class="o">-</span><span class="n">10</span>)  
              
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs89', 235)" onmouseover="showTip(event, 'fs89', 235)" class="i">exampleHist10YReturns</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs87', 236)" onmouseover="showTip(event, 'fs87', 236)" class="i">exampleReturnDataFrame</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 237)" onmouseover="showTip(event, 'fs10', 237)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs33', 238)" onmouseover="showTip(event, 'fs33', 238)" class="f">filterRows</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs17', 239)" onmouseover="showTip(event, 'fs17', 239)" class="i">k</span> <span onmouseout="hideTip(event, 'fs34', 240)" onmouseover="showTip(event, 'fs34', 240)" class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs17', 241)" onmouseover="showTip(event, 'fs17', 241)" class="i">k</span> <span class="o">&gt;</span><span class="o">=</span> <span onmouseout="hideTip(event, 'fs86', 242)" onmouseover="showTip(event, 'fs86', 242)" class="i">combinedStartDate</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs17', 243)" onmouseover="showTip(event, 'fs17', 243)" class="i">k</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs88', 244)" onmouseover="showTip(event, 'fs88', 244)" class="i">tenYearsAgo</span> <span class="o">&amp;&amp;</span> <span onmouseout="hideTip(event, 'fs17', 245)" onmouseover="showTip(event, 'fs17', 245)" class="i">k</span> <span class="o">&lt;=</span> <span onmouseout="hideTip(event, 'fs81', 246)" onmouseover="showTip(event, 'fs81', 246)" class="i">calibrationDate</span>)
                         
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs90', 247)" onmouseover="showTip(event, 'fs90', 247)" class="i">myX</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 248)" onmouseover="showTip(event, 'fs89', 248)" class="i">exampleHist10YReturns</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 249)" onmouseover="showTip(event, 'fs14', 249)" class="f">GetColumn</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 250)" onmouseover="showTip(event, 'fs20', 250)" class="t">float</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs82', 251)" onmouseover="showTip(event, 'fs82', 251)" class="i">assetLH</span>)<span class="o">.</span><span class="i">ValuesAll</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs91', 252)" onmouseover="showTip(event, 'fs91', 252)" class="i">myY</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs89', 253)" onmouseover="showTip(event, 'fs89', 253)" class="i">exampleHist10YReturns</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 254)" onmouseover="showTip(event, 'fs14', 254)" class="f">GetColumn</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 255)" onmouseover="showTip(event, 'fs20', 255)" class="t">float</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs83', 256)" onmouseover="showTip(event, 'fs83', 256)" class="i">assetRH</span>)<span class="o">.</span><span class="i">ValuesAll</span>

            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs92', 257)" onmouseover="showTip(event, 'fs92', 257)" class="i">myCorrelXY</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs39', 258)" onmouseover="showTip(event, 'fs39', 258)" class="i">Statistics</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs40', 259)" onmouseover="showTip(event, 'fs40', 259)" class="t">Correlation</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs41', 260)" onmouseover="showTip(event, 'fs41', 260)" class="f">Pearson</span>(<span onmouseout="hideTip(event, 'fs90', 261)" onmouseover="showTip(event, 'fs90', 261)" class="i">myX</span>, <span onmouseout="hideTip(event, 'fs91', 262)" onmouseover="showTip(event, 'fs91', 262)" class="i">myY</span>)

            <span onmouseout="hideTip(event, 'fs92', 263)" onmouseover="showTip(event, 'fs92', 263)" class="i">myCorrelXY</span>

<span class="c">// This should return the same values as above</span>
<span onmouseout="hideTip(event, 'fs80', 264)" onmouseover="showTip(event, 'fs80', 264)" class="f">get10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs28', 265)" onmouseover="showTip(event, 'fs28', 265)" class="i">calibrationDate</span> <span class="s">&quot;ASX_200_A_REIT&quot;</span> <span class="s">&quot;ASX_200_BANKS&quot;</span> <span class="c">// = 0.6329625501</span>
<span onmouseout="hideTip(event, 'fs80', 266)" onmouseover="showTip(event, 'fs80', 266)" class="f">get10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs28', 267)" onmouseover="showTip(event, 'fs28', 267)" class="i">calibrationDate</span> <span class="s">&quot;ASX_200_A_REIT&quot;</span> <span class="s">&quot;China_25&quot;</span>  <span class="c">// = 0.4239930683</span>
<span onmouseout="hideTip(event, 'fs80', 268)" onmouseover="showTip(event, 'fs80', 268)" class="f">get10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs28', 269)" onmouseover="showTip(event, 'fs28', 269)" class="i">calibrationDate</span> <span class="s">&quot;China_25&quot;</span> <span class="s">&quot;China_25&quot;</span> <span class="c">// = 1.0</span>
<span class="c">// pair with a missing value </span>
<span onmouseout="hideTip(event, 'fs80', 270)" onmouseover="showTip(event, 'fs80', 270)" class="f">get10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs28', 271)" onmouseover="showTip(event, 'fs28', 271)" class="i">calibrationDate</span> <span class="s">&quot;EURSTOXX50&quot;</span> <span class="s">&quot;EUR_BankLoans&quot;</span> <span class="c">// 0.5962678681</span>

<span class="c">// We can now define a List of all assets we wish to include in the correlation matrix</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs93', 272)" onmouseover="showTip(event, 'fs93', 272)" class="i">assetList</span> <span class="o">=</span> [<span class="s">&quot;ASX_200_A_REIT&quot;</span>;<span class="s">&quot;ASX_200_BANKS&quot;</span>;<span class="s">&quot;China_25&quot;</span>] 

<span class="c">// We will create a record type to hold all the info about a &quot;matrix&quot;</span>
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs94', 273)" onmouseover="showTip(event, 'fs94', 273)" class="t">MatrixDescription</span> <span class="o">=</span> {<span onmouseout="hideTip(event, 'fs95', 274)" onmouseover="showTip(event, 'fs95', 274)" class="i">assets</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs96', 275)" onmouseover="showTip(event, 'fs96', 275)" class="t">List</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 276)" onmouseover="showTip(event, 'fs12', 276)" class="t">string</span><span class="o">&gt;</span>; <span onmouseout="hideTip(event, 'fs97', 277)" onmouseover="showTip(event, 'fs97', 277)" class="i">matrix</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs48', 278)" onmouseover="showTip(event, 'fs48', 278)" class="t">Matrix</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 279)" onmouseover="showTip(event, 'fs20', 279)" class="t">float</span><span class="o">&gt;</span>}

<span class="c">// We want to yield all pairs of assets, and calculate the correlation between them</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs98', 280)" onmouseover="showTip(event, 'fs98', 280)" class="f">getCorrelMatrix</span> <span onmouseout="hideTip(event, 'fs99', 281)" onmouseover="showTip(event, 'fs99', 281)" class="i">calibrationDate</span> <span onmouseout="hideTip(event, 'fs100', 282)" onmouseover="showTip(event, 'fs100', 282)" class="f">funCorrelMethod</span> <span onmouseout="hideTip(event, 'fs101', 283)" onmouseover="showTip(event, 'fs101', 283)" class="i">assetList</span> <span class="o">=</span> 

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs102', 284)" onmouseover="showTip(event, 'fs102', 284)" class="f">getThis10YCorrelFromPair</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs100', 285)" onmouseover="showTip(event, 'fs100', 285)" class="f">funCorrelMethod</span> <span onmouseout="hideTip(event, 'fs99', 286)" onmouseover="showTip(event, 'fs99', 286)" class="i">calibrationDate</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs103', 287)" onmouseover="showTip(event, 'fs103', 287)" class="i">indexedAssetList</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs101', 288)" onmouseover="showTip(event, 'fs101', 288)" class="i">assetList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 289)" onmouseover="showTip(event, 'fs96', 289)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 290)" onmouseover="showTip(event, 'fs104', 290)" class="f">zip</span> [<span class="n">0..</span><span onmouseout="hideTip(event, 'fs101', 291)" onmouseover="showTip(event, 'fs101', 291)" class="i">assetList</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 292)" onmouseover="showTip(event, 'fs105', 292)" class="i">Length</span><span class="o">-</span><span class="n">1</span>]

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs106', 293)" onmouseover="showTip(event, 'fs106', 293)" class="i">flatMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs107', 294)" onmouseover="showTip(event, 'fs107', 294)" class="i">seq</span> { <span class="k">for</span> <span onmouseout="hideTip(event, 'fs108', 295)" onmouseover="showTip(event, 'fs108', 295)" class="i">keyLH</span>, <span onmouseout="hideTip(event, 'fs82', 296)" onmouseover="showTip(event, 'fs82', 296)" class="i">assetLH</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs103', 297)" onmouseover="showTip(event, 'fs103', 297)" class="i">indexedAssetList</span> <span class="k">do</span>
                            <span class="k">for</span> <span onmouseout="hideTip(event, 'fs109', 298)" onmouseover="showTip(event, 'fs109', 298)" class="i">keyRH</span>, <span onmouseout="hideTip(event, 'fs83', 299)" onmouseover="showTip(event, 'fs83', 299)" class="i">assetRH</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs103', 300)" onmouseover="showTip(event, 'fs103', 300)" class="i">indexedAssetList</span> <span class="k">do</span>
                                <span class="k">yield</span> (<span onmouseout="hideTip(event, 'fs108', 301)" onmouseover="showTip(event, 'fs108', 301)" class="i">keyLH</span>, <span class="i">keyRH</span>, <span onmouseout="hideTip(event, 'fs102', 302)" onmouseover="showTip(event, 'fs102', 302)" class="f">getThis10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs82', 303)" onmouseover="showTip(event, 'fs82', 303)" class="i">assetLH</span> <span onmouseout="hideTip(event, 'fs83', 304)" onmouseover="showTip(event, 'fs83', 304)" class="i">assetRH</span>)
                         }
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs110', 305)" onmouseover="showTip(event, 'fs110', 305)" class="i">denseMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs111', 306)" onmouseover="showTip(event, 'fs111', 306)" class="t">DenseMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs112', 307)" onmouseover="showTip(event, 'fs112', 307)" class="f">ofSeqi</span> <span onmouseout="hideTip(event, 'fs101', 308)" onmouseover="showTip(event, 'fs101', 308)" class="i">assetList</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 309)" onmouseover="showTip(event, 'fs105', 309)" class="i">Length</span> <span onmouseout="hideTip(event, 'fs101', 310)" onmouseover="showTip(event, 'fs101', 310)" class="i">assetList</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs105', 311)" onmouseover="showTip(event, 'fs105', 311)" class="i">Length</span> <span onmouseout="hideTip(event, 'fs106', 312)" onmouseover="showTip(event, 'fs106', 312)" class="i">flatMatrix</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs113', 313)" onmouseover="showTip(event, 'fs113', 313)" class="i">result</span> <span class="o">=</span> {<span class="i">assets</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs101', 314)" onmouseover="showTip(event, 'fs101', 314)" class="i">assetList</span>; <span onmouseout="hideTip(event, 'fs45', 315)" onmouseover="showTip(event, 'fs45', 315)" class="i">matrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs110', 316)" onmouseover="showTip(event, 'fs110', 316)" class="i">denseMatrix</span>}
    <span onmouseout="hideTip(event, 'fs113', 317)" onmouseover="showTip(event, 'fs113', 317)" class="i">result</span>
                    <span class="c">//yield (assetLH, assetRH, getThis10YCorrelFromPair assetLH assetRH)</span>
      

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs114', 318)" onmouseover="showTip(event, 'fs114', 318)" class="i">test10YMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs98', 319)" onmouseover="showTip(event, 'fs98', 319)" class="f">getCorrelMatrix</span> <span onmouseout="hideTip(event, 'fs28', 320)" onmouseover="showTip(event, 'fs28', 320)" class="i">calibrationDate</span> <span onmouseout="hideTip(event, 'fs80', 321)" onmouseover="showTip(event, 'fs80', 321)" class="f">get10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs93', 322)" onmouseover="showTip(event, 'fs93', 322)" class="i">assetList</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>{assets = ["ASX_200_A_REIT"; "ASX_200_BANKS"; "China_25"];
 matrix =
  DenseMatrix 3x3-Double
       1  0.632963  0.423993
0.632963         1  0.511685
0.423993  0.511685         1
;}</code></pre></td></tr></table>
<p>We can repeat the same approach for the unconditional correlation</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs115', 323)" onmouseover="showTip(event, 'fs115', 323)" class="f">getUncCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs116', 324)" onmouseover="showTip(event, 'fs116', 324)" class="i">lambda</span> <span onmouseout="hideTip(event, 'fs117', 325)" onmouseover="showTip(event, 'fs117', 325)" class="i">uncVarInit</span> <span onmouseout="hideTip(event, 'fs118', 326)" onmouseover="showTip(event, 'fs118', 326)" class="i">covarScale</span> (<span onmouseout="hideTip(event, 'fs81', 327)" onmouseover="showTip(event, 'fs81', 327)" class="i">calibrationDate</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs11', 328)" onmouseover="showTip(event, 'fs11', 328)" class="t">DateTime</span>) <span onmouseout="hideTip(event, 'fs82', 329)" onmouseover="showTip(event, 'fs82', 329)" class="i">assetLH</span> <span onmouseout="hideTip(event, 'fs83', 330)" onmouseover="showTip(event, 'fs83', 330)" class="i">assetRH</span> <span class="o">=</span>
    
    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs82', 331)" onmouseover="showTip(event, 'fs82', 331)" class="i">assetLH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs83', 332)" onmouseover="showTip(event, 'fs83', 332)" class="i">assetRH</span> <span class="k">with</span>
    | <span class="k">true</span> <span class="k">-&gt;</span> <span class="n">1.0</span>
    | _ <span class="k">-&gt;</span> 
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs84', 333)" onmouseover="showTip(event, 'fs84', 333)" class="i">seriesLH</span> <span class="o">=</span>  (<span onmouseout="hideTip(event, 'fs24', 334)" onmouseover="showTip(event, 'fs24', 334)" class="f">returnXSReturnSeries</span> <span onmouseout="hideTip(event, 'fs82', 335)" onmouseover="showTip(event, 'fs82', 335)" class="i">assetLH</span>)<span class="o">.</span><span class="f">EndAt</span>(<span onmouseout="hideTip(event, 'fs81', 336)" onmouseover="showTip(event, 'fs81', 336)" class="i">calibrationDate</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs85', 337)" onmouseover="showTip(event, 'fs85', 337)" class="i">seriesRH</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs24', 338)" onmouseover="showTip(event, 'fs24', 338)" class="f">returnXSReturnSeries</span> <span onmouseout="hideTip(event, 'fs83', 339)" onmouseover="showTip(event, 'fs83', 339)" class="i">assetRH</span>)<span class="o">.</span><span class="f">EndAt</span>(<span onmouseout="hideTip(event, 'fs81', 340)" onmouseover="showTip(event, 'fs81', 340)" class="i">calibrationDate</span>)

        <span class="c">// we will need to take the mean value for each series. This is over the entire lifespan of each series.   </span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs119', 341)" onmouseover="showTip(event, 'fs119', 341)" class="i">seriesMeanLHS</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs84', 342)" onmouseover="showTip(event, 'fs84', 342)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 343)" onmouseover="showTip(event, 'fs56', 343)" class="f">Mean</span>()
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs120', 344)" onmouseover="showTip(event, 'fs120', 344)" class="i">seriesMeanRHS</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs85', 345)" onmouseover="showTip(event, 'fs85', 345)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs56', 346)" onmouseover="showTip(event, 'fs56', 346)" class="f">Mean</span>()

        <span class="c">// For the EWMA part of this calculation, we need to start at the first point in time where both series are avaliable</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs86', 347)" onmouseover="showTip(event, 'fs86', 347)" class="i">combinedStartDate</span> <span class="o">=</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs84', 348)" onmouseover="showTip(event, 'fs84', 348)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 349)" onmouseover="showTip(event, 'fs59', 349)" class="f">FirstKey</span>() <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs85', 350)" onmouseover="showTip(event, 'fs85', 350)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 351)" onmouseover="showTip(event, 'fs59', 351)" class="f">FirstKey</span>() <span class="k">then</span> <span onmouseout="hideTip(event, 'fs84', 352)" onmouseover="showTip(event, 'fs84', 352)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 353)" onmouseover="showTip(event, 'fs59', 353)" class="f">FirstKey</span>() <span class="k">else</span> <span onmouseout="hideTip(event, 'fs85', 354)" onmouseover="showTip(event, 'fs85', 354)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs59', 355)" onmouseover="showTip(event, 'fs59', 355)" class="f">FirstKey</span>()

        <span class="c">// we can now truncate the data series, and from now on will be working with series of equal length</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs121', 356)" onmouseover="showTip(event, 'fs121', 356)" class="i">ewmaReturnsLH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs84', 357)" onmouseover="showTip(event, 'fs84', 357)" class="i">seriesLH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 358)" onmouseover="showTip(event, 'fs61', 358)" class="f">StartAt</span>(<span onmouseout="hideTip(event, 'fs86', 359)" onmouseover="showTip(event, 'fs86', 359)" class="i">combinedStartDate</span>)
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs122', 360)" onmouseover="showTip(event, 'fs122', 360)" class="i">ewmaReturnsRH</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs85', 361)" onmouseover="showTip(event, 'fs85', 361)" class="i">seriesRH</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs61', 362)" onmouseover="showTip(event, 'fs61', 362)" class="f">StartAt</span>(<span onmouseout="hideTip(event, 'fs86', 363)" onmouseover="showTip(event, 'fs86', 363)" class="i">combinedStartDate</span>)

        <span class="c">// Use the Series mu (over all points) rather than the mean of the ewma period, to calculate the covariance</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs123', 364)" onmouseover="showTip(event, 'fs123', 364)" class="i">seriesLHMinusMu</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs121', 365)" onmouseover="showTip(event, 'fs121', 365)" class="i">ewmaReturnsLH</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs119', 366)" onmouseover="showTip(event, 'fs119', 366)" class="i">seriesMeanLHS</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs124', 367)" onmouseover="showTip(event, 'fs124', 367)" class="i">seriesRHMinusMu</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs122', 368)" onmouseover="showTip(event, 'fs122', 368)" class="i">ewmaReturnsRH</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs120', 369)" onmouseover="showTip(event, 'fs120', 369)" class="i">seriesMeanRHS</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs125', 370)" onmouseover="showTip(event, 'fs125', 370)" class="i">ewmaCovar</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs123', 371)" onmouseover="showTip(event, 'fs123', 371)" class="i">seriesLHMinusMu</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs124', 372)" onmouseover="showTip(event, 'fs124', 372)" class="i">seriesRHMinusMu</span>

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs126', 373)" onmouseover="showTip(event, 'fs126', 373)" class="i">uncCovarInit</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs117', 374)" onmouseover="showTip(event, 'fs117', 374)" class="i">uncVarInit</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs118', 375)" onmouseover="showTip(event, 'fs118', 375)" class="i">covarScale</span>

        <span class="c">// EWMA of series</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs127', 376)" onmouseover="showTip(event, 'fs127', 376)" class="i">ewmaWeightedCovar</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs125', 377)" onmouseover="showTip(event, 'fs125', 377)" class="i">ewmaCovar</span>      
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 378)" onmouseover="showTip(event, 'fs15', 378)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 379)" onmouseover="showTip(event, 'fs70', 379)" class="f">scanValues</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs71', 380)" onmouseover="showTip(event, 'fs71', 380)" class="i">lastweightedCovar</span> <span onmouseout="hideTip(event, 'fs72', 381)" onmouseover="showTip(event, 'fs72', 381)" class="i">thisCovar</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs116', 382)" onmouseover="showTip(event, 'fs116', 382)" class="i">lambda</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs71', 383)" onmouseover="showTip(event, 'fs71', 383)" class="i">lastweightedCovar</span> <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs116', 384)" onmouseover="showTip(event, 'fs116', 384)" class="i">lambda</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs72', 385)" onmouseover="showTip(event, 'fs72', 385)" class="i">thisCovar</span> ) <span onmouseout="hideTip(event, 'fs126', 386)" onmouseover="showTip(event, 'fs126', 386)" class="i">uncCovarInit</span>
    
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs128', 387)" onmouseover="showTip(event, 'fs128', 387)" class="i">ewmaVarLH</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs123', 388)" onmouseover="showTip(event, 'fs123', 388)" class="i">seriesLHMinusMu</span>      
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 389)" onmouseover="showTip(event, 'fs15', 389)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 390)" onmouseover="showTip(event, 'fs70', 390)" class="f">scanValues</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs74', 391)" onmouseover="showTip(event, 'fs74', 391)" class="i">lastweightedVar</span> <span onmouseout="hideTip(event, 'fs75', 392)" onmouseover="showTip(event, 'fs75', 392)" class="i">thisVar</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs116', 393)" onmouseover="showTip(event, 'fs116', 393)" class="i">lambda</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs74', 394)" onmouseover="showTip(event, 'fs74', 394)" class="i">lastweightedVar</span> <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs116', 395)" onmouseover="showTip(event, 'fs116', 395)" class="i">lambda</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs75', 396)" onmouseover="showTip(event, 'fs75', 396)" class="i">thisVar</span> <span class="o">**</span> <span class="n">2.0</span> ) <span onmouseout="hideTip(event, 'fs117', 397)" onmouseover="showTip(event, 'fs117', 397)" class="i">uncVarInit</span>

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs129', 398)" onmouseover="showTip(event, 'fs129', 398)" class="i">ewmaVarRH</span> <span class="o">=</span> 
            <span onmouseout="hideTip(event, 'fs124', 399)" onmouseover="showTip(event, 'fs124', 399)" class="i">seriesRHMinusMu</span>      
            <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 400)" onmouseover="showTip(event, 'fs15', 400)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs70', 401)" onmouseover="showTip(event, 'fs70', 401)" class="f">scanValues</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs74', 402)" onmouseover="showTip(event, 'fs74', 402)" class="i">lastweightedVar</span> <span onmouseout="hideTip(event, 'fs75', 403)" onmouseover="showTip(event, 'fs75', 403)" class="i">thisVar</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs116', 404)" onmouseover="showTip(event, 'fs116', 404)" class="i">lambda</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs74', 405)" onmouseover="showTip(event, 'fs74', 405)" class="i">lastweightedVar</span> <span class="o">+</span> (<span class="n">1.0</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs116', 406)" onmouseover="showTip(event, 'fs116', 406)" class="i">lambda</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs75', 407)" onmouseover="showTip(event, 'fs75', 407)" class="i">thisVar</span> <span class="o">**</span> <span class="n">2.0</span> ) <span onmouseout="hideTip(event, 'fs117', 408)" onmouseover="showTip(event, 'fs117', 408)" class="i">uncVarInit</span>

        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs130', 409)" onmouseover="showTip(event, 'fs130', 409)" class="i">ewmaCorrel</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs127', 410)" onmouseover="showTip(event, 'fs127', 410)" class="i">ewmaWeightedCovar</span> <span class="o">/</span> (<span onmouseout="hideTip(event, 'fs128', 411)" onmouseover="showTip(event, 'fs128', 411)" class="i">ewmaVarLH</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs129', 412)" onmouseover="showTip(event, 'fs129', 412)" class="i">ewmaVarRH</span>) <span class="o">**</span> <span class="n">0.5</span>
        <span class="c">// finally, the contribution to the current unconditional correlation matrix for this pair is the ewmaCorrel value at the calibration date</span>
        <span onmouseout="hideTip(event, 'fs130', 413)" onmouseover="showTip(event, 'fs130', 413)" class="i">ewmaCorrel</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs79', 414)" onmouseover="showTip(event, 'fs79', 414)" class="f">Get</span>(<span onmouseout="hideTip(event, 'fs81', 415)" onmouseover="showTip(event, 'fs81', 415)" class="i">calibrationDate</span>)

<span class="c">// We will (possibly incorrectly, but this matches the RWTS DB code) assume that the constants are the same for each pair of assets </span>
<span class="c">// - in practice we may need the underlying economy info correct lambda and asset scaling factor</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs131', 416)" onmouseover="showTip(event, 'fs131', 416)" class="f">defaultGetUncCorrelFromPair</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs115', 417)" onmouseover="showTip(event, 'fs115', 417)" class="f">getUncCorrelFromPair</span> <span class="n">0.99</span> <span class="n">0.005625</span> <span class="n">0.5</span>

<span class="c">// And we can now return the Unc. correlation as above</span>
<span onmouseout="hideTip(event, 'fs131', 418)" onmouseover="showTip(event, 'fs131', 418)" class="f">defaultGetUncCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs52', 419)" onmouseover="showTip(event, 'fs52', 419)" class="i">oldCalibrationDate</span> <span class="s">&quot;E_AUD&quot;</span> <span class="s">&quot;E_HKD&quot;</span> <span class="c">//  = 0.53407839</span>

<span class="c">// Finally, we can use this function to get a &quot;matrix&quot; of Unconditional correlations</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs132', 420)" onmouseover="showTip(event, 'fs132', 420)" class="i">testUncMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs98', 421)" onmouseover="showTip(event, 'fs98', 421)" class="f">getCorrelMatrix</span> <span onmouseout="hideTip(event, 'fs28', 422)" onmouseover="showTip(event, 'fs28', 422)" class="i">calibrationDate</span> <span onmouseout="hideTip(event, 'fs131', 423)" onmouseover="showTip(event, 'fs131', 423)" class="f">defaultGetUncCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs93', 424)" onmouseover="showTip(event, 'fs93', 424)" class="i">assetList</span>
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>{assets = ["ASX_200_A_REIT"; "ASX_200_BANKS"; "China_25"];
 matrix =
  DenseMatrix 3x3-Double
       1  0.539066  0.413654
0.539066         1  0.507693
0.413654  0.507693         1
;}</code></pre></td></tr></table>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// A few more test cases</span>
<span onmouseout="hideTip(event, 'fs80', 425)" onmouseover="showTip(event, 'fs80', 425)" class="f">get10YCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs52', 426)" onmouseover="showTip(event, 'fs52', 426)" class="i">oldCalibrationDate</span> <span class="s">&quot;E_GBP&quot;</span> <span class="s">&quot;E_USD&quot;</span> 
<span onmouseout="hideTip(event, 'fs131', 427)" onmouseover="showTip(event, 'fs131', 427)" class="f">defaultGetUncCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs52', 428)" onmouseover="showTip(event, 'fs52', 428)" class="i">oldCalibrationDate</span> <span class="s">&quot;E_AUD&quot;</span> <span class="s">&quot;E_GBP&quot;</span>
<span onmouseout="hideTip(event, 'fs131', 429)" onmouseover="showTip(event, 'fs131', 429)" class="f">defaultGetUncCorrelFromPair</span> <span onmouseout="hideTip(event, 'fs52', 430)" onmouseover="showTip(event, 'fs52', 430)" class="i">oldCalibrationDate</span> <span class="s">&quot;E_GBP&quot;</span> <span class="s">&quot;E_USD&quot;</span>
</code></pre></td>
</tr>
</table>
<a name="fullmatrix"></a>
<h1>Full correlation matrix from portfolio information</h1>
<p>We can import the full portfolio list, and calculate the full correlation matrix.</p>
<p>We are ignoring the individual scaling parameters for now.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs133', 431)" onmouseover="showTip(event, 'fs133', 431)" class="i">fullAssetInfo</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs10', 432)" onmouseover="showTip(event, 'fs10', 432)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 433)" onmouseover="showTip(event, 'fs22', 433)" class="f">ReadCsv</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 434)" onmouseover="showTip(event, 'fs12', 434)" class="t">string</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs7', 435)" onmouseover="showTip(event, 'fs7', 435)" class="i">root</span> <span class="o">+</span> <span class="s">&quot;AssetsList_Prod_EndDec2016.csv&quot;</span>, <span class="i">indexCol</span><span class="o">=</span><span class="s">&quot;Economy&quot;</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 436)" onmouseover="showTip(event, 'fs10', 436)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 437)" onmouseover="showTip(event, 'fs23', 437)" class="f">sortRowsByKey</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class="grid live-grid" id="fslab-grid-37340-1">
  <table>
    <thead>
      <tr class="head"><th>#</th><th>&nbsp;</th></tr>
    </thead>
    <tbody class="body">
      <tr><th>&nbsp;</th><td>&nbsp;</td></tr>
    </tbody>
  </table>
  <div class="scroller">
    <div class="spacer"></div>
  </div>
</div>
</div>
<p>We can calculate the correlation matrices for all required assets in the input portfolio.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs134', 438)" onmouseover="showTip(event, 'fs134', 438)" class="i">full10YMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs98', 439)" onmouseover="showTip(event, 'fs98', 439)" class="f">getCorrelMatrix</span> <span onmouseout="hideTip(event, 'fs28', 440)" onmouseover="showTip(event, 'fs28', 440)" class="i">calibrationDate</span> <span onmouseout="hideTip(event, 'fs80', 441)" onmouseover="showTip(event, 'fs80', 441)" class="f">get10YCorrelFromPair</span> (<span onmouseout="hideTip(event, 'fs133', 442)" onmouseover="showTip(event, 'fs133', 442)" class="i">fullAssetInfo</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs135', 443)" onmouseover="showTip(event, 'fs135', 443)" class="i">RowKeys</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 444)" onmouseover="showTip(event, 'fs50', 444)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 445)" onmouseover="showTip(event, 'fs136', 445)" class="f">toList</span>)
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
1 & 0.63 & 0.42 & 0.25 & 0.75 & 0.14 & \cdots & 0.73 & 0.44 & 0.54\\ 
0.63 & 1 & 0.51 & 0.5 & 0.71 & 0.14 & \cdots & 0.77 & 0.57 & 0.61\\ 
0.42 & 0.51 & 1 & 0.72 & 0.58 & 0.25 & \cdots & 0.52 & 0.53 & 0.55\\ 
0.25 & 0.5 & 0.72 & 1 & 0.37 & 0.032 & \cdots & 0.34 & 0.44 & 0.38\\ 
0.75 & 0.71 & 0.58 & 0.37 & 1 & 0.35 & \cdots & 0.83 & 0.63 & 0.61\\ 
0.14 & 0.14 & 0.25 & 0.032 & 0.35 & 1 & \cdots & 0.31 & 0.17 & 0.44\\ 
0.74 & 0.79 & 0.67 & 0.42 & 0.85 & 0.33 & \cdots & 0.79 & 0.72 & 0.69\\ 
0.72 & 0.64 & 0.47 & 0.36 & 0.75 & 0.42 & \cdots & 0.68 & 0.69 & 0.83\\ 
0.34 & 0.39 & 0.62 & 0.3 & 0.54 & 0.5 & \cdots & 0.45 & 0.55 & 0.58\\ 
0.68 & 0.89 & 0.7 & 0.57 & 0.79 & 0.39 & \cdots & 0.8 & 0.69 & 0.7\\ 
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots\\ 
0.75 & 0.71 & 0.61 & 0.38 & 0.98 & 0.35 & \cdots & 0.8 & 0.68 & 0.66\\ 
0.73 & 0.77 & 0.52 & 0.34 & 0.83 & 0.31 & \cdots & 1 & 0.59 & 0.46\\ 
0.44 & 0.57 & 0.53 & 0.44 & 0.63 & 0.17 & \cdots & 0.59 & 1 & 0.55\\ 
0.54 & 0.61 & 0.55 & 0.38 & 0.61 & 0.44 & \cdots & 0.46 & 0.55 & 1
\end{bmatrix}$$</div></div>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs137', 446)" onmouseover="showTip(event, 'fs137', 446)" class="i">fullUncMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs98', 447)" onmouseover="showTip(event, 'fs98', 447)" class="f">getCorrelMatrix</span> <span onmouseout="hideTip(event, 'fs28', 448)" onmouseover="showTip(event, 'fs28', 448)" class="i">calibrationDate</span> <span onmouseout="hideTip(event, 'fs131', 449)" onmouseover="showTip(event, 'fs131', 449)" class="f">defaultGetUncCorrelFromPair</span> (<span onmouseout="hideTip(event, 'fs133', 450)" onmouseover="showTip(event, 'fs133', 450)" class="i">fullAssetInfo</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs135', 451)" onmouseover="showTip(event, 'fs135', 451)" class="i">RowKeys</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 452)" onmouseover="showTip(event, 'fs50', 452)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 453)" onmouseover="showTip(event, 'fs136', 453)" class="f">toList</span>)
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
1 & 0.54 & 0.41 & 0.33 & 0.55 & 0.27 & \cdots & 0.55 & 0.4 & 0.47\\ 
0.54 & 1 & 0.51 & 0.47 & 0.57 & 0.29 & \cdots & 0.61 & 0.52 & 0.5\\ 
0.41 & 0.51 & 1 & 0.66 & 0.53 & 0.32 & \cdots & 0.54 & 0.51 & 0.44\\ 
0.33 & 0.47 & 0.66 & 1 & 0.37 & 0.19 & \cdots & 0.36 & 0.42 & 0.35\\ 
0.55 & 0.57 & 0.53 & 0.37 & 1 & 0.28 & \cdots & 0.68 & 0.5 & 0.51\\ 
0.27 & 0.29 & 0.32 & 0.19 & 0.28 & 1 & \cdots & 0.3 & 0.27 & 0.45\\ 
0.54 & 0.6 & 0.58 & 0.41 & 0.71 & 0.28 & \cdots & 0.6 & 0.56 & 0.52\\ 
0.55 & 0.54 & 0.49 & 0.38 & 0.66 & 0.32 & \cdots & 0.59 & 0.59 & 0.55\\ 
0.31 & 0.38 & 0.63 & 0.37 & 0.38 & 0.36 & \cdots & 0.39 & 0.37 & 0.4\\ 
0.55 & 0.69 & 0.59 & 0.49 & 0.63 & 0.33 & \cdots & 0.64 & 0.47 & 0.54\\ 
\vdots & \vdots & \vdots & \vdots & \vdots & \vdots & \ddots & \vdots & \vdots & \vdots\\ 
0.54 & 0.56 & 0.55 & 0.38 & 0.8 & 0.26 & \cdots & 0.62 & 0.55 & 0.53\\ 
0.55 & 0.61 & 0.54 & 0.36 & 0.68 & 0.3 & \cdots & 1 & 0.57 & 0.44\\ 
0.4 & 0.52 & 0.51 & 0.42 & 0.5 & 0.27 & \cdots & 0.57 & 1 & 0.46\\ 
0.47 & 0.5 & 0.44 & 0.35 & 0.51 & 0.45 & \cdots & 0.44 & 0.46 & 1
\end{bmatrix}$$</div></div>
<a name="eurextend"></a>
<h1>Adding the E_EUR asset</h1>
<p>In order to calculate the E_EUR asset, we will need to be able to switch between a correlation matrix and volatility vector to a covariance matrix and back again.</p>
<p>We can use the Matrix type in the MathNet.Numerics.LinearAlgebra package to produce the helper functions that we need.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// We can define some simple example correlation, covariance and volatility(sigma) parameters</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs138', 454)" onmouseover="showTip(event, 'fs138', 454)" class="i">correl</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs45', 455)" onmouseover="showTip(event, 'fs45', 455)" class="f">matrix</span> [[<span class="n">1.0</span>;<span class="o">-</span><span class="n">0.5</span>]
                     [<span class="o">-</span><span class="n">0.5</span>;<span class="n">1.0</span>]]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs139', 456)" onmouseover="showTip(event, 'fs139', 456)" class="i">sigma</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs140', 457)" onmouseover="showTip(event, 'fs140', 457)" class="f">vector</span> [<span class="n">0.5</span>;<span class="n">2.0</span>]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs141', 458)" onmouseover="showTip(event, 'fs141', 458)" class="i">cov</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs45', 459)" onmouseover="showTip(event, 'fs45', 459)" class="f">matrix</span>  [[<span class="n">0.25</span>;<span class="o">-</span><span class="n">0.5</span>]
                   [<span class="o">-</span><span class="n">0.5</span>;<span class="n">4.0</span>]]

<span class="c">// We can switch to covariance given the correlation matrix and volatility vector</span>
<span class="c">// Where covar(i,j) = corr(i,j) * var(i) * var(j)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs142', 460)" onmouseover="showTip(event, 'fs142', 460)" class="f">cor2cov</span> (<span onmouseout="hideTip(event, 'fs143', 461)" onmouseover="showTip(event, 'fs143', 461)" class="i">cor</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs48', 462)" onmouseover="showTip(event, 'fs48', 462)" class="t">Matrix</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 463)" onmouseover="showTip(event, 'fs20', 463)" class="t">float</span><span class="o">&gt;</span>) (<span onmouseout="hideTip(event, 'fs144', 464)" onmouseover="showTip(event, 'fs144', 464)" class="i">vol</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs145', 465)" onmouseover="showTip(event, 'fs145', 465)" class="t">Vector</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 466)" onmouseover="showTip(event, 'fs20', 466)" class="t">float</span><span class="o">&gt;</span>) <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs146', 467)" onmouseover="showTip(event, 'fs146', 467)" class="i">varmatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 468)" onmouseover="showTip(event, 'fs144', 468)" class="i">vol</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs147', 469)" onmouseover="showTip(event, 'fs147', 469)" class="f">ToColumnMatrix</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs144', 470)" onmouseover="showTip(event, 'fs144', 470)" class="i">vol</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs148', 471)" onmouseover="showTip(event, 'fs148', 471)" class="f">ToRowMatrix</span>()
    <span onmouseout="hideTip(event, 'fs146', 472)" onmouseover="showTip(event, 'fs146', 472)" class="i">varmatrix</span> <span class="o">.</span><span class="o">*</span> <span onmouseout="hideTip(event, 'fs143', 473)" onmouseover="showTip(event, 'fs143', 473)" class="i">cor</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs149', 474)" onmouseover="showTip(event, 'fs149', 474)" class="i">calcCov</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs142', 475)" onmouseover="showTip(event, 'fs142', 475)" class="f">cor2cov</span> <span onmouseout="hideTip(event, 'fs138', 476)" onmouseover="showTip(event, 'fs138', 476)" class="i">correl</span> <span onmouseout="hideTip(event, 'fs139', 477)" onmouseover="showTip(event, 'fs139', 477)" class="i">sigma</span>
<span onmouseout="hideTip(event, 'fs149', 478)" onmouseover="showTip(event, 'fs149', 478)" class="i">calcCov</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs141', 479)" onmouseover="showTip(event, 'fs141', 479)" class="i">cov</span>

<span class="c">// And we can switch back again from the covariance matrix to produce the correlation and vol vector as a tuple (matrix * vector)</span>
<span class="c">// Where vol(i) = var(i) ** 2 (take the diagonal of the covar matrix  to get variances)</span>
<span class="c">// and corr(i,j) = covar(i,j) / vol(i)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs150', 480)" onmouseover="showTip(event, 'fs150', 480)" class="f">cov2corVol</span> (<span onmouseout="hideTip(event, 'fs151', 481)" onmouseover="showTip(event, 'fs151', 481)" class="i">cov</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs48', 482)" onmouseover="showTip(event, 'fs48', 482)" class="t">Matrix</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 483)" onmouseover="showTip(event, 'fs20', 483)" class="t">float</span><span class="o">&gt;</span>) <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs144', 484)" onmouseover="showTip(event, 'fs144', 484)" class="i">vol</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs151', 485)" onmouseover="showTip(event, 'fs151', 485)" class="i">cov</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs152', 486)" onmouseover="showTip(event, 'fs152', 486)" class="f">Diagonal</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 487)" onmouseover="showTip(event, 'fs145', 487)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 488)" onmouseover="showTip(event, 'fs153', 488)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs154', 489)" onmouseover="showTip(event, 'fs154', 489)" class="i">x</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs154', 490)" onmouseover="showTip(event, 'fs154', 490)" class="i">x</span> <span class="o">**</span> <span class="n">0.5</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs146', 491)" onmouseover="showTip(event, 'fs146', 491)" class="i">varmatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs144', 492)" onmouseover="showTip(event, 'fs144', 492)" class="i">vol</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs147', 493)" onmouseover="showTip(event, 'fs147', 493)" class="f">ToColumnMatrix</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs144', 494)" onmouseover="showTip(event, 'fs144', 494)" class="i">vol</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs148', 495)" onmouseover="showTip(event, 'fs148', 495)" class="f">ToRowMatrix</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs155', 496)" onmouseover="showTip(event, 'fs155', 496)" class="i">calcCorr</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs151', 497)" onmouseover="showTip(event, 'fs151', 497)" class="i">cov</span> <span class="o">.</span><span class="o">/</span> <span onmouseout="hideTip(event, 'fs146', 498)" onmouseover="showTip(event, 'fs146', 498)" class="i">varmatrix</span>
    (<span onmouseout="hideTip(event, 'fs155', 499)" onmouseover="showTip(event, 'fs155', 499)" class="i">calcCorr</span>, <span onmouseout="hideTip(event, 'fs144', 500)" onmouseover="showTip(event, 'fs144', 500)" class="i">vol</span>)

<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs156', 501)" onmouseover="showTip(event, 'fs156', 501)" class="i">calcCor</span>, <span onmouseout="hideTip(event, 'fs157', 502)" onmouseover="showTip(event, 'fs157', 502)" class="i">calcVol</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs150', 503)" onmouseover="showTip(event, 'fs150', 503)" class="f">cov2corVol</span> <span onmouseout="hideTip(event, 'fs149', 504)" onmouseover="showTip(event, 'fs149', 504)" class="i">calcCov</span>

<span onmouseout="hideTip(event, 'fs157', 505)" onmouseover="showTip(event, 'fs157', 505)" class="i">calcVol</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs139', 506)" onmouseover="showTip(event, 'fs139', 506)" class="i">sigma</span>
<span onmouseout="hideTip(event, 'fs156', 507)" onmouseover="showTip(event, 'fs156', 507)" class="i">calcCor</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs138', 508)" onmouseover="showTip(event, 'fs138', 508)" class="i">correl</span>

<span class="c">// To show this in action, we can use the small test matrix from above, and the corresponding vol vector</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs158', 509)" onmouseover="showTip(event, 'fs158', 509)" class="i">testCorrMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs132', 510)" onmouseover="showTip(event, 'fs132', 510)" class="i">testUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 511)" onmouseover="showTip(event, 'fs97', 511)" class="i">matrix</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
1 & 0.54 & 0.41\\ 
0.54 & 1 & 0.51\\ 
0.41 & 0.51 & 1
\end{bmatrix}$$</div></div>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// And we can take some example Unconditional Volatility values, and create a vector of these</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs159', 512)" onmouseover="showTip(event, 'fs159', 512)" class="i">testVolVector</span> <span class="o">=</span> [<span class="n">0.1875</span>;<span class="n">0.165</span>;<span class="n">0.2810</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 513)" onmouseover="showTip(event, 'fs96', 513)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs160', 514)" onmouseover="showTip(event, 'fs160', 514)" class="f">toSeq</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 515)" onmouseover="showTip(event, 'fs145', 515)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs161', 516)" onmouseover="showTip(event, 'fs161', 516)" class="i">Build</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 517)" onmouseover="showTip(event, 'fs162', 517)" class="f">DenseOfEnumerable</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
0.19 & 0.17 & 0.28
\end{bmatrix}$$</div></div>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// We can now convert these to a covariance matrix</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs163', 518)" onmouseover="showTip(event, 'fs163', 518)" class="i">innerTestCovar</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs142', 519)" onmouseover="showTip(event, 'fs142', 519)" class="f">cor2cov</span> <span onmouseout="hideTip(event, 'fs132', 520)" onmouseover="showTip(event, 'fs132', 520)" class="i">testUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 521)" onmouseover="showTip(event, 'fs97', 521)" class="i">matrix</span> <span onmouseout="hideTip(event, 'fs159', 522)" onmouseover="showTip(event, 'fs159', 522)" class="i">testVolVector</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
0.035 & 0.017 & 0.022\\ 
0.017 & 0.027 & 0.024\\ 
0.022 & 0.024 & 0.079
\end{bmatrix}$$</div></div>
<p>To add the E<em>EUR asset to this matrix, we need to know the market cap adjusted weight of each asset in the synthetic E</em>EUR asset.</p>
<p>We can declare this for our test list of assets as:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// An example weighting scheme for the definition of the E_EUR asset</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs164', 523)" onmouseover="showTip(event, 'fs164', 523)" class="i">testEURWeights</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs145', 524)" onmouseover="showTip(event, 'fs145', 524)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs161', 525)" onmouseover="showTip(event, 'fs161', 525)" class="i">Build</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 526)" onmouseover="showTip(event, 'fs162', 526)" class="f">DenseOfEnumerable</span>([<span class="n">0.5</span>;<span class="n">0.25</span>;<span class="n">0.25</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 527)" onmouseover="showTip(event, 'fs96', 527)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs160', 528)" onmouseover="showTip(event, 'fs160', 528)" class="f">toSeq</span> )

<span class="c">// The E_EUR Vs. Other asset covariance can then be calculated </span>
<span class="c">// EUR_Covar(i) = weightInEUR * covar(i)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs165', 529)" onmouseover="showTip(event, 'fs165', 529)" class="i">testEURVsAssetCovar</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs164', 530)" onmouseover="showTip(event, 'fs164', 530)" class="i">testEURWeights</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs148', 531)" onmouseover="showTip(event, 'fs148', 531)" class="f">ToRowMatrix</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs163', 532)" onmouseover="showTip(event, 'fs163', 532)" class="i">innerTestCovar</span>

<span class="c">// Given this, we can use the same function to calculate the E_EUR Vs E_EUR covariance (or variance, as it is with itself)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs166', 533)" onmouseover="showTip(event, 'fs166', 533)" class="i">testEURVariance</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs164', 534)" onmouseover="showTip(event, 'fs164', 534)" class="i">testEURWeights</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs148', 535)" onmouseover="showTip(event, 'fs148', 535)" class="f">ToRowMatrix</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs165', 536)" onmouseover="showTip(event, 'fs165', 536)" class="i">testEURVsAssetCovar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs167', 537)" onmouseover="showTip(event, 'fs167', 537)" class="f">Transpose</span>()
</code></pre></td>
</tr>
</table>
<p>We can now assemble the full covar matrix with E_EUR by joining the pieces together</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs168', 538)" onmouseover="showTip(event, 'fs168', 538)" class="i">testInnerCovarWithEURTopRow</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs165', 539)" onmouseover="showTip(event, 'fs165', 539)" class="i">testEURVsAssetCovar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs169', 540)" onmouseover="showTip(event, 'fs169', 540)" class="f">Stack</span>(<span onmouseout="hideTip(event, 'fs163', 541)" onmouseover="showTip(event, 'fs163', 541)" class="i">innerTestCovar</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs170', 542)" onmouseover="showTip(event, 'fs170', 542)" class="i">testFullTransposedEURVsAssetCovar</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs166', 543)" onmouseover="showTip(event, 'fs166', 543)" class="i">testEURVariance</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs169', 544)" onmouseover="showTip(event, 'fs169', 544)" class="f">Stack</span>(<span onmouseout="hideTip(event, 'fs165', 545)" onmouseover="showTip(event, 'fs165', 545)" class="i">testEURVsAssetCovar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs167', 546)" onmouseover="showTip(event, 'fs167', 546)" class="f">Transpose</span>())
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs171', 547)" onmouseover="showTip(event, 'fs171', 547)" class="i">testFullCovarWithEUR</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs170', 548)" onmouseover="showTip(event, 'fs170', 548)" class="i">testFullTransposedEURVsAssetCovar</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs172', 549)" onmouseover="showTip(event, 'fs172', 549)" class="f">Append</span>(<span onmouseout="hideTip(event, 'fs168', 550)" onmouseover="showTip(event, 'fs168', 550)" class="i">testInnerCovarWithEURTopRow</span>)
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
0.028 & 0.027 & 0.021 & 0.037\\ 
0.027 & 0.035 & 0.017 & 0.022\\ 
0.021 & 0.017 & 0.027 & 0.024\\ 
0.037 & 0.022 & 0.024 & 0.079
\end{bmatrix}$$</div></div>
<p>We can now calculate:
+ The E<em>EUR asset unconditional volatility, and append this to the volatility vector
+ The full correlation matrix, including E</em>EUR</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// And we can now use the full matrix and full vol vector to calculate the correlation matrix</span>
<span class="c">// This will also give us the volatilty vector, so we have a full vector that matches the full covar matrix</span>
<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs173', 551)" onmouseover="showTip(event, 'fs173', 551)" class="i">testFullCorr</span>, <span onmouseout="hideTip(event, 'fs174', 552)" onmouseover="showTip(event, 'fs174', 552)" class="i">testFullVolVectorWithEUR</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs150', 553)" onmouseover="showTip(event, 'fs150', 553)" class="f">cov2corVol</span> <span onmouseout="hideTip(event, 'fs171', 554)" onmouseover="showTip(event, 'fs171', 554)" class="i">testFullCovarWithEUR</span>
</code></pre></td>
</tr>
</table>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
1 & 0.87 & 0.76 & 0.78\\ 
0.87 & 1 & 0.54 & 0.41\\ 
0.76 & 0.54 & 1 & 0.51\\ 
0.78 & 0.41 & 0.51 & 1
\end{bmatrix}$$</div></div>
<div class="fslab-html-output"><div class='mathnet'>$$\begin{bmatrix}
0.17 & 0.19 & 0.17 & 0.28
\end{bmatrix}$$</div></div>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// finally, we can pick up the E_EUR volatilty as the first entry in the new volatility vector</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs175', 555)" onmouseover="showTip(event, 'fs175', 555)" class="i">testEURUncVol</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs174', 556)" onmouseover="showTip(event, 'fs174', 556)" class="i">testFullVolVectorWithEUR</span><span class="o">.</span>[<span class="n">0</span>]
</code></pre></td>
</tr>
</table>
<table class="pre"><tr><td><pre><code>0.1672902546</code></pre></td></tr></table>
<p>The E_EUR vol will need to be pushed to the database as the "Unconditional Vol" for this asset.</p>
<h1>Adding E_SKK</h1>
<p>TO BE DETERMINED IF WE NEED TO DO THIS.</p>
<a name="portfolio"></a>
<h1>Portfolio Calculations</h1>
<p>Given the (final) correlation matrix, and the individual asset Unconditional Volatility numbers, we can move on to calculate the Beta, Market Price of Risk and Risk Premium.</p>
<p>In this section, I will show a very small set of assets as an example case. The market numbers here are made up for example purposes.</p>
<p>We must first define our global equity asset portfolio. This comprises of:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// we have a covariance matrix and a list of assets from above</span>
<span onmouseout="hideTip(event, 'fs132', 606)" onmouseover="showTip(event, 'fs132', 606)" class="i">testUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 607)" onmouseover="showTip(event, 'fs97', 607)" class="i">matrix</span>
<span onmouseout="hideTip(event, 'fs132', 608)" onmouseover="showTip(event, 'fs132', 608)" class="i">testUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs95', 609)" onmouseover="showTip(event, 'fs95', 609)" class="i">assets</span>

<span class="c">// We will need to pull in the Unconditional vols for each asset. Here, we will make up some values for the example</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs191', 610)" onmouseover="showTip(event, 'fs191', 610)" class="i">unconditionalVols</span> <span class="o">=</span> [<span class="n">0.1875</span>;<span class="n">0.165</span>;<span class="n">0.2810</span>]

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs192', 611)" onmouseover="showTip(event, 'fs192', 611)" class="i">uncCovarMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs142', 612)" onmouseover="showTip(event, 'fs142', 612)" class="f">cor2cov</span> <span onmouseout="hideTip(event, 'fs132', 613)" onmouseover="showTip(event, 'fs132', 613)" class="i">testUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 614)" onmouseover="showTip(event, 'fs97', 614)" class="i">matrix</span> (<span onmouseout="hideTip(event, 'fs191', 615)" onmouseover="showTip(event, 'fs191', 615)" class="i">unconditionalVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 616)" onmouseover="showTip(event, 'fs96', 616)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs160', 617)" onmouseover="showTip(event, 'fs160', 617)" class="f">toSeq</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 618)" onmouseover="showTip(event, 'fs145', 618)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs161', 619)" onmouseover="showTip(event, 'fs161', 619)" class="i">Build</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 620)" onmouseover="showTip(event, 'fs162', 620)" class="f">DenseOfEnumerable</span>)

<span class="c">// The assumed return on the market portfolio</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs193', 621)" onmouseover="showTip(event, 'fs193', 621)" class="i">marketPfReturn</span> <span class="o">=</span> <span class="n">0.04</span>

<span class="c">// The market capitalisation of each asset, at the current calibration date (this will be the latest value in the underlying time series)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs194', 622)" onmouseover="showTip(event, 'fs194', 622)" class="i">marketCap</span> <span class="o">=</span> [<span class="n">1000.0</span>;<span class="n">200.0</span>;<span class="n">1500.0</span>] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 623)" onmouseover="showTip(event, 'fs96', 623)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 624)" onmouseover="showTip(event, 'fs104', 624)" class="f">zip</span> <span onmouseout="hideTip(event, 'fs93', 625)" onmouseover="showTip(event, 'fs93', 625)" class="i">assetList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs195', 626)" onmouseover="showTip(event, 'fs195', 626)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs196', 627)" onmouseover="showTip(event, 'fs196', 627)" class="f">ofList</span>

<span class="c">// The portfolio weight is the ratio of the asset&#39;s market cap to the global total, multiplied by the 1 or 0 setting value that determines if the asset is in the PF</span>
<span class="c">// We will assume that all of these assets are in the portfolio</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs197', 628)" onmouseover="showTip(event, 'fs197', 628)" class="i">totalMarketCap</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs194', 629)" onmouseover="showTip(event, 'fs194', 629)" class="i">marketCap</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs195', 630)" onmouseover="showTip(event, 'fs195', 630)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs198', 631)" onmouseover="showTip(event, 'fs198', 631)" class="f">toList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 632)" onmouseover="showTip(event, 'fs96', 632)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs199', 633)" onmouseover="showTip(event, 'fs199', 633)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs200', 634)" onmouseover="showTip(event, 'fs200', 634)" class="i">k1</span>,<span onmouseout="hideTip(event, 'fs201', 635)" onmouseover="showTip(event, 'fs201', 635)" class="i">v1</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs201', 636)" onmouseover="showTip(event, 'fs201', 636)" class="i">v1</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 637)" onmouseover="showTip(event, 'fs96', 637)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs202', 638)" onmouseover="showTip(event, 'fs202', 638)" class="f">sum</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs203', 639)" onmouseover="showTip(event, 'fs203', 639)" class="i">portfolioWeight</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs194', 640)" onmouseover="showTip(event, 'fs194', 640)" class="i">marketCap</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs195', 641)" onmouseover="showTip(event, 'fs195', 641)" class="t">Map</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs204', 642)" onmouseover="showTip(event, 'fs204', 642)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs205', 643)" onmouseover="showTip(event, 'fs205', 643)" class="i">k</span> <span onmouseout="hideTip(event, 'fs206', 644)" onmouseover="showTip(event, 'fs206', 644)" class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs206', 645)" onmouseover="showTip(event, 'fs206', 645)" class="i">v</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs197', 646)" onmouseover="showTip(event, 'fs197', 646)" class="i">totalMarketCap</span> )

<span class="c">// To calculate the covariance, we need to use some matrix multiplication</span>
<span class="c">// So, we will convert the weights into a n * 1 matrix (or if you like, a vector)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs207', 647)" onmouseover="showTip(event, 'fs207', 647)" class="i">pfWeightsMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs45', 648)" onmouseover="showTip(event, 'fs45', 648)" class="f">matrix</span> [ <span onmouseout="hideTip(event, 'fs93', 649)" onmouseover="showTip(event, 'fs93', 649)" class="i">assetList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 650)" onmouseover="showTip(event, 'fs96', 650)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs199', 651)" onmouseover="showTip(event, 'fs199', 651)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs13', 652)" onmouseover="showTip(event, 'fs13', 652)" class="i">asset</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs203', 653)" onmouseover="showTip(event, 'fs203', 653)" class="i">portfolioWeight</span><span class="o">.</span>[<span onmouseout="hideTip(event, 'fs13', 654)" onmouseover="showTip(event, 'fs13', 654)" class="i">asset</span>]) ] <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs48', 655)" onmouseover="showTip(event, 'fs48', 655)" class="t">Matrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs208', 656)" onmouseover="showTip(event, 'fs208', 656)" class="f">transpose</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs209', 657)" onmouseover="showTip(event, 'fs209', 657)" class="i">pfCovariance</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs192', 658)" onmouseover="showTip(event, 'fs192', 658)" class="i">uncCovarMatrix</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs207', 659)" onmouseover="showTip(event, 'fs207', 659)" class="i">pfWeightsMatrix</span>)<span class="o">.</span><span class="f">Column</span>(<span class="n">0</span>)

<span class="c">// the market portfolio variance is equal to wT * Covar * w</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs210', 660)" onmouseover="showTip(event, 'fs210', 660)" class="i">marketPfVariance</span> <span class="o">=</span> (<span onmouseout="hideTip(event, 'fs207', 661)" onmouseover="showTip(event, 'fs207', 661)" class="i">pfWeightsMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs167', 662)" onmouseover="showTip(event, 'fs167', 662)" class="f">Transpose</span>() <span class="o">*</span> <span onmouseout="hideTip(event, 'fs192', 663)" onmouseover="showTip(event, 'fs192', 663)" class="i">uncCovarMatrix</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs207', 664)" onmouseover="showTip(event, 'fs207', 664)" class="i">pfWeightsMatrix</span>)<span class="o">.</span>[<span class="n">0</span>,<span class="n">0</span>]

<span class="c">// The market Beta for each asset is equal to covar/porfolioVar</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs211', 665)" onmouseover="showTip(event, 'fs211', 665)" class="i">marketBetas</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs209', 666)" onmouseover="showTip(event, 'fs209', 666)" class="i">pfCovariance</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 667)" onmouseover="showTip(event, 'fs50', 667)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs212', 668)" onmouseover="showTip(event, 'fs212', 668)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs213', 669)" onmouseover="showTip(event, 'fs213', 669)" class="i">cov</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs213', 670)" onmouseover="showTip(event, 'fs213', 670)" class="i">cov</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs210', 671)" onmouseover="showTip(event, 'fs210', 671)" class="i">marketPfVariance</span>)

<span class="c">// The risk premia can be calculated, these are equal to beta * pfReturn</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs214', 672)" onmouseover="showTip(event, 'fs214', 672)" class="i">riskPremia</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs211', 673)" onmouseover="showTip(event, 'fs211', 673)" class="i">marketBetas</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 674)" onmouseover="showTip(event, 'fs50', 674)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs212', 675)" onmouseover="showTip(event, 'fs212', 675)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs215', 676)" onmouseover="showTip(event, 'fs215', 676)" class="i">beta</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs215', 677)" onmouseover="showTip(event, 'fs215', 677)" class="i">beta</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs193', 678)" onmouseover="showTip(event, 'fs193', 678)" class="i">marketPfReturn</span>)

<span class="c">// The market price of risk (or Z-score) is equal to the risk premia / unconditional vol</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs216', 679)" onmouseover="showTip(event, 'fs216', 679)" class="i">zScores</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs214', 680)" onmouseover="showTip(event, 'fs214', 680)" class="i">riskPremia</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 681)" onmouseover="showTip(event, 'fs50', 681)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 682)" onmouseover="showTip(event, 'fs136', 682)" class="f">toList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 683)" onmouseover="showTip(event, 'fs96', 683)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs104', 684)" onmouseover="showTip(event, 'fs104', 684)" class="f">zip</span> <span onmouseout="hideTip(event, 'fs191', 685)" onmouseover="showTip(event, 'fs191', 685)" class="i">unconditionalVols</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs96', 686)" onmouseover="showTip(event, 'fs96', 686)" class="t">List</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs199', 687)" onmouseover="showTip(event, 'fs199', 687)" class="f">map</span> (<span class="k">fun</span> (<span onmouseout="hideTip(event, 'fs217', 688)" onmouseover="showTip(event, 'fs217', 688)" class="i">uncVol</span>, <span onmouseout="hideTip(event, 'fs218', 689)" onmouseover="showTip(event, 'fs218', 689)" class="i">riskPrem</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs218', 690)" onmouseover="showTip(event, 'fs218', 690)" class="i">riskPrem</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs217', 691)" onmouseover="showTip(event, 'fs217', 691)" class="i">uncVol</span>)
</code></pre></td>
</tr>
</table>
<a name="marketcaps"></a>
<h2>Extending the Portfolio Definition to include market caps</h2>
<p>We can import market caps for avaliable assets, and perform this analysis on the actual EndDec2016 data.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs230', 738)" onmouseover="showTip(event, 'fs230', 738)" class="i">marketCapInfo</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs10', 739)" onmouseover="showTip(event, 'fs10', 739)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs22', 740)" onmouseover="showTip(event, 'fs22', 740)" class="f">ReadCsv</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs12', 741)" onmouseover="showTip(event, 'fs12', 741)" class="t">string</span><span class="o">&gt;</span>(<span onmouseout="hideTip(event, 'fs7', 742)" onmouseover="showTip(event, 'fs7', 742)" class="i">root</span> <span class="o">+</span> <span class="s">&quot;MarketCaps_EndDec2016.csv&quot;</span>, <span class="i">indexCol</span><span class="o">=</span><span class="s">&quot;Economy&quot;</span>)
    <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 743)" onmouseover="showTip(event, 'fs10', 743)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs23', 744)" onmouseover="showTip(event, 'fs23', 744)" class="f">sortRowsByKey</span>
</code></pre></td>
</tr>
</table>
<p>We can now extend the fullAssetInfo to include this - missing market caps should be set to zero.<br />
We can set the weight in the portfolio for each asset.
Taking this further, we can get the weight in euro in much the same way .</p>
<p>Taking this further, we can get the weight in euro in much the same way</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs231', 745)" onmouseover="showTip(event, 'fs231', 745)" class="f">extendAssetInfoWithCaps</span> <span onmouseout="hideTip(event, 'fs232', 746)" onmouseover="showTip(event, 'fs232', 746)" class="i">info</span> <span onmouseout="hideTip(event, 'fs233', 747)" onmouseover="showTip(event, 'fs233', 747)" class="i">caps</span> <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs234', 748)" onmouseover="showTip(event, 'fs234', 748)" class="i">withCaps</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 749)" onmouseover="showTip(event, 'fs10', 749)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs235', 750)" onmouseover="showTip(event, 'fs235', 750)" class="f">join</span> <span onmouseout="hideTip(event, 'fs236', 751)" onmouseover="showTip(event, 'fs236', 751)" class="t">JoinKind</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs237', 752)" onmouseover="showTip(event, 'fs237', 752)" class="i">Left</span> <span onmouseout="hideTip(event, 'fs232', 753)" onmouseover="showTip(event, 'fs232', 753)" class="i">info</span> <span onmouseout="hideTip(event, 'fs233', 754)" onmouseover="showTip(event, 'fs233', 754)" class="i">caps</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs10', 755)" onmouseover="showTip(event, 'fs10', 755)" class="t">Frame</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs238', 756)" onmouseover="showTip(event, 'fs238', 756)" class="f">fillMissingWith</span> <span class="n">0.0</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs239', 757)" onmouseover="showTip(event, 'fs239', 757)" class="i">marketCapTotal</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs234', 758)" onmouseover="showTip(event, 'fs234', 758)" class="i">withCaps</span><span class="o">?</span><span class="i">MarketCap</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs234', 759)" onmouseover="showTip(event, 'fs234', 759)" class="i">withCaps</span><span class="o">?</span><span class="i">In_Market_Portfolio</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs240', 760)" onmouseover="showTip(event, 'fs240', 760)" class="t">Stats</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs241', 761)" onmouseover="showTip(event, 'fs241', 761)" class="f">sum</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs242', 762)" onmouseover="showTip(event, 'fs242', 762)" class="i">euroCapTotal</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs234', 763)" onmouseover="showTip(event, 'fs234', 763)" class="i">withCaps</span><span class="o">?</span><span class="i">MarketCap</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs234', 764)" onmouseover="showTip(event, 'fs234', 764)" class="i">withCaps</span><span class="o">?</span><span class="i">In_Euro</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs240', 765)" onmouseover="showTip(event, 'fs240', 765)" class="t">Stats</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs241', 766)" onmouseover="showTip(event, 'fs241', 766)" class="f">sum</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs243', 767)" onmouseover="showTip(event, 'fs243', 767)" class="i">weightInPf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs234', 768)" onmouseover="showTip(event, 'fs234', 768)" class="i">withCaps</span><span class="o">?</span><span class="i">MarketCap</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs234', 769)" onmouseover="showTip(event, 'fs234', 769)" class="i">withCaps</span><span class="o">?</span><span class="i">In_Market_Portfolio</span> <span class="o">/</span> <span onmouseout="hideTip(event, 'fs239', 770)" onmouseover="showTip(event, 'fs239', 770)" class="i">marketCapTotal</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs244', 771)" onmouseover="showTip(event, 'fs244', 771)" class="i">weightInEuroPf</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs234', 772)" onmouseover="showTip(event, 'fs234', 772)" class="i">withCaps</span><span class="o">?</span><span class="i">MarketCap</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs234', 773)" onmouseover="showTip(event, 'fs234', 773)" class="i">withCaps</span><span class="o">?</span><span class="i">In_Euro</span>  <span class="o">/</span> <span onmouseout="hideTip(event, 'fs242', 774)" onmouseover="showTip(event, 'fs242', 774)" class="i">euroCapTotal</span>
    <span onmouseout="hideTip(event, 'fs234', 775)" onmouseover="showTip(event, 'fs234', 775)" class="i">withCaps</span><span class="o">?</span><span onmouseout="hideTip(event, 'fs243', 776)" onmouseover="showTip(event, 'fs243', 776)" class="i">weightInPf</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs243', 777)" onmouseover="showTip(event, 'fs243', 777)" class="i">weightInPf</span>
    <span onmouseout="hideTip(event, 'fs234', 778)" onmouseover="showTip(event, 'fs234', 778)" class="i">withCaps</span><span class="o">?</span><span onmouseout="hideTip(event, 'fs244', 779)" onmouseover="showTip(event, 'fs244', 779)" class="i">weightInEuroPf</span> <span class="o">&lt;-</span> <span onmouseout="hideTip(event, 'fs244', 780)" onmouseover="showTip(event, 'fs244', 780)" class="i">weightInEuroPf</span>
    <span onmouseout="hideTip(event, 'fs234', 781)" onmouseover="showTip(event, 'fs234', 781)" class="i">withCaps</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs245', 782)" onmouseover="showTip(event, 'fs245', 782)" class="i">fullAssetInfoEuroCaps</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs231', 783)" onmouseover="showTip(event, 'fs231', 783)" class="f">extendAssetInfoWithCaps</span> <span onmouseout="hideTip(event, 'fs133', 784)" onmouseover="showTip(event, 'fs133', 784)" class="i">fullAssetInfo</span> <span onmouseout="hideTip(event, 'fs230', 785)" onmouseover="showTip(event, 'fs230', 785)" class="i">marketCapInfo</span>

<span class="c">// We can confirm that the weights sum to one in both cases</span>
<span onmouseout="hideTip(event, 'fs245', 786)" onmouseover="showTip(event, 'fs245', 786)" class="i">fullAssetInfoEuroCaps</span><span class="o">?</span><span class="i">weightInPf</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs240', 787)" onmouseover="showTip(event, 'fs240', 787)" class="t">Stats</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs241', 788)" onmouseover="showTip(event, 'fs241', 788)" class="f">sum</span>
<span onmouseout="hideTip(event, 'fs245', 789)" onmouseover="showTip(event, 'fs245', 789)" class="i">fullAssetInfoEuroCaps</span><span class="o">?</span><span class="i">weightInEuroPf</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs240', 790)" onmouseover="showTip(event, 'fs240', 790)" class="t">Stats</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs241', 791)" onmouseover="showTip(event, 'fs241', 791)" class="f">sum</span>

<span class="c">// And we can access the weights as a vector for use in the portfolio calculations</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs246', 792)" onmouseover="showTip(event, 'fs246', 792)" class="i">pfWeightsVector</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs245', 793)" onmouseover="showTip(event, 'fs245', 793)" class="i">fullAssetInfoEuroCaps</span><span class="o">?</span><span class="i">weightInPf</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs15', 794)" onmouseover="showTip(event, 'fs15', 794)" class="t">Series</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs247', 795)" onmouseover="showTip(event, 'fs247', 795)" class="f">values</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 796)" onmouseover="showTip(event, 'fs145', 796)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs161', 797)" onmouseover="showTip(event, 'fs161', 797)" class="i">Build</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs162', 798)" onmouseover="showTip(event, 'fs162', 798)" class="f">DenseOfEnumerable</span>
</code></pre></td>
</tr>
</table>
<a name="psd"></a>
<h1>Full Matrix PSD adjustment.</h1>
<p>We can use eigen decomposition to pull apart and rebuild a correlation matrix like so:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs257', 839)" onmouseover="showTip(event, 'fs257', 839)" class="f">decomposeMatrix</span> (<span onmouseout="hideTip(event, 'fs258', 840)" onmouseover="showTip(event, 'fs258', 840)" class="i">correlMatrix</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs48', 841)" onmouseover="showTip(event, 'fs48', 841)" class="t">Matrix</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 842)" onmouseover="showTip(event, 'fs20', 842)" class="t">float</span><span class="o">&gt;</span>) <span class="o">=</span> 
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs259', 843)" onmouseover="showTip(event, 'fs259', 843)" class="i">eigenDecomp</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs258', 844)" onmouseover="showTip(event, 'fs258', 844)" class="i">correlMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 845)" onmouseover="showTip(event, 'fs49', 845)" class="f">Evd</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs260', 846)" onmouseover="showTip(event, 'fs260', 846)" class="i">eigenValues</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs259', 847)" onmouseover="showTip(event, 'fs259', 847)" class="i">eigenDecomp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs261', 848)" onmouseover="showTip(event, 'fs261', 848)" class="i">EigenValues</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs262', 849)" onmouseover="showTip(event, 'fs262', 849)" class="f">Real</span>()
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs263', 850)" onmouseover="showTip(event, 'fs263', 850)" class="i">eigenVectors</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs259', 851)" onmouseover="showTip(event, 'fs259', 851)" class="i">eigenDecomp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs264', 852)" onmouseover="showTip(event, 'fs264', 852)" class="i">EigenVectors</span>
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs265', 853)" onmouseover="showTip(event, 'fs265', 853)" class="i">isPSD</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs260', 854)" onmouseover="showTip(event, 'fs260', 854)" class="i">eigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 855)" onmouseover="showTip(event, 'fs50', 855)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs51', 856)" onmouseover="showTip(event, 'fs51', 856)" class="f">min</span> <span class="o">&gt;</span><span class="o">=</span> <span class="n">0.000001</span>
    (<span onmouseout="hideTip(event, 'fs260', 857)" onmouseover="showTip(event, 'fs260', 857)" class="i">eigenValues</span>, <span onmouseout="hideTip(event, 'fs263', 858)" onmouseover="showTip(event, 'fs263', 858)" class="i">eigenVectors</span>, <span onmouseout="hideTip(event, 'fs265', 859)" onmouseover="showTip(event, 'fs265', 859)" class="i">isPSD</span>)

<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs266', 860)" onmouseover="showTip(event, 'fs266', 860)" class="i">testEigenValues</span>,<span onmouseout="hideTip(event, 'fs267', 861)" onmouseover="showTip(event, 'fs267', 861)" class="i">testEigenVectors</span>, <span onmouseout="hideTip(event, 'fs268', 862)" onmouseover="showTip(event, 'fs268', 862)" class="i">testIsPSD</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs257', 863)" onmouseover="showTip(event, 'fs257', 863)" class="f">decomposeMatrix</span> <span onmouseout="hideTip(event, 'fs173', 864)" onmouseover="showTip(event, 'fs173', 864)" class="i">testFullCorr</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs269', 865)" onmouseover="showTip(event, 'fs269', 865)" class="f">reconstructMatrixFromEigenDecomposition</span> (<span onmouseout="hideTip(event, 'fs263', 866)" onmouseover="showTip(event, 'fs263', 866)" class="i">eigenVectors</span><span class="o">:</span> <span onmouseout="hideTip(event, 'fs48', 867)" onmouseover="showTip(event, 'fs48', 867)" class="t">Matrix</span><span class="o">&lt;</span><span onmouseout="hideTip(event, 'fs20', 868)" onmouseover="showTip(event, 'fs20', 868)" class="t">float</span><span class="o">&gt;</span>) <span onmouseout="hideTip(event, 'fs260', 869)" onmouseover="showTip(event, 'fs260', 869)" class="i">eigenValues</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs263', 870)" onmouseover="showTip(event, 'fs263', 870)" class="i">eigenVectors</span> <span class="o">*</span> <span onmouseout="hideTip(event, 'fs111', 871)" onmouseover="showTip(event, 'fs111', 871)" class="t">DenseMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs270', 872)" onmouseover="showTip(event, 'fs270', 872)" class="f">ofDiag</span>(<span onmouseout="hideTip(event, 'fs260', 873)" onmouseover="showTip(event, 'fs260', 873)" class="i">eigenValues</span>) <span class="o">*</span> <span onmouseout="hideTip(event, 'fs263', 874)" onmouseover="showTip(event, 'fs263', 874)" class="i">eigenVectors</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs271', 875)" onmouseover="showTip(event, 'fs271', 875)" class="f">Inverse</span>()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs272', 876)" onmouseover="showTip(event, 'fs272', 876)" class="i">reconstructedTestMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs269', 877)" onmouseover="showTip(event, 'fs269', 877)" class="f">reconstructMatrixFromEigenDecomposition</span> <span onmouseout="hideTip(event, 'fs267', 878)" onmouseover="showTip(event, 'fs267', 878)" class="i">testEigenVectors</span> <span onmouseout="hideTip(event, 'fs266', 879)" onmouseover="showTip(event, 'fs266', 879)" class="i">testEigenValues</span>
</code></pre></td>
</tr>
</table>
<p>For the final output matrix (after E_EUR adjustment), we need to ensure that the matrix is PSD.</p>
<p>Can we call into our own "PSDCorrelationMatrix" function to make this so? We have a tool that will do this for an ESG matrix -
can we call this, or call into the inner functionality of this to return a PSD version of the matrix?</p>
<p>Given below is the PSD adjustment, as specifed in the excel version of RWTS that I found.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
<span class="l">38: </span>
<span class="l">39: </span>
<span class="l">40: </span>
<span class="l">41: </span>
<span class="l">42: </span>
<span class="l">43: </span>
<span class="l">44: </span>
<span class="l">45: </span>
<span class="l">46: </span>
<span class="l">47: </span>
<span class="l">48: </span>
<span class="l">49: </span>
<span class="l">50: </span>
<span class="l">51: </span>
<span class="l">52: </span>
<span class="l">53: </span>
<span class="l">54: </span>
<span class="l">55: </span>
<span class="l">56: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs46', 880)" onmouseover="showTip(event, 'fs46', 880)" class="f">isPSD</span> <span onmouseout="hideTip(event, 'fs137', 881)" onmouseover="showTip(event, 'fs137', 881)" class="i">fullUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 882)" onmouseover="showTip(event, 'fs97', 882)" class="i">matrix</span>
<span onmouseout="hideTip(event, 'fs137', 883)" onmouseover="showTip(event, 'fs137', 883)" class="i">fullUncMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs97', 884)" onmouseover="showTip(event, 'fs97', 884)" class="i">matrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs49', 885)" onmouseover="showTip(event, 'fs49', 885)" class="f">Evd</span>()<span class="o">.</span><span class="i">EigenValues</span><span class="o">.</span><span class="f">Real</span>() <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 886)" onmouseover="showTip(event, 'fs50', 886)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs136', 887)" onmouseover="showTip(event, 'fs136', 887)" class="f">toList</span>
<span class="c">// if the matrix is not PSD, we can make it so by</span>

<span class="c">// set the newEigenValue array</span>

<span class="c">// Find the smallest positive eigenValue</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs273', 888)" onmouseover="showTip(event, 'fs273', 888)" class="f">nThSmallestPosEigenValue</span> <span onmouseout="hideTip(event, 'fs260', 889)" onmouseover="showTip(event, 'fs260', 889)" class="i">eigenValues</span> <span onmouseout="hideTip(event, 'fs274', 890)" onmouseover="showTip(event, 'fs274', 890)" class="i">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs260', 891)" onmouseover="showTip(event, 'fs260', 891)" class="i">eigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 892)" onmouseover="showTip(event, 'fs145', 892)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs275', 893)" onmouseover="showTip(event, 'fs275', 893)" class="f">toList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 894)" onmouseover="showTip(event, 'fs50', 894)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs276', 895)" onmouseover="showTip(event, 'fs276', 895)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs277', 896)" onmouseover="showTip(event, 'fs277', 896)" class="i">ev</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs277', 897)" onmouseover="showTip(event, 'fs277', 897)" class="i">ev</span> <span class="o">&gt;</span> <span class="n">0.000001</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 898)" onmouseover="showTip(event, 'fs50', 898)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs278', 899)" onmouseover="showTip(event, 'fs278', 899)" class="f">sort</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 900)" onmouseover="showTip(event, 'fs50', 900)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs279', 901)" onmouseover="showTip(event, 'fs279', 901)" class="f">item</span> (<span onmouseout="hideTip(event, 'fs274', 902)" onmouseover="showTip(event, 'fs274', 902)" class="i">n</span> <span class="o">-</span> <span class="n">1</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs280', 903)" onmouseover="showTip(event, 'fs280', 903)" class="f">replaceNegativeEigenValues</span> <span onmouseout="hideTip(event, 'fs260', 904)" onmouseover="showTip(event, 'fs260', 904)" class="i">eigenValues</span> <span onmouseout="hideTip(event, 'fs281', 905)" onmouseover="showTip(event, 'fs281', 905)" class="i">replacement</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs260', 906)" onmouseover="showTip(event, 'fs260', 906)" class="i">eigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 907)" onmouseover="showTip(event, 'fs145', 907)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 908)" onmouseover="showTip(event, 'fs153', 908)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs277', 909)" onmouseover="showTip(event, 'fs277', 909)" class="i">ev</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs277', 910)" onmouseover="showTip(event, 'fs277', 910)" class="i">ev</span> <span class="o">&lt;=</span> <span class="n">0.000001</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs281', 911)" onmouseover="showTip(event, 'fs281', 911)" class="i">replacement</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs277', 912)" onmouseover="showTip(event, 'fs277', 912)" class="i">ev</span> )

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs282', 913)" onmouseover="showTip(event, 'fs282', 913)" class="i">latestSmallestPositiveEigenValue</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs273', 914)" onmouseover="showTip(event, 'fs273', 914)" class="f">nThSmallestPosEigenValue</span> <span onmouseout="hideTip(event, 'fs266', 915)" onmouseover="showTip(event, 'fs266', 915)" class="i">testEigenValues</span> <span class="n">1</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs283', 916)" onmouseover="showTip(event, 'fs283', 916)" class="i">newPossibleEigenValues</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs280', 917)" onmouseover="showTip(event, 'fs280', 917)" class="f">replaceNegativeEigenValues</span> <span onmouseout="hideTip(event, 'fs266', 918)" onmouseover="showTip(event, 'fs266', 918)" class="i">testEigenValues</span> <span onmouseout="hideTip(event, 'fs282', 919)" onmouseover="showTip(event, 'fs282', 919)" class="i">latestSmallestPositiveEigenValue</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs284', 920)" onmouseover="showTip(event, 'fs284', 920)" class="i">newPossibleCorrelMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs269', 921)" onmouseover="showTip(event, 'fs269', 921)" class="f">reconstructMatrixFromEigenDecomposition</span> <span onmouseout="hideTip(event, 'fs267', 922)" onmouseover="showTip(event, 'fs267', 922)" class="i">testEigenVectors</span> <span onmouseout="hideTip(event, 'fs283', 923)" onmouseover="showTip(event, 'fs283', 923)" class="i">newPossibleEigenValues</span>

<span class="c">// We need to set the diagonal back to one</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs285', 924)" onmouseover="showTip(event, 'fs285', 924)" class="i">newDiagonalOfOnes</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs266', 925)" onmouseover="showTip(event, 'fs266', 925)" class="i">testEigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 926)" onmouseover="showTip(event, 'fs145', 926)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 927)" onmouseover="showTip(event, 'fs153', 927)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs286', 928)" onmouseover="showTip(event, 'fs286', 928)" class="i">e</span> <span class="k">-&gt;</span> <span class="n">1.0</span>)

<span onmouseout="hideTip(event, 'fs284', 929)" onmouseover="showTip(event, 'fs284', 929)" class="i">newPossibleCorrelMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs287', 930)" onmouseover="showTip(event, 'fs287', 930)" class="f">SetDiagonal</span>(<span onmouseout="hideTip(event, 'fs285', 931)" onmouseover="showTip(event, 'fs285', 931)" class="i">newDiagonalOfOnes</span>)

<span class="c">// We can now check if the adjusted matrix is PSD</span>
<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs288', 932)" onmouseover="showTip(event, 'fs288', 932)" class="i">newEigenValues</span>,<span onmouseout="hideTip(event, 'fs289', 933)" onmouseover="showTip(event, 'fs289', 933)" class="i">newEigenVectors</span>, <span onmouseout="hideTip(event, 'fs290', 934)" onmouseover="showTip(event, 'fs290', 934)" class="i">newIsPSD</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs257', 935)" onmouseover="showTip(event, 'fs257', 935)" class="f">decomposeMatrix</span> <span onmouseout="hideTip(event, 'fs284', 936)" onmouseover="showTip(event, 'fs284', 936)" class="i">newPossibleCorrelMatrix</span>

<span class="c">// if not PSD, then we need to recursively set to the next smallest EigenValue...</span>

<span class="c">// a function to do this can be defined like so...</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs291', 937)" onmouseover="showTip(event, 'fs291', 937)" class="f">ensureMatrixIsPSD</span> <span onmouseout="hideTip(event, 'fs47', 938)" onmouseover="showTip(event, 'fs47', 938)" class="i">matrix</span> <span class="o">=</span> 

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs292', 939)" onmouseover="showTip(event, 'fs292', 939)" class="f">nThSmallestPosEigenValue</span> <span onmouseout="hideTip(event, 'fs260', 940)" onmouseover="showTip(event, 'fs260', 940)" class="i">eigenValues</span> <span onmouseout="hideTip(event, 'fs274', 941)" onmouseover="showTip(event, 'fs274', 941)" class="i">n</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs260', 942)" onmouseover="showTip(event, 'fs260', 942)" class="i">eigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 943)" onmouseover="showTip(event, 'fs145', 943)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs275', 944)" onmouseover="showTip(event, 'fs275', 944)" class="f">toList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 945)" onmouseover="showTip(event, 'fs50', 945)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs276', 946)" onmouseover="showTip(event, 'fs276', 946)" class="f">filter</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs277', 947)" onmouseover="showTip(event, 'fs277', 947)" class="i">ev</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs277', 948)" onmouseover="showTip(event, 'fs277', 948)" class="i">ev</span> <span class="o">&gt;</span> <span class="n">0.000001</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 949)" onmouseover="showTip(event, 'fs50', 949)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs278', 950)" onmouseover="showTip(event, 'fs278', 950)" class="f">sort</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs50', 951)" onmouseover="showTip(event, 'fs50', 951)" class="t">Seq</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs279', 952)" onmouseover="showTip(event, 'fs279', 952)" class="f">item</span> (<span onmouseout="hideTip(event, 'fs274', 953)" onmouseover="showTip(event, 'fs274', 953)" class="i">n</span> <span class="o">-</span> <span class="n">1</span>)
    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs293', 954)" onmouseover="showTip(event, 'fs293', 954)" class="f">replaceNegativeEigenValues</span> <span onmouseout="hideTip(event, 'fs260', 955)" onmouseover="showTip(event, 'fs260', 955)" class="i">eigenValues</span> <span onmouseout="hideTip(event, 'fs281', 956)" onmouseover="showTip(event, 'fs281', 956)" class="i">replacement</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs260', 957)" onmouseover="showTip(event, 'fs260', 957)" class="i">eigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 958)" onmouseover="showTip(event, 'fs145', 958)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 959)" onmouseover="showTip(event, 'fs153', 959)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs277', 960)" onmouseover="showTip(event, 'fs277', 960)" class="i">ev</span> <span class="k">-&gt;</span> <span class="k">if</span> <span onmouseout="hideTip(event, 'fs277', 961)" onmouseover="showTip(event, 'fs277', 961)" class="i">ev</span> <span class="o">&lt;=</span> <span class="n">0.000001</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs281', 962)" onmouseover="showTip(event, 'fs281', 962)" class="i">replacement</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs277', 963)" onmouseover="showTip(event, 'fs277', 963)" class="i">ev</span> )    

    <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs294', 964)" onmouseover="showTip(event, 'fs294', 964)" class="i">originalEigenValues</span>,<span onmouseout="hideTip(event, 'fs295', 965)" onmouseover="showTip(event, 'fs295', 965)" class="i">originalEigenVectors</span>, <span onmouseout="hideTip(event, 'fs296', 966)" onmouseover="showTip(event, 'fs296', 966)" class="i">originalIsPSD</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs257', 967)" onmouseover="showTip(event, 'fs257', 967)" class="f">decomposeMatrix</span> <span onmouseout="hideTip(event, 'fs47', 968)" onmouseover="showTip(event, 'fs47', 968)" class="i">matrix</span>

    <span class="k">match</span> <span onmouseout="hideTip(event, 'fs296', 969)" onmouseover="showTip(event, 'fs296', 969)" class="i">originalIsPSD</span> <span class="k">with</span>
    | <span class="k">true</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs47', 970)" onmouseover="showTip(event, 'fs47', 970)" class="i">matrix</span>
    | _ <span class="k">-&gt;</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs297', 971)" onmouseover="showTip(event, 'fs297', 971)" class="i">startN</span> <span class="o">=</span> <span class="n">1</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs298', 972)" onmouseover="showTip(event, 'fs298', 972)" class="i">maxN</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs294', 973)" onmouseover="showTip(event, 'fs294', 973)" class="i">originalEigenValues</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs299', 974)" onmouseover="showTip(event, 'fs299', 974)" class="i">Count</span>
        <span class="k">let</span> <span onmouseout="hideTip(event, 'fs300', 975)" onmouseover="showTip(event, 'fs300', 975)" class="i">newDiagonalOfOnes</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs294', 976)" onmouseover="showTip(event, 'fs294', 976)" class="i">originalEigenValues</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs145', 977)" onmouseover="showTip(event, 'fs145', 977)" class="t">Vector</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs153', 978)" onmouseover="showTip(event, 'fs153', 978)" class="f">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs286', 979)" onmouseover="showTip(event, 'fs286', 979)" class="i">e</span> <span class="k">-&gt;</span> <span class="n">1.0</span>)
        <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs301', 980)" onmouseover="showTip(event, 'fs301', 980)" class="f">setEVUntilPSD</span> <span onmouseout="hideTip(event, 'fs302', 981)" onmouseover="showTip(event, 'fs302', 981)" class="i">thisN</span> <span class="o">=</span> 
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs303', 982)" onmouseover="showTip(event, 'fs303', 982)" class="i">latestSmallestPositiveEigenValue</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs292', 983)" onmouseover="showTip(event, 'fs292', 983)" class="f">nThSmallestPosEigenValue</span> <span onmouseout="hideTip(event, 'fs294', 984)" onmouseover="showTip(event, 'fs294', 984)" class="i">originalEigenValues</span> <span onmouseout="hideTip(event, 'fs302', 985)" onmouseover="showTip(event, 'fs302', 985)" class="i">thisN</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs304', 986)" onmouseover="showTip(event, 'fs304', 986)" class="i">newPossibleEigenValues</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs293', 987)" onmouseover="showTip(event, 'fs293', 987)" class="f">replaceNegativeEigenValues</span> <span onmouseout="hideTip(event, 'fs294', 988)" onmouseover="showTip(event, 'fs294', 988)" class="i">originalEigenValues</span> <span onmouseout="hideTip(event, 'fs303', 989)" onmouseover="showTip(event, 'fs303', 989)" class="i">latestSmallestPositiveEigenValue</span>
            <span class="k">let</span> <span onmouseout="hideTip(event, 'fs305', 990)" onmouseover="showTip(event, 'fs305', 990)" class="i">newPossibleCorrelMatrix</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs269', 991)" onmouseover="showTip(event, 'fs269', 991)" class="f">reconstructMatrixFromEigenDecomposition</span> <span onmouseout="hideTip(event, 'fs295', 992)" onmouseover="showTip(event, 'fs295', 992)" class="i">originalEigenVectors</span> <span onmouseout="hideTip(event, 'fs304', 993)" onmouseover="showTip(event, 'fs304', 993)" class="i">newPossibleEigenValues</span>
            <span onmouseout="hideTip(event, 'fs305', 994)" onmouseover="showTip(event, 'fs305', 994)" class="i">newPossibleCorrelMatrix</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs287', 995)" onmouseover="showTip(event, 'fs287', 995)" class="f">SetDiagonal</span>(<span onmouseout="hideTip(event, 'fs300', 996)" onmouseover="showTip(event, 'fs300', 996)" class="i">newDiagonalOfOnes</span>)
            <span class="k">let</span> (<span onmouseout="hideTip(event, 'fs306', 997)" onmouseover="showTip(event, 'fs306', 997)" class="i">newEigenValues</span>,<span onmouseout="hideTip(event, 'fs307', 998)" onmouseover="showTip(event, 'fs307', 998)" class="i">newEigenVectors</span>, <span onmouseout="hideTip(event, 'fs308', 999)" onmouseover="showTip(event, 'fs308', 999)" class="i">newIsPSD</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs257', 1000)" onmouseover="showTip(event, 'fs257', 1000)" class="f">decomposeMatrix</span> <span onmouseout="hideTip(event, 'fs305', 1001)" onmouseover="showTip(event, 'fs305', 1001)" class="i">newPossibleCorrelMatrix</span>
            <span class="k">if</span> <span onmouseout="hideTip(event, 'fs308', 1002)" onmouseover="showTip(event, 'fs308', 1002)" class="i">newIsPSD</span> <span class="o">||</span> <span onmouseout="hideTip(event, 'fs302', 1003)" onmouseover="showTip(event, 'fs302', 1003)" class="i">thisN</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs298', 1004)" onmouseover="showTip(event, 'fs298', 1004)" class="i">maxN</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs305', 1005)" onmouseover="showTip(event, 'fs305', 1005)" class="i">newPossibleCorrelMatrix</span> <span class="k">else</span> <span onmouseout="hideTip(event, 'fs301', 1006)" onmouseover="showTip(event, 'fs301', 1006)" class="f">setEVUntilPSD</span> (<span onmouseout="hideTip(event, 'fs302', 1007)" onmouseover="showTip(event, 'fs302', 1007)" class="i">thisN</span> <span class="o">+</span> <span class="n">1</span>)
        <span onmouseout="hideTip(event, 'fs301', 1008)" onmouseover="showTip(event, 'fs301', 1008)" class="f">setEVUntilPSD</span> <span class="n">1</span>  

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs309', 1009)" onmouseover="showTip(event, 'fs309', 1009)" class="i">aPSDMatrixThatsAlreadyPSD</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs291', 1010)" onmouseover="showTip(event, 'fs291', 1010)" class="f">ensureMatrixIsPSD</span> <span onmouseout="hideTip(event, 'fs284', 1011)" onmouseover="showTip(event, 'fs284', 1011)" class="i">newPossibleCorrelMatrix</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs310', 1012)" onmouseover="showTip(event, 'fs310', 1012)" class="i">aPSDMatrixThatsPSDAfterOneIteration</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs291', 1013)" onmouseover="showTip(event, 'fs291', 1013)" class="f">ensureMatrixIsPSD</span> <span onmouseout="hideTip(event, 'fs173', 1014)" onmouseover="showTip(event, 'fs173', 1014)" class="i">testFullCorr</span>

<span class="c">// The 2009 algoritm further reduces the minimum eigenvalue by a small amount until the result is back over the PSD threshold</span>
<span class="k">let</span> (<span onmouseout="hideTip(event, 'fs311', 1015)" onmouseover="showTip(event, 'fs311', 1015)" class="i">latestEigenValues</span>,<span onmouseout="hideTip(event, 'fs312', 1016)" onmouseover="showTip(event, 'fs312', 1016)" class="i">latestEigenVectors</span>, <span onmouseout="hideTip(event, 'fs313', 1017)" onmouseover="showTip(event, 'fs313', 1017)" class="i">latestIsPSD</span>) <span class="o">=</span> <span onmouseout="hideTip(event, 'fs257', 1018)" onmouseover="showTip(event, 'fs257', 1018)" class="f">decomposeMatrix</span> <span onmouseout="hideTip(event, 'fs284', 1019)" onmouseover="showTip(event, 'fs284', 1019)" class="i">newPossibleCorrelMatrix</span>

<span class="c">// I&#39;m going to stop there, as I&#39;m not convinced that this is the same algorithm we use in the DB RWTS any more (the diagonals are not = 1.0, so something is up...)</span>
</code></pre></td>
</tr>
</table>
<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace Deedle</div>
<div class="tip" id="fs3">namespace MathNet</div>
<div class="tip" id="fs4">namespace MathNet.Numerics</div>
<div class="tip" id="fs5">namespace MathNet.Numerics.Statistics</div>
<div class="tip" id="fs6">namespace MathNet.Numerics.LinearAlgebra</div>
<div class="tip" id="fs7">val root : string<br /><br />Full name: RWTSMultivariateCalculations.root</div>
<div class="tip" id="fs8">val ReturnSeries : allSeries:Frame&lt;DateTime,string&gt; -&gt; asset:string -&gt; Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ReturnSeries</div>
<div class="tip" id="fs9">val allSeries : Frame&lt;DateTime,string&gt;</div>
<div class="tip" id="fs10">Multiple items<br />module Frame<br /><br />from Deedle<br /><br />--------------------<br />type Frame =<br />&#160;&#160;static member ReadReader : reader:IDataReader -&gt; Frame&lt;int,string&gt;<br />&#160;&#160;static member CustomExpanders : Dictionary&lt;Type,Func&lt;obj,seq&lt;string * Type * obj&gt;&gt;&gt;<br />&#160;&#160;static member NonExpandableInterfaces : List&lt;Type&gt;<br />&#160;&#160;static member NonExpandableTypes : HashSet&lt;Type&gt;<br /><br />Full name: Deedle.Frame<br /><br />--------------------<br />type Frame&lt;&#39;TRowKey,&#39;TColumnKey (requires equality and equality)&gt; =<br />&#160;&#160;interface IDynamicMetaObjectProvider<br />&#160;&#160;interface INotifyCollectionChanged<br />&#160;&#160;interface IFsiFormattable<br />&#160;&#160;interface IFrame<br />&#160;&#160;new : names:seq&lt;&#39;TColumnKey&gt; * columns:seq&lt;ISeries&lt;&#39;TRowKey&gt;&gt; -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;<br />&#160;&#160;new : rowIndex:IIndex&lt;&#39;TRowKey&gt; * columnIndex:IIndex&lt;&#39;TColumnKey&gt; * data:IVector&lt;IVector&gt; * indexBuilder:IIndexBuilder * vectorBuilder:IVectorBuilder -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;<br />&#160;&#160;member AddColumn : column:&#39;TColumnKey * series:ISeries&lt;&#39;TRowKey&gt; -&gt; unit<br />&#160;&#160;member AddColumn : column:&#39;TColumnKey * series:seq&lt;&#39;V&gt; -&gt; unit<br />&#160;&#160;member AddColumn : column:&#39;TColumnKey * series:ISeries&lt;&#39;TRowKey&gt; * lookup:Lookup -&gt; unit<br />&#160;&#160;member AddColumn : column:&#39;TColumnKey * series:seq&lt;&#39;V&gt; * lookup:Lookup -&gt; unit<br />&#160;&#160;...<br /><br />Full name: Deedle.Frame&lt;_,_&gt;<br /><br />--------------------<br />new : names:seq&lt;&#39;TColumnKey&gt; * columns:seq&lt;ISeries&lt;&#39;TRowKey&gt;&gt; -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;<br />new : rowIndex:Indices.IIndex&lt;&#39;TRowKey&gt; * columnIndex:Indices.IIndex&lt;&#39;TColumnKey&gt; * data:IVector&lt;IVector&gt; * indexBuilder:Indices.IIndexBuilder * vectorBuilder:Vectors.IVectorBuilder -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;</div>
<div class="tip" id="fs11">Multiple items<br />type DateTime =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;new : ticks:int64 -&gt; DateTime + 10 overloads<br />&#160;&#160;&#160;&#160;member Add : value:TimeSpan -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddDays : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddHours : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMilliseconds : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMinutes : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMonths : months:int -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddSeconds : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddTicks : value:int64 -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddYears : value:int -&gt; DateTime<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.DateTime<br /><br />--------------------<br />DateTime()<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(ticks: int64) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(ticks: int64, kind: DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, calendar: Globalization.Calendar) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, kind: DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, calendar: Globalization.Calendar) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, kind: DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em></div>
<div class="tip" id="fs12">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs13">val asset : string</div>
<div class="tip" id="fs14">member Frame.GetColumn : column:&#39;TColumnKey -&gt; Series&lt;&#39;TRowKey,&#39;R&gt;<br />member Frame.GetColumn : column:&#39;TColumnKey * lookup:Lookup -&gt; Series&lt;&#39;TRowKey,&#39;R&gt;</div>
<div class="tip" id="fs15">Multiple items<br />module Series<br /><br />from Deedle<br /><br />--------------------<br />type Series =<br />&#160;&#160;static member ofNullables : values:seq&lt;Nullable&lt;&#39;a0&gt;&gt; -&gt; Series&lt;int,&#39;a0&gt; (requires default constructor and value type and &#39;a0 :&gt; ValueType)<br />&#160;&#160;static member ofObservations : observations:seq&lt;&#39;c * &#39;d&gt; -&gt; Series&lt;&#39;c,&#39;d&gt; (requires equality)<br />&#160;&#160;static member ofOptionalObservations : observations:seq&lt;&#39;K * &#39;a1 option&gt; -&gt; Series&lt;&#39;K,&#39;a1&gt; (requires equality)<br />&#160;&#160;static member ofValues : values:seq&lt;&#39;a&gt; -&gt; Series&lt;int,&#39;a&gt;<br /><br />Full name: Deedle.F# Series extensions.Series<br /><br />--------------------<br />type Series&lt;&#39;K,&#39;V (requires equality)&gt; =<br />&#160;&#160;interface IFsiFormattable<br />&#160;&#160;interface ISeries&lt;&#39;K&gt;<br />&#160;&#160;new : pairs:seq&lt;KeyValuePair&lt;&#39;K,&#39;V&gt;&gt; -&gt; Series&lt;&#39;K,&#39;V&gt;<br />&#160;&#160;new : keys:&#39;K [] * values:&#39;V [] -&gt; Series&lt;&#39;K,&#39;V&gt;<br />&#160;&#160;new : keys:seq&lt;&#39;K&gt; * values:seq&lt;&#39;V&gt; -&gt; Series&lt;&#39;K,&#39;V&gt;<br />&#160;&#160;new : index:IIndex&lt;&#39;K&gt; * vector:IVector&lt;&#39;V&gt; * vectorBuilder:IVectorBuilder * indexBuilder:IIndexBuilder -&gt; Series&lt;&#39;K,&#39;V&gt;<br />&#160;&#160;member After : lowerExclusive:&#39;K -&gt; Series&lt;&#39;K,&#39;V&gt;<br />&#160;&#160;member Aggregate : aggregation:Aggregation&lt;&#39;K&gt; * observationSelector:Func&lt;DataSegment&lt;Series&lt;&#39;K,&#39;V&gt;&gt;,KeyValuePair&lt;&#39;TNewKey,OptionalValue&lt;&#39;R&gt;&gt;&gt; -&gt; Series&lt;&#39;TNewKey,&#39;R&gt; (requires equality)<br />&#160;&#160;member Aggregate : aggregation:Aggregation&lt;&#39;K&gt; * keySelector:Func&lt;DataSegment&lt;Series&lt;&#39;K,&#39;V&gt;&gt;,&#39;TNewKey&gt; * valueSelector:Func&lt;DataSegment&lt;Series&lt;&#39;K,&#39;V&gt;&gt;,OptionalValue&lt;&#39;R&gt;&gt; -&gt; Series&lt;&#39;TNewKey,&#39;R&gt; (requires equality)<br />&#160;&#160;member AsyncMaterialize : unit -&gt; Async&lt;Series&lt;&#39;K,&#39;V&gt;&gt;<br />&#160;&#160;...<br /><br />Full name: Deedle.Series&lt;_,_&gt;<br /><br />--------------------<br />new : pairs:seq&lt;Collections.Generic.KeyValuePair&lt;&#39;K,&#39;V&gt;&gt; -&gt; Series&lt;&#39;K,&#39;V&gt;<br />new : keys:seq&lt;&#39;K&gt; * values:seq&lt;&#39;V&gt; -&gt; Series&lt;&#39;K,&#39;V&gt;<br />new : keys:&#39;K [] * values:&#39;V [] -&gt; Series&lt;&#39;K,&#39;V&gt;<br />new : index:Indices.IIndex&lt;&#39;K&gt; * vector:IVector&lt;&#39;V&gt; * vectorBuilder:Vectors.IVectorBuilder * indexBuilder:Indices.IIndexBuilder -&gt; Series&lt;&#39;K,&#39;V&gt;</div>
<div class="tip" id="fs16">val filter : f:(&#39;K -&gt; &#39;T -&gt; bool) -&gt; series:Series&lt;&#39;K,&#39;T&gt; -&gt; Series&lt;&#39;K,&#39;T&gt; (requires equality)<br /><br />Full name: Deedle.Series.filter</div>
<div class="tip" id="fs17">val k : DateTime</div>
<div class="tip" id="fs18">val v : string</div>
<div class="tip" id="fs19">val map : f:(&#39;K -&gt; &#39;T -&gt; &#39;R) -&gt; series:Series&lt;&#39;K,&#39;T&gt; -&gt; Series&lt;&#39;K,&#39;R&gt; (requires equality)<br /><br />Full name: Deedle.Series.map</div>
<div class="tip" id="fs20">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;</div>
<div class="tip" id="fs21">val XSReturnsfromCSV : Frame&lt;DateTime,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.XSReturnsfromCSV</div>
<div class="tip" id="fs22">static member Frame.ReadCsv : path:string * ?hasHeaders:bool * ?inferTypes:bool * ?inferRows:int * ?schema:string * ?separators:string * ?culture:string * ?maxRows:int * ?missingValues:string [] -&gt; Frame&lt;int,string&gt;<br />static member Frame.ReadCsv : stream:IO.Stream * ?hasHeaders:bool * ?inferTypes:bool * ?inferRows:int * ?schema:string * ?separators:string * ?culture:string * ?maxRows:int * ?missingValues:string [] -&gt; Frame&lt;int,string&gt;<br />static member Frame.ReadCsv : reader:IO.TextReader * ?hasHeaders:bool * ?inferTypes:bool * ?inferRows:int * ?schema:string * ?separators:string * ?culture:string * ?maxRows:int * ?missingValues:string [] -&gt; Frame&lt;int,string&gt;<br />static member Frame.ReadCsv : path:string * indexCol:string * ?hasHeaders:bool * ?inferTypes:bool * ?inferRows:int * ?schema:string * ?separators:string * ?culture:string * ?maxRows:int * ?missingValues:string [] -&gt; Frame&lt;&#39;R,string&gt; (requires equality)</div>
<div class="tip" id="fs23">val sortRowsByKey : frame:Frame&lt;&#39;R,&#39;C&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)<br /><br />Full name: Deedle.Frame.sortRowsByKey</div>
<div class="tip" id="fs24">val returnXSReturnSeries : (string -&gt; Series&lt;DateTime,float&gt;)<br /><br />Full name: RWTSMultivariateCalculations.returnXSReturnSeries</div>
<div class="tip" id="fs25">val testXSRetSeries : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testXSRetSeries</div>
<div class="tip" id="fs26">val exampleReturnDataFrame : Frame&lt;DateTime,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.exampleReturnDataFrame</div>
<div class="tip" id="fs27">static member Frame.ofColumns : cols:Series&lt;&#39;C,#ISeries&lt;&#39;R&gt;&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)<br />static member Frame.ofColumns : cols:seq&lt;&#39;C * #ISeries&lt;&#39;R&gt;&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)</div>
<div class="tip" id="fs28">val calibrationDate : DateTime<br /><br />Full name: RWTSMultivariateCalculations.calibrationDate</div>
<div class="tip" id="fs29">val tenYearsAgo : DateTime<br /><br />Full name: RWTSMultivariateCalculations.tenYearsAgo</div>
<div class="tip" id="fs30">DateTime.AddYears(value: int) : DateTime</div>
<div class="tip" id="fs31">member Series.Between : lowerInclusive:&#39;K * upperInclusive:&#39;K -&gt; Series&lt;&#39;K,&#39;V&gt;</div>
<div class="tip" id="fs32">val exampleHist10YReturns : Frame&lt;DateTime,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.exampleHist10YReturns</div>
<div class="tip" id="fs33">val filterRows : f:(&#39;R -&gt; ObjectSeries&lt;&#39;C&gt; -&gt; bool) -&gt; frame:Frame&lt;&#39;R,&#39;C&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)<br /><br />Full name: Deedle.Frame.filterRows</div>
<div class="tip" id="fs34">val v : ObjectSeries&lt;string&gt;</div>
<div class="tip" id="fs35">val myX : seq&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.myX</div>
<div class="tip" id="fs36">val myY : seq&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.myY</div>
<div class="tip" id="fs37">val myZ : seq&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.myZ</div>
<div class="tip" id="fs38">val myCorrelXY : float<br /><br />Full name: RWTSMultivariateCalculations.myCorrelXY</div>
<div class="tip" id="fs39">type Statistics =<br />&#160;&#160;static member Covariance : samples1:IEnumerable&lt;float&gt; * samples2:IEnumerable&lt;float&gt; -&gt; float + 2 overloads<br />&#160;&#160;static member EmpiricalCDF : data:IEnumerable&lt;float&gt; * x:float -&gt; float + 2 overloads<br />&#160;&#160;static member EmpiricalCDFFunc : data:IEnumerable&lt;float&gt; -&gt; Func&lt;float, float&gt; + 2 overloads<br />&#160;&#160;static member EmpiricalInvCDF : data:IEnumerable&lt;float&gt; * tau:float -&gt; float + 2 overloads<br />&#160;&#160;static member EmpiricalInvCDFFunc : data:IEnumerable&lt;float&gt; -&gt; Func&lt;float, float&gt; + 2 overloads<br />&#160;&#160;static member Entropy : data:IEnumerable&lt;float&gt; -&gt; float + 1 overload<br />&#160;&#160;static member FiveNumberSummary : data:IEnumerable&lt;float&gt; -&gt; float[] + 2 overloads<br />&#160;&#160;static member GeometricMean : data:IEnumerable&lt;float&gt; -&gt; float + 1 overload<br />&#160;&#160;static member HarmonicMean : data:IEnumerable&lt;float&gt; -&gt; float + 1 overload<br />&#160;&#160;static member InterquartileRange : data:IEnumerable&lt;float&gt; -&gt; float + 2 overloads<br />&#160;&#160;...<br /><br />Full name: MathNet.Numerics.Statistics.Statistics</div>
<div class="tip" id="fs40">type Correlation =<br />&#160;&#160;static member Pearson : dataA:IEnumerable&lt;float&gt; * dataB:IEnumerable&lt;float&gt; -&gt; float<br />&#160;&#160;static member PearsonMatrix : [&lt;ParamArray&gt;] vectors:float[][] -&gt; Matrix&lt;float&gt; + 1 overload<br />&#160;&#160;static member Spearman : dataA:IEnumerable&lt;float&gt; * dataB:IEnumerable&lt;float&gt; -&gt; float<br />&#160;&#160;static member SpearmanMatrix : [&lt;ParamArray&gt;] vectors:float[][] -&gt; Matrix&lt;float&gt; + 1 overload<br />&#160;&#160;static member WeightedPearson : dataA:IEnumerable&lt;float&gt; * dataB:IEnumerable&lt;float&gt; * weights:IEnumerable&lt;float&gt; -&gt; float<br /><br />Full name: MathNet.Numerics.Statistics.Correlation</div>
<div class="tip" id="fs41">Correlation.Pearson(dataA: Collections.Generic.IEnumerable&lt;float&gt;, dataB: Collections.Generic.IEnumerable&lt;float&gt;) : float</div>
<div class="tip" id="fs42">val myCorrelXZ : float<br /><br />Full name: RWTSMultivariateCalculations.myCorrelXZ</div>
<div class="tip" id="fs43">val myCorrelYZ : float<br /><br />Full name: RWTSMultivariateCalculations.myCorrelYZ</div>
<div class="tip" id="fs44">val correlMatrix : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.correlMatrix</div>
<div class="tip" id="fs45">val matrix : lst:&#39;T list list -&gt; Matrix&lt;&#39;T&gt; (requires default constructor and value type and &#39;T :&gt; IEquatable&lt;&#39;T&gt; and &#39;T :&gt; IFormattable and &#39;T :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.MatrixExtensions.matrix</div>
<div class="tip" id="fs46">val isPSD : matrix:Matrix&lt;float&gt; -&gt; bool<br /><br />Full name: RWTSMultivariateCalculations.isPSD</div>
<div class="tip" id="fs47">val matrix : Matrix&lt;float&gt;</div>
<div class="tip" id="fs48">type Matrix&lt;&#39;T (requires default constructor and value type and &#39;T :&gt; IEquatable&lt;&#39;T&gt; and &#39;T :&gt; IFormattable and &#39;T :&gt; ValueType)&gt; =<br />&#160;&#160;member Add : scalar:&#39;T -&gt; Matrix&lt;&#39;T&gt; + 3 overloads<br />&#160;&#160;member Append : right:Matrix&lt;&#39;T&gt; -&gt; Matrix&lt;&#39;T&gt; + 1 overload<br />&#160;&#160;member At : row:int * column:int -&gt; &#39;T + 1 overload<br />&#160;&#160;member Cholesky : unit -&gt; Cholesky&lt;&#39;T&gt;<br />&#160;&#160;member Clear : unit -&gt; unit<br />&#160;&#160;member ClearColumn : columnIndex:int -&gt; unit<br />&#160;&#160;member ClearColumns : [&lt;ParamArray&gt;] columnIndices:int[] -&gt; unit<br />&#160;&#160;member ClearRow : rowIndex:int -&gt; unit<br />&#160;&#160;member ClearRows : [&lt;ParamArray&gt;] rowIndices:int[] -&gt; unit<br />&#160;&#160;member ClearSubMatrix : rowIndex:int * rowCount:int * columnIndex:int * columnCount:int -&gt; unit<br />&#160;&#160;...<br /><br />Full name: MathNet.Numerics.LinearAlgebra.Matrix&lt;_&gt;</div>
<div class="tip" id="fs49">Matrix.Evd(?symmetricity: Symmetricity) : Factorization.Evd&lt;float&gt;</div>
<div class="tip" id="fs50">module Seq<br /><br />from Microsoft.FSharp.Collections</div>
<div class="tip" id="fs51">val min : source:seq&lt;&#39;T&gt; -&gt; &#39;T (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.min</div>
<div class="tip" id="fs52">val oldCalibrationDate : DateTime<br /><br />Full name: RWTSMultivariateCalculations.oldCalibrationDate</div>
<div class="tip" id="fs53">val seriesLH : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.seriesLH</div>
<div class="tip" id="fs54">val seriesRH : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.seriesRH</div>
<div class="tip" id="fs55">val seriesMeanLHS : float<br /><br />Full name: RWTSMultivariateCalculations.seriesMeanLHS</div>
<div class="tip" id="fs56">static member SeriesStatsExtensions.Mean : series:Series&lt;&#39;K,float&gt; -&gt; float (requires equality)</div>
<div class="tip" id="fs57">val seriesMeanRHS : float<br /><br />Full name: RWTSMultivariateCalculations.seriesMeanRHS</div>
<div class="tip" id="fs58">val combinedStartDate : DateTime<br /><br />Full name: RWTSMultivariateCalculations.combinedStartDate</div>
<div class="tip" id="fs59">static member SeriesExtensions.FirstKey : series:Series&lt;&#39;K,&#39;V&gt; -&gt; &#39;K (requires equality)</div>
<div class="tip" id="fs60">val ewmaReturnsLH : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaReturnsLH</div>
<div class="tip" id="fs61">member Series.StartAt : lowerInclusive:&#39;K -&gt; Series&lt;&#39;K,&#39;V&gt;</div>
<div class="tip" id="fs62">val ewmaReturnsRH : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaReturnsRH</div>
<div class="tip" id="fs63">val uncCorrelLambda : float<br /><br />Full name: RWTSMultivariateCalculations.uncCorrelLambda</div>
<div class="tip" id="fs64">val uncVarInit : float<br /><br />Full name: RWTSMultivariateCalculations.uncVarInit</div>
<div class="tip" id="fs65">val uncCovarInit : float<br /><br />Full name: RWTSMultivariateCalculations.uncCovarInit</div>
<div class="tip" id="fs66">val seriesLHMinusMu : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.seriesLHMinusMu</div>
<div class="tip" id="fs67">val seriesRHMinusMu : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.seriesRHMinusMu</div>
<div class="tip" id="fs68">val ewmaCovar : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaCovar</div>
<div class="tip" id="fs69">val ewmaWeightedCovar : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaWeightedCovar</div>
<div class="tip" id="fs70">val scanValues : foldFunc:(&#39;R -&gt; &#39;T -&gt; &#39;R) -&gt; init:&#39;R -&gt; series:Series&lt;&#39;K,&#39;T&gt; -&gt; Series&lt;&#39;K,&#39;R&gt; (requires equality)<br /><br />Full name: Deedle.Series.scanValues</div>
<div class="tip" id="fs71">val lastweightedCovar : float</div>
<div class="tip" id="fs72">val thisCovar : float</div>
<div class="tip" id="fs73">val ewmaVarLH : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaVarLH</div>
<div class="tip" id="fs74">val lastweightedVar : float</div>
<div class="tip" id="fs75">val thisVar : float</div>
<div class="tip" id="fs76">val ewmaVarRH : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaVarRH</div>
<div class="tip" id="fs77">val ewmaCorrel : Series&lt;DateTime,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ewmaCorrel</div>
<div class="tip" id="fs78">val finalUnconditionalCorrelation : float<br /><br />Full name: RWTSMultivariateCalculations.finalUnconditionalCorrelation</div>
<div class="tip" id="fs79">member Series.Get : key:&#39;K -&gt; &#39;V<br />member Series.Get : key:&#39;K * lookup:Lookup -&gt; &#39;V</div>
<div class="tip" id="fs80">val get10YCorrelFromPair : calibrationDate:DateTime -&gt; assetLH:string -&gt; assetRH:string -&gt; float<br /><br />Full name: RWTSMultivariateCalculations.get10YCorrelFromPair</div>
<div class="tip" id="fs81">val calibrationDate : DateTime</div>
<div class="tip" id="fs82">val assetLH : string</div>
<div class="tip" id="fs83">val assetRH : string</div>
<div class="tip" id="fs84">val seriesLH : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs85">val seriesRH : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs86">val combinedStartDate : DateTime</div>
<div class="tip" id="fs87">val exampleReturnDataFrame : Frame&lt;DateTime,string&gt;</div>
<div class="tip" id="fs88">val tenYearsAgo : DateTime</div>
<div class="tip" id="fs89">val exampleHist10YReturns : Frame&lt;DateTime,string&gt;</div>
<div class="tip" id="fs90">val myX : seq&lt;float&gt;</div>
<div class="tip" id="fs91">val myY : seq&lt;float&gt;</div>
<div class="tip" id="fs92">val myCorrelXY : float</div>
<div class="tip" id="fs93">val assetList : string list<br /><br />Full name: RWTSMultivariateCalculations.assetList</div>
<div class="tip" id="fs94">type MatrixDescription =<br />&#160;&#160;{assets: List&lt;string&gt;;<br />&#160;&#160;&#160;matrix: Matrix&lt;float&gt;;}<br /><br />Full name: RWTSMultivariateCalculations.MatrixDescription</div>
<div class="tip" id="fs95">MatrixDescription.assets: List&lt;string&gt;</div>
<div class="tip" id="fs96">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member GetSlice : startIndex:int option * endIndex:int option -&gt; &#39;T list<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs97">MatrixDescription.matrix: Matrix&lt;float&gt;</div>
<div class="tip" id="fs98">val getCorrelMatrix : calibrationDate:&#39;a -&gt; funCorrelMethod:(&#39;a -&gt; string -&gt; string -&gt; float) -&gt; assetList:string list -&gt; MatrixDescription<br /><br />Full name: RWTSMultivariateCalculations.getCorrelMatrix</div>
<div class="tip" id="fs99">val calibrationDate : &#39;a</div>
<div class="tip" id="fs100">val funCorrelMethod : (&#39;a -&gt; string -&gt; string -&gt; float)</div>
<div class="tip" id="fs101">val assetList : string list</div>
<div class="tip" id="fs102">val getThis10YCorrelFromPair : (string -&gt; string -&gt; float)</div>
<div class="tip" id="fs103">val indexedAssetList : (int * string) list</div>
<div class="tip" id="fs104">val zip : list1:&#39;T1 list -&gt; list2:&#39;T2 list -&gt; (&#39;T1 * &#39;T2) list<br /><br />Full name: Microsoft.FSharp.Collections.List.zip</div>
<div class="tip" id="fs105">property List.Length: int</div>
<div class="tip" id="fs106">val flatMatrix : seq&lt;int * int * float&gt;</div>
<div class="tip" id="fs107">Multiple items<br />val seq : sequence:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Core.Operators.seq<br /><br />--------------------<br />type seq&lt;&#39;T&gt; = Collections.Generic.IEnumerable&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.seq&lt;_&gt;</div>
<div class="tip" id="fs108">val keyLH : int</div>
<div class="tip" id="fs109">val keyRH : int</div>
<div class="tip" id="fs110">val denseMatrix : Matrix&lt;float&gt;</div>
<div class="tip" id="fs111">module DenseMatrix<br /><br />from MathNet.Numerics.LinearAlgebra</div>
<div class="tip" id="fs112">val ofSeqi : rows:int -&gt; cols:int -&gt; indexed:#seq&lt;int * int * &#39;T&gt; -&gt; Matrix&lt;&#39;T&gt; (requires default constructor and value type and &#39;T :&gt; IEquatable&lt;&#39;T&gt; and &#39;T :&gt; IFormattable and &#39;T :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.DenseMatrix.ofSeqi</div>
<div class="tip" id="fs113">val result : MatrixDescription</div>
<div class="tip" id="fs114">val test10YMatrix : MatrixDescription<br /><br />Full name: RWTSMultivariateCalculations.test10YMatrix</div>
<div class="tip" id="fs115">val getUncCorrelFromPair : lambda:float -&gt; uncVarInit:float -&gt; covarScale:float -&gt; calibrationDate:DateTime -&gt; assetLH:string -&gt; assetRH:string -&gt; float<br /><br />Full name: RWTSMultivariateCalculations.getUncCorrelFromPair</div>
<div class="tip" id="fs116">val lambda : float</div>
<div class="tip" id="fs117">val uncVarInit : float</div>
<div class="tip" id="fs118">val covarScale : float</div>
<div class="tip" id="fs119">val seriesMeanLHS : float</div>
<div class="tip" id="fs120">val seriesMeanRHS : float</div>
<div class="tip" id="fs121">val ewmaReturnsLH : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs122">val ewmaReturnsRH : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs123">val seriesLHMinusMu : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs124">val seriesRHMinusMu : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs125">val ewmaCovar : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs126">val uncCovarInit : float</div>
<div class="tip" id="fs127">val ewmaWeightedCovar : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs128">val ewmaVarLH : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs129">val ewmaVarRH : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs130">val ewmaCorrel : Series&lt;DateTime,float&gt;</div>
<div class="tip" id="fs131">val defaultGetUncCorrelFromPair : (DateTime -&gt; string -&gt; string -&gt; float)<br /><br />Full name: RWTSMultivariateCalculations.defaultGetUncCorrelFromPair</div>
<div class="tip" id="fs132">val testUncMatrix : MatrixDescription<br /><br />Full name: RWTSMultivariateCalculations.testUncMatrix</div>
<div class="tip" id="fs133">val fullAssetInfo : Frame&lt;string,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.fullAssetInfo</div>
<div class="tip" id="fs134">val full10YMatrix : MatrixDescription<br /><br />Full name: RWTSMultivariateCalculations.full10YMatrix</div>
<div class="tip" id="fs135">property Frame.RowKeys: seq&lt;string&gt;</div>
<div class="tip" id="fs136">val toList : source:seq&lt;&#39;T&gt; -&gt; &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.Seq.toList</div>
<div class="tip" id="fs137">val fullUncMatrix : MatrixDescription<br /><br />Full name: RWTSMultivariateCalculations.fullUncMatrix</div>
<div class="tip" id="fs138">val correl : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.correl</div>
<div class="tip" id="fs139">val sigma : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.sigma</div>
<div class="tip" id="fs140">val vector : lst:&#39;T list -&gt; Vector&lt;&#39;T&gt; (requires default constructor and value type and &#39;T :&gt; IEquatable&lt;&#39;T&gt; and &#39;T :&gt; IFormattable and &#39;T :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.VectorExtensions.vector</div>
<div class="tip" id="fs141">val cov : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.cov</div>
<div class="tip" id="fs142">val cor2cov : cor:Matrix&lt;float&gt; -&gt; vol:Vector&lt;float&gt; -&gt; Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.cor2cov</div>
<div class="tip" id="fs143">val cor : Matrix&lt;float&gt;</div>
<div class="tip" id="fs144">val vol : Vector&lt;float&gt;</div>
<div class="tip" id="fs145">Multiple items<br />type Vector =<br />&#160;&#160;static member ofOptionalValues : data:OptionalValue&lt;&#39;T&gt; [] -&gt; IVector&lt;&#39;T&gt;<br />&#160;&#160;static member ofOptionalValues : data:seq&lt;OptionalValue&lt;&#39;T&gt;&gt; -&gt; IVector&lt;&#39;T&gt;<br />&#160;&#160;static member ofOptionalValues : data:seq&lt;&#39;T option&gt; -&gt; IVector&lt;&#39;T&gt;<br />&#160;&#160;static member ofValues : data:seq&lt;&#39;T&gt; -&gt; IVector&lt;&#39;T&gt;<br />&#160;&#160;static member ofValues : data:&#39;T [] -&gt; IVector&lt;&#39;T&gt;<br /><br />Full name: Deedle.F# Vector extensions.Vector<br /><br />--------------------<br />type Vector&lt;&#39;T (requires default constructor and value type and &#39;T :&gt; IEquatable&lt;&#39;T&gt; and &#39;T :&gt; IFormattable and &#39;T :&gt; ValueType)&gt; =<br />&#160;&#160;member AbsoluteMaximum : unit -&gt; &#39;T<br />&#160;&#160;member AbsoluteMaximumIndex : unit -&gt; int<br />&#160;&#160;member AbsoluteMinimum : unit -&gt; &#39;T<br />&#160;&#160;member AbsoluteMinimumIndex : unit -&gt; int<br />&#160;&#160;member Add : scalar:&#39;T -&gt; Vector&lt;&#39;T&gt; + 3 overloads<br />&#160;&#160;member At : index:int -&gt; &#39;T + 1 overload<br />&#160;&#160;member Clear : unit -&gt; unit<br />&#160;&#160;member ClearSubVector : index:int * count:int -&gt; unit<br />&#160;&#160;member Clone : unit -&gt; Vector&lt;&#39;T&gt;<br />&#160;&#160;member CoerceZero : threshold:float -&gt; unit + 1 overload<br />&#160;&#160;...<br /><br />Full name: MathNet.Numerics.LinearAlgebra.Vector&lt;_&gt;</div>
<div class="tip" id="fs146">val varmatrix : Matrix&lt;float&gt;</div>
<div class="tip" id="fs147">Vector.ToColumnMatrix() : Matrix&lt;float&gt;</div>
<div class="tip" id="fs148">Vector.ToRowMatrix() : Matrix&lt;float&gt;</div>
<div class="tip" id="fs149">val calcCov : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.calcCov</div>
<div class="tip" id="fs150">val cov2corVol : cov:Matrix&lt;float&gt; -&gt; Matrix&lt;float&gt; * Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.cov2corVol</div>
<div class="tip" id="fs151">val cov : Matrix&lt;float&gt;</div>
<div class="tip" id="fs152">Matrix.Diagonal() : Vector&lt;float&gt;</div>
<div class="tip" id="fs153">val map : f:(&#39;a -&gt; &#39;b) -&gt; v:#Vector&lt;&#39;a&gt; -&gt; Vector&lt;&#39;b&gt; (requires default constructor and value type and &#39;a :&gt; IEquatable&lt;&#39;a&gt; and &#39;a :&gt; IFormattable and &#39;a :&gt; ValueType and default constructor and value type and &#39;b :&gt; IEquatable&lt;&#39;b&gt; and &#39;b :&gt; IFormattable and &#39;b :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.Vector.map</div>
<div class="tip" id="fs154">val x : float</div>
<div class="tip" id="fs155">val calcCorr : Matrix&lt;float&gt;</div>
<div class="tip" id="fs156">val calcCor : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.calcCor</div>
<div class="tip" id="fs157">val calcVol : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.calcVol</div>
<div class="tip" id="fs158">val testCorrMatrix : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testCorrMatrix</div>
<div class="tip" id="fs159">val testVolVector : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testVolVector</div>
<div class="tip" id="fs160">val toSeq : list:&#39;T list -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.List.toSeq</div>
<div class="tip" id="fs161">field Vector.Build</div>
<div class="tip" id="fs162">VectorBuilder.DenseOfEnumerable(enumerable: Collections.Generic.IEnumerable&lt;&#39;T&gt;) : Vector&lt;&#39;T&gt;</div>
<div class="tip" id="fs163">val innerTestCovar : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.innerTestCovar</div>
<div class="tip" id="fs164">val testEURWeights : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testEURWeights</div>
<div class="tip" id="fs165">val testEURVsAssetCovar : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testEURVsAssetCovar</div>
<div class="tip" id="fs166">val testEURVariance : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testEURVariance</div>
<div class="tip" id="fs167">Matrix.Transpose() : Matrix&lt;float&gt;</div>
<div class="tip" id="fs168">val testInnerCovarWithEURTopRow : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testInnerCovarWithEURTopRow</div>
<div class="tip" id="fs169">Matrix.Stack(lower: Matrix&lt;float&gt;) : Matrix&lt;float&gt;<br />Matrix.Stack(lower: Matrix&lt;float&gt;, result: Matrix&lt;float&gt;) : unit</div>
<div class="tip" id="fs170">val testFullTransposedEURVsAssetCovar : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testFullTransposedEURVsAssetCovar</div>
<div class="tip" id="fs171">val testFullCovarWithEUR : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testFullCovarWithEUR</div>
<div class="tip" id="fs172">Matrix.Append(right: Matrix&lt;float&gt;) : Matrix&lt;float&gt;<br />Matrix.Append(right: Matrix&lt;float&gt;, result: Matrix&lt;float&gt;) : unit</div>
<div class="tip" id="fs173">val testFullCorr : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testFullCorr</div>
<div class="tip" id="fs174">val testFullVolVectorWithEUR : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testFullVolVectorWithEUR</div>
<div class="tip" id="fs175">val testEURUncVol : float<br /><br />Full name: RWTSMultivariateCalculations.testEURUncVol</div>
<div class="tip" id="fs176">val filterRowValues : f:(ObjectSeries&lt;&#39;C&gt; -&gt; bool) -&gt; frame:Frame&lt;&#39;R,&#39;C&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)<br /><br />Full name: Deedle.Frame.filterRowValues</div>
<div class="tip" id="fs177">val row : ObjectSeries&lt;string&gt;</div>
<div class="tip" id="fs178">member ObjectSeries.GetAs : column:&#39;K -&gt; &#39;R<br />member ObjectSeries.GetAs : column:&#39;K * fallback:&#39;R -&gt; &#39;R</div>
<div class="tip" id="fs179">val correlAndVarianceWithExtraAsset : originalCorrel:Matrix&lt;float&gt; -&gt; originalVols:Vector&lt;float&gt; -&gt; assetWeights:Vector&lt;float&gt; -&gt; Matrix&lt;float&gt; * Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.correlAndVarianceWithExtraAsset</div>
<div class="tip" id="fs180">val originalCorrel : Matrix&lt;float&gt;</div>
<div class="tip" id="fs181">val originalVols : Vector&lt;float&gt;</div>
<div class="tip" id="fs182">val assetWeights : Vector&lt;float&gt;</div>
<div class="tip" id="fs183">val innerCovar : Matrix&lt;float&gt;</div>
<div class="tip" id="fs184">val testNEWVsAssetCovar : Matrix&lt;float&gt;</div>
<div class="tip" id="fs185">val testNEWVariance : Matrix&lt;float&gt;</div>
<div class="tip" id="fs186">val testInnerCovarWithNEWTopRow : Matrix&lt;float&gt;</div>
<div class="tip" id="fs187">val testFullTransposedNEWVsAssetCovar : Matrix&lt;float&gt;</div>
<div class="tip" id="fs188">val testFullCovarWithNEW : Matrix&lt;float&gt;</div>
<div class="tip" id="fs189">val newFullCorr : Matrix&lt;float&gt;</div>
<div class="tip" id="fs190">val newFullVolVector : Vector&lt;float&gt;</div>
<div class="tip" id="fs191">val unconditionalVols : float list<br /><br />Full name: RWTSMultivariateCalculations.unconditionalVols</div>
<div class="tip" id="fs192">val uncCovarMatrix : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.uncCovarMatrix</div>
<div class="tip" id="fs193">val marketPfReturn : float<br /><br />Full name: RWTSMultivariateCalculations.marketPfReturn</div>
<div class="tip" id="fs194">val marketCap : Map&lt;string,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.marketCap</div>
<div class="tip" id="fs195">Multiple items<br />module Map<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Map&lt;&#39;Key,&#39;Value (requires comparison)&gt; =<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IComparable<br />&#160;&#160;interface IEnumerable&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface ICollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;<br />&#160;&#160;interface IDictionary&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member Add : key:&#39;Key * value:&#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;member ContainsKey : key:&#39;Key -&gt; bool<br />&#160;&#160;override Equals : obj -&gt; bool<br />&#160;&#160;member Remove : key:&#39;Key -&gt; Map&lt;&#39;Key,&#39;Value&gt;<br />&#160;&#160;...<br /><br />Full name: Microsoft.FSharp.Collections.Map&lt;_,_&gt;<br /><br />--------------------<br />new : elements:seq&lt;&#39;Key * &#39;Value&gt; -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="tip" id="fs196">val ofList : elements:(&#39;Key * &#39;T) list -&gt; Map&lt;&#39;Key,&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.ofList</div>
<div class="tip" id="fs197">val totalMarketCap : float<br /><br />Full name: RWTSMultivariateCalculations.totalMarketCap</div>
<div class="tip" id="fs198">val toList : table:Map&lt;&#39;Key,&#39;T&gt; -&gt; (&#39;Key * &#39;T) list (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.toList</div>
<div class="tip" id="fs199">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; list:&#39;T list -&gt; &#39;U list<br /><br />Full name: Microsoft.FSharp.Collections.List.map</div>
<div class="tip" id="fs200">val k1 : string</div>
<div class="tip" id="fs201">val v1 : float</div>
<div class="tip" id="fs202">val sum : list:&#39;T list -&gt; &#39;T (requires member ( + ) and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.List.sum</div>
<div class="tip" id="fs203">val portfolioWeight : Map&lt;string,float&gt;<br /><br />Full name: RWTSMultivariateCalculations.portfolioWeight</div>
<div class="tip" id="fs204">val map : mapping:(&#39;Key -&gt; &#39;T -&gt; &#39;U) -&gt; table:Map&lt;&#39;Key,&#39;T&gt; -&gt; Map&lt;&#39;Key,&#39;U&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Map.map</div>
<div class="tip" id="fs205">val k : string</div>
<div class="tip" id="fs206">val v : float</div>
<div class="tip" id="fs207">val pfWeightsMatrix : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.pfWeightsMatrix</div>
<div class="tip" id="fs208">val transpose : A:#Matrix&lt;&#39;b&gt; -&gt; Matrix&lt;&#39;b&gt; (requires default constructor and value type and &#39;b :&gt; IEquatable&lt;&#39;b&gt; and &#39;b :&gt; IFormattable and &#39;b :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.Matrix.transpose</div>
<div class="tip" id="fs209">val pfCovariance : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.pfCovariance</div>
<div class="tip" id="fs210">val marketPfVariance : float<br /><br />Full name: RWTSMultivariateCalculations.marketPfVariance</div>
<div class="tip" id="fs211">val marketBetas : seq&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.marketBetas</div>
<div class="tip" id="fs212">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;U&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.map</div>
<div class="tip" id="fs213">val cov : float</div>
<div class="tip" id="fs214">val riskPremia : seq&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.riskPremia</div>
<div class="tip" id="fs215">val beta : float</div>
<div class="tip" id="fs216">val zScores : float list<br /><br />Full name: RWTSMultivariateCalculations.zScores</div>
<div class="tip" id="fs217">val uncVol : float</div>
<div class="tip" id="fs218">val riskPrem : float</div>
<div class="tip" id="fs219">val allPortfolioFunction : pfReturn:float -&gt; marketCapWeights:Vector&lt;float&gt; -&gt; unconditionalVols:Vector&lt;float&gt; -&gt; correlationMatrix:Matrix&lt;float&gt; -&gt; info:&#39;a -&gt; &#39;a<br /><br />Full name: RWTSMultivariateCalculations.allPortfolioFunction</div>
<div class="tip" id="fs220">val pfReturn : float</div>
<div class="tip" id="fs221">val marketCapWeights : Vector&lt;float&gt;</div>
<div class="tip" id="fs222">val unconditionalVols : Vector&lt;float&gt;</div>
<div class="tip" id="fs223">val correlationMatrix : Matrix&lt;float&gt;</div>
<div class="tip" id="fs224">val info : &#39;a</div>
<div class="tip" id="fs225">val pfCovariance : Vector&lt;float&gt;</div>
<div class="tip" id="fs226">val marketPfVariance : float</div>
<div class="tip" id="fs227">val marketBetas : Vector&lt;float&gt;</div>
<div class="tip" id="fs228">val riskPremia : Vector&lt;float&gt;</div>
<div class="tip" id="fs229">val zScores : Vector&lt;float&gt;</div>
<div class="tip" id="fs230">val marketCapInfo : Frame&lt;string,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.marketCapInfo</div>
<div class="tip" id="fs231">val extendAssetInfoWithCaps : info:Frame&lt;&#39;a,string&gt; -&gt; caps:Frame&lt;&#39;a,string&gt; -&gt; Frame&lt;&#39;a,string&gt; (requires equality)<br /><br />Full name: RWTSMultivariateCalculations.extendAssetInfoWithCaps</div>
<div class="tip" id="fs232">val info : Frame&lt;&#39;a,string&gt; (requires equality)</div>
<div class="tip" id="fs233">val caps : Frame&lt;&#39;a,string&gt; (requires equality)</div>
<div class="tip" id="fs234">val withCaps : Frame&lt;&#39;a,string&gt; (requires equality)</div>
<div class="tip" id="fs235">val join : kind:JoinKind -&gt; frame1:Frame&lt;&#39;R,&#39;C&gt; -&gt; frame2:Frame&lt;&#39;R,&#39;C&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)<br /><br />Full name: Deedle.Frame.join</div>
<div class="tip" id="fs236">type JoinKind =<br />&#160;&#160;|  Outer  =  0<br />&#160;&#160;|  Inner  =  1<br />&#160;&#160;|  Left  =  2<br />&#160;&#160;|  Right  =  3<br /><br />Full name: Deedle.JoinKind</div>
<div class="tip" id="fs237">JoinKind.Left: JoinKind = 2</div>
<div class="tip" id="fs238">val fillMissingWith : value:&#39;T -&gt; frame:Frame&lt;&#39;R,&#39;C&gt; -&gt; Frame&lt;&#39;R,&#39;C&gt; (requires equality and equality)<br /><br />Full name: Deedle.Frame.fillMissingWith</div>
<div class="tip" id="fs239">val marketCapTotal : float</div>
<div class="tip" id="fs240">type Stats =<br />&#160;&#160;static member count : frame:Frame&lt;&#39;R,&#39;C&gt; -&gt; Series&lt;&#39;C,int&gt; (requires equality and equality)<br />&#160;&#160;static member count : series:Series&lt;&#39;K,&#39;V&gt; -&gt; int (requires equality)<br />&#160;&#160;static member expandingCount : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingKurt : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingMax : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingMean : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingMin : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingSkew : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingStdDev : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;static member expandingSum : series:Series&lt;&#39;K,float&gt; -&gt; Series&lt;&#39;K,float&gt; (requires equality)<br />&#160;&#160;...<br /><br />Full name: Deedle.Stats</div>
<div class="tip" id="fs241">static member Stats.sum : frame:Frame&lt;&#39;R,&#39;C&gt; -&gt; Series&lt;&#39;C,float&gt; (requires equality and equality)<br />static member Stats.sum : series:Series&lt;&#39;K,float&gt; -&gt; float (requires equality)</div>
<div class="tip" id="fs242">val euroCapTotal : float</div>
<div class="tip" id="fs243">val weightInPf : Series&lt;&#39;a,float&gt; (requires equality)</div>
<div class="tip" id="fs244">val weightInEuroPf : Series&lt;&#39;a,float&gt; (requires equality)</div>
<div class="tip" id="fs245">val fullAssetInfoEuroCaps : Frame&lt;string,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.fullAssetInfoEuroCaps</div>
<div class="tip" id="fs246">val pfWeightsVector : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.pfWeightsVector</div>
<div class="tip" id="fs247">val values : series:Series&lt;&#39;K,&#39;T&gt; -&gt; seq&lt;&#39;T&gt; (requires equality)<br /><br />Full name: Deedle.Series.values</div>
<div class="tip" id="fs248">val databaseUncVols : Frame&lt;string,string&gt;<br /><br />Full name: RWTSMultivariateCalculations.databaseUncVols</div>
<div class="tip" id="fs249">val uncVolVector : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.uncVolVector</div>
<div class="tip" id="fs250">val fullUncMatrixWithEUR : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.fullUncMatrixWithEUR</div>
<div class="tip" id="fs251">val fullUncVolVectorWithEUR : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.fullUncVolVectorWithEUR</div>
<div class="tip" id="fs252">val fullUncMatrixDesWithEur : MatrixDescription<br /><br />Full name: RWTSMultivariateCalculations.fullUncMatrixDesWithEur</div>
<div class="tip" id="fs253">val newRowForEUR : Series&lt;string,obj&gt;<br /><br />Full name: RWTSMultivariateCalculations.newRowForEUR</div>
<div class="tip" id="fs254">val box : value:&#39;T -&gt; obj<br /><br />Full name: Microsoft.FSharp.Core.Operators.box</div>
<div class="tip" id="fs255">val series : observations:seq&lt;&#39;a * &#39;b&gt; -&gt; Series&lt;&#39;a,&#39;b&gt; (requires equality)<br /><br />Full name: Deedle.F# Series extensions.series</div>
<div class="tip" id="fs256">member Frame.Merge : [&lt;ParamArray&gt;] otherFrames:Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt; [] -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;<br />member Frame.Merge : otherFrames:seq&lt;Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;&gt; -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;<br />member Frame.Merge : otherFrame:Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt; -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt;<br />static member FrameExtensions.Merge : frame:Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt; * rowKey:&#39;TRowKey * row:ISeries&lt;&#39;TColumnKey&gt; -&gt; Frame&lt;&#39;TRowKey,&#39;TColumnKey&gt; (requires equality and equality)</div>
<div class="tip" id="fs257">val decomposeMatrix : correlMatrix:Matrix&lt;float&gt; -&gt; Vector&lt;float&gt; * Matrix&lt;float&gt; * bool<br /><br />Full name: RWTSMultivariateCalculations.decomposeMatrix</div>
<div class="tip" id="fs258">val correlMatrix : Matrix&lt;float&gt;</div>
<div class="tip" id="fs259">val eigenDecomp : Factorization.Evd&lt;float&gt;</div>
<div class="tip" id="fs260">val eigenValues : Vector&lt;float&gt;</div>
<div class="tip" id="fs261">property Factorization.Evd.EigenValues: Vector&lt;Numerics.Complex&gt;</div>
<div class="tip" id="fs262">(extension) Vector.Real() : Vector&lt;float&gt;</div>
<div class="tip" id="fs263">val eigenVectors : Matrix&lt;float&gt;</div>
<div class="tip" id="fs264">property Factorization.Evd.EigenVectors: Matrix&lt;float&gt;</div>
<div class="tip" id="fs265">val isPSD : bool</div>
<div class="tip" id="fs266">val testEigenValues : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testEigenValues</div>
<div class="tip" id="fs267">val testEigenVectors : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.testEigenVectors</div>
<div class="tip" id="fs268">val testIsPSD : bool<br /><br />Full name: RWTSMultivariateCalculations.testIsPSD</div>
<div class="tip" id="fs269">val reconstructMatrixFromEigenDecomposition : eigenVectors:Matrix&lt;float&gt; -&gt; eigenValues:Vector&lt;float&gt; -&gt; Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.reconstructMatrixFromEigenDecomposition</div>
<div class="tip" id="fs270">val ofDiag : v:Vector&lt;&#39;T&gt; -&gt; Matrix&lt;&#39;T&gt; (requires default constructor and value type and &#39;T :&gt; IEquatable&lt;&#39;T&gt; and &#39;T :&gt; IFormattable and &#39;T :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.DenseMatrix.ofDiag</div>
<div class="tip" id="fs271">Matrix.Inverse() : Matrix&lt;float&gt;</div>
<div class="tip" id="fs272">val reconstructedTestMatrix : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.reconstructedTestMatrix</div>
<div class="tip" id="fs273">val nThSmallestPosEigenValue : eigenValues:Vector&lt;float&gt; -&gt; n:int -&gt; float<br /><br />Full name: RWTSMultivariateCalculations.nThSmallestPosEigenValue</div>
<div class="tip" id="fs274">val n : int</div>
<div class="tip" id="fs275">val toList : v:#Vector&lt;&#39;b&gt; -&gt; &#39;b list (requires default constructor and value type and &#39;b :&gt; IEquatable&lt;&#39;b&gt; and &#39;b :&gt; IFormattable and &#39;b :&gt; ValueType)<br /><br />Full name: MathNet.Numerics.LinearAlgebra.Vector.toList</div>
<div class="tip" id="fs276">val filter : predicate:(&#39;T -&gt; bool) -&gt; source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.Seq.filter</div>
<div class="tip" id="fs277">val ev : float</div>
<div class="tip" id="fs278">val sort : source:seq&lt;&#39;T&gt; -&gt; seq&lt;&#39;T&gt; (requires comparison)<br /><br />Full name: Microsoft.FSharp.Collections.Seq.sort</div>
<div class="tip" id="fs279">val item : index:int -&gt; source:seq&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Collections.Seq.item</div>
<div class="tip" id="fs280">val replaceNegativeEigenValues : eigenValues:Vector&lt;float&gt; -&gt; replacement:float -&gt; Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.replaceNegativeEigenValues</div>
<div class="tip" id="fs281">val replacement : float</div>
<div class="tip" id="fs282">val latestSmallestPositiveEigenValue : float<br /><br />Full name: RWTSMultivariateCalculations.latestSmallestPositiveEigenValue</div>
<div class="tip" id="fs283">val newPossibleEigenValues : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.newPossibleEigenValues</div>
<div class="tip" id="fs284">val newPossibleCorrelMatrix : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.newPossibleCorrelMatrix</div>
<div class="tip" id="fs285">val newDiagonalOfOnes : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.newDiagonalOfOnes</div>
<div class="tip" id="fs286">val e : float</div>
<div class="tip" id="fs287">Matrix.SetDiagonal(source: float []) : unit<br />Matrix.SetDiagonal(source: Vector&lt;float&gt;) : unit</div>
<div class="tip" id="fs288">val newEigenValues : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.newEigenValues</div>
<div class="tip" id="fs289">val newEigenVectors : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.newEigenVectors</div>
<div class="tip" id="fs290">val newIsPSD : bool<br /><br />Full name: RWTSMultivariateCalculations.newIsPSD</div>
<div class="tip" id="fs291">val ensureMatrixIsPSD : matrix:Matrix&lt;float&gt; -&gt; Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.ensureMatrixIsPSD</div>
<div class="tip" id="fs292">val nThSmallestPosEigenValue : (Vector&lt;float&gt; -&gt; int -&gt; float)</div>
<div class="tip" id="fs293">val replaceNegativeEigenValues : (Vector&lt;float&gt; -&gt; float -&gt; Vector&lt;float&gt;)</div>
<div class="tip" id="fs294">val originalEigenValues : Vector&lt;float&gt;</div>
<div class="tip" id="fs295">val originalEigenVectors : Matrix&lt;float&gt;</div>
<div class="tip" id="fs296">val originalIsPSD : bool</div>
<div class="tip" id="fs297">val startN : int</div>
<div class="tip" id="fs298">val maxN : int</div>
<div class="tip" id="fs299">property Vector.Count: int</div>
<div class="tip" id="fs300">val newDiagonalOfOnes : Vector&lt;float&gt;</div>
<div class="tip" id="fs301">val setEVUntilPSD : (int -&gt; Matrix&lt;float&gt;)</div>
<div class="tip" id="fs302">val thisN : int</div>
<div class="tip" id="fs303">val latestSmallestPositiveEigenValue : float</div>
<div class="tip" id="fs304">val newPossibleEigenValues : Vector&lt;float&gt;</div>
<div class="tip" id="fs305">val newPossibleCorrelMatrix : Matrix&lt;float&gt;</div>
<div class="tip" id="fs306">val newEigenValues : Vector&lt;float&gt;</div>
<div class="tip" id="fs307">val newEigenVectors : Matrix&lt;float&gt;</div>
<div class="tip" id="fs308">val newIsPSD : bool</div>
<div class="tip" id="fs309">val aPSDMatrixThatsAlreadyPSD : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.aPSDMatrixThatsAlreadyPSD</div>
<div class="tip" id="fs310">val aPSDMatrixThatsPSDAfterOneIteration : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.aPSDMatrixThatsPSDAfterOneIteration</div>
<div class="tip" id="fs311">val latestEigenValues : Vector&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.latestEigenValues</div>
<div class="tip" id="fs312">val latestEigenVectors : Matrix&lt;float&gt;<br /><br />Full name: RWTSMultivariateCalculations.latestEigenVectors</div>
<div class="tip" id="fs313">val latestIsPSD : bool<br /><br />Full name: RWTSMultivariateCalculations.latestIsPSD</div>


          
        </div>
        <div class="span1"></div>
      </div>
      <hr style="margin-top:50px;"/>
      <footer class="footer" style="text-align:center">
        Brought to you by the <a href="http://fsharp.org/technical-groups/">F# Data Science working group</a> and <a href="http://twitter.com/fslaborg">@fslaborg</a>.<br />
        Submit <a href="https://github.com/fslaborg/FsLab">feedback on GitHub</a> and help us improve FsLab!
      </footer>
    </div>
  </body>
</html>
